Object.defineProperty && Object.getOwnPropertyDescriptor && Object.getOwnPropertyDescriptor(Element.prototype, "textContent") && !Object.getOwnPropertyDescriptor(Element.prototype, "textContent").get && function () { var e = Object.getOwnPropertyDescriptor(Element.prototype, "innerText"); Object.defineProperty(Element.prototype, "textContent", { get: function () { return e.get.call(this) }, set: function (t) { return e.set.call(this, t) } }) }(), Array.isArray || (Array.isArray = function (e) { return "[object Array]" === Object.prototype.toString.call(e) }); var wysihtml5 = { version: "0.4.15", commands: {}, dom: {}, quirks: {}, toolbar: {}, lang: {}, selection: {}, views: {}, INVISIBLE_SPACE: "\ufeff", EMPTY_FUNCTION: function () { }, ELEMENT_NODE: 1, TEXT_NODE: 3, BACKSPACE_KEY: 8, ENTER_KEY: 13, ESCAPE_KEY: 27, SPACE_KEY: 32, DELETE_KEY: 46 }; !function (e, t) { "function" == typeof define && define.amd ? define(e) : t.rangy = e() }(function () { var e = "object", t = "function", n = "undefined", o = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed", "commonAncestorContainer"], r = ["setStart", "setStartBefore", "setStartAfter", "setEnd", "setEndBefore", "setEndAfter", "collapse", "selectNode", "selectNodeContents", "compareBoundaryPoints", "deleteContents", "extractContents", "cloneContents", "insertNode", "surroundContents", "cloneRange", "toString", "detach"], i = ["boundingHeight", "boundingLeft", "boundingTop", "boundingWidth", "htmlText", "text"], a = ["collapse", "compareEndPoints", "duplicate", "moveToElementText", "parentElement", "select", "setEndPoint", "getBoundingClientRect"]; function s(n, o) { var r = typeof n[o]; return r == t || !(r != e || !n[o]) || "unknown" == r } function l(t, n) { return !(typeof t[n] != e || !t[n]) } function c(e, t) { return typeof e[t] != n } function d(e) { return function (t, n) { for (var o = n.length; o--;)if (!e(t, n[o])) return !1; return !0 } } var u = d(s), h = d(l), f = d(c); function m(e) { return e && u(e, a) && f(e, i) } function p(e) { return l(e, "body") ? e.body : e.getElementsByTagName("body")[0] } var g, y = {}, v = { version: "1.3alpha.20140804", initialized: !1, supported: !0, util: { isHostMethod: s, isHostObject: l, isHostProperty: c, areHostMethods: u, areHostObjects: h, areHostProperties: f, isTextRange: m, getBody: p }, features: {}, modules: y, config: { alertOnFail: !0, alertOnWarn: !1, preferTextRange: !1, autoInitialize: typeof rangyAutoInitialize == n || rangyAutoInitialize } }; function w(e) { l(window, "console") && s(window.console, "log") && window.console.log(e) } function b(e, t) { t ? window.alert(e) : w(e) } function C(e) { v.initialized = !0, v.supported = !1, b("Rangy is not supported on this page in your browser. Reason: " + e, v.config.alertOnFail) } v.fail = C, v.warn = function (e) { b("Rangy warning: " + e, v.config.alertOnWarn) }, !{}.hasOwnProperty ? C("hasOwnProperty not supported") : v.util.extend = function (e, t, n) { var o, r; for (var i in t) t.hasOwnProperty(i) && (o = e[i], r = t[i], n && null !== o && "object" == typeof o && null !== r && "object" == typeof r && v.util.extend(o, r, !0), e[i] = r); return t.hasOwnProperty("toString") && (e.toString = t.toString), e }, function () { var e = document.createElement("div"); e.appendChild(document.createElement("span")); var t, n = [].slice; try { 1 == n.call(e.childNodes, 0)[0].nodeType && (t = function (e) { return n.call(e, 0) }) } catch (e) { } t || (t = function (e) { for (var t = [], n = 0, o = e.length; n < o; ++n)t[n] = e[n]; return t }), v.util.toArray = t }(), s(document, "addEventListener") ? g = function (e, t, n) { e.addEventListener(t, n, !1) } : s(document, "attachEvent") ? g = function (e, t, n) { e.attachEvent("on" + t, n) } : C("Document does not have required addEventListener or attachEvent method"), v.util.addListener = g; var N = []; function x(e) { return e.message || e.description || String(e) } function E() { if (!v.initialized) { var e, t = !1, n = !1; s(document, "createRange") && (e = document.createRange(), u(e, r) && f(e, o) && (t = !0)); var i = p(document); if (i && "body" == i.nodeName.toLowerCase()) if (i && s(i, "createTextRange") && m(e = i.createTextRange()) && (n = !0), t || n) { var a; for (var l in v.initialized = !0, v.features = { implementsDomRange: t, implementsTextRange: n }, y) (a = y[l]) instanceof T && a.init(a, v); for (var c = 0, d = N.length; c < d; ++c)try { N[c](v) } catch (e) { w("Rangy init listener threw an exception. Continuing. Detail: " + x(e)) } } else C("Neither Range nor TextRange are available"); else C("No body element found") } } v.init = E, v.addInitListener = function (e) { v.initialized ? e(v) : N.push(e) }; var S = []; function T(e, t, n) { this.name = e, this.dependencies = t, this.initialized = !1, this.supported = !1, this.initializer = n } function R(e, t, n, o) { var r = new T(t, n, function (e) { if (!e.initialized) { e.initialized = !0; try { o(v, e), e.supported = !0 } catch (e) { w("Module '" + t + "' failed to load: " + x(e)) } } }); y[t] = r } function A() { } v.addShimListener = function (e) { S.push(e) }, v.shim = v.createMissingNativeApi = function (e) { e = e || window, E(); for (var t = 0, n = S.length; t < n; ++t)S[t](e) }, T.prototype = { init: function () { for (var e, t, n = this.dependencies || [], o = 0, r = n.length; o < r; ++o) { if (t = n[o], !((e = y[t]) && e instanceof T)) throw new Error("required module '" + t + "' not found"); if (e.init(), !e.supported) throw new Error("required module '" + t + "' not supported") } this.initializer(this) }, fail: function (e) { throw this.initialized = !0, this.supported = !1, new Error("Module '" + this.name + "' failed to load: " + e) }, warn: function (e) { v.warn("Module " + this.name + ": " + e) }, deprecationNotice: function (e, t) { v.warn("DEPRECATED: " + e + " in module " + this.name + "is deprecated. Please use " + t + " instead") }, createError: function (e) { return new Error("Error in Rangy " + this.name + " module: " + e) } }, v.createModule = function (e) { var t, n; 2 == arguments.length ? (t = arguments[1], n = []) : (t = arguments[2], n = arguments[1]); var o = R(0, e, n, t); v.initialized && o.init() }, v.createCoreModule = function (e, t, n) { R(0, e, t, n) }, v.RangePrototype = A, v.rangePrototype = new A, v.selectionPrototype = new function () { }; var _ = !1, O = function (e) { _ || (_ = !0, !v.initialized && v.config.autoInitialize && E()) }; if (typeof window != n) { if (typeof document != n) return s(document, "addEventListener") && document.addEventListener("DOMContentLoaded", O, !1), g(window, "load", O), v.createCoreModule("DomUtil", [], function (e, t) { var n = "undefined", o = e.util; o.areHostMethods(document, ["createDocumentFragment", "createElement", "createTextNode"]) || t.fail("document missing a Node creation method"), o.isHostMethod(document, "getElementsByTagName") || t.fail("document missing getElementsByTagName method"); var r = document.createElement("div"); o.areHostMethods(r, ["insertBefore", "appendChild", "cloneNode"] || !o.areHostObjects(r, ["previousSibling", "nextSibling", "childNodes", "parentNode"])) || t.fail("Incomplete Element implementation"), o.isHostProperty(r, "innerHTML") || t.fail("Element is missing innerHTML property"); var i = document.createTextNode("test"); o.areHostMethods(i, ["splitText", "deleteData", "insertData", "appendData", "cloneNode"] || !o.areHostObjects(r, ["previousSibling", "nextSibling", "childNodes", "parentNode"]) || !o.areHostProperties(i, ["data"])) || t.fail("Incomplete Text Node implementation"); var a = function (e, t) { for (var n = e.length; n--;)if (e[n] === t) return !0; return !1 }; function s(e) { for (var t = 0; e = e.previousSibling;)++t; return t } function l(e, t) { var n, o = []; for (n = e; n; n = n.parentNode)o.push(n); for (n = t; n; n = n.parentNode)if (a(o, n)) return n; return null } function c(e, t, n) { for (var o = n ? t : t.parentNode; o;) { if (o === e) return !0; o = o.parentNode } return !1 } function d(e, t, n) { for (var o, r = n ? e : e.parentNode; r;) { if ((o = r.parentNode) === t) return r; r = o } return null } function u(e) { var t = e.nodeType; return 3 == t || 4 == t || 8 == t } function h(e, t) { var n = t.nextSibling, o = t.parentNode; return n ? o.insertBefore(e, n) : o.appendChild(e), e } function f(e) { if (9 == e.nodeType) return e; if (typeof e.ownerDocument != n) return e.ownerDocument; if (typeof e.document != n) return e.document; if (e.parentNode) return f(e.parentNode); throw t.createError("getDocument: no document found for node") } function m(e) { var o = f(e); if (typeof o.defaultView != n) return o.defaultView; if (typeof o.parentWindow != n) return o.parentWindow; throw t.createError("Cannot get a window object for node") } function p(e) { if (typeof e.contentDocument != n) return e.contentDocument; if (typeof e.contentWindow != n) return e.contentWindow.document; throw t.createError("getIframeDocument: No Document object found for iframe element") } function g(e) { return e && o.isHostMethod(e, "setTimeout") && o.isHostObject(e, "document") } var y, v = !1; function w(e) { try { return e.parentNode, !1 } catch (e) { return !0 } } function b(e) { if (!e) return "[No node]"; if (v && w(e)) return "[Broken node]"; if (u(e)) return '"' + e.data + '"'; if (1 == e.nodeType) { var t = e.id ? ' id="' + e.id + '"' : ""; return "<" + e.nodeName + t + ">[index:" + s(e) + ",length:" + e.childNodes.length + "][" + (e.innerHTML || "[innerHTML not supported]").slice(0, 25) + "]" } return e.nodeName } function C(e) { this.root = e, this._next = e } function N(e, t) { this.node = e, this.offset = t } function x(e) { this.code = this[e], this.codeName = e, this.message = "DOMException: " + this.codeName } !function () { var t = document.createElement("b"); t.innerHTML = "1"; var n = t.firstChild; t.innerHTML = "<br>", v = w(n), e.features.crashyTextNodes = v }(), typeof window.getComputedStyle != n ? y = function (e, t) { return m(e).getComputedStyle(e, null)[t] } : typeof document.documentElement.currentStyle != n ? y = function (e, t) { return e.currentStyle[t] } : t.fail("No means of obtaining computed style properties found"), C.prototype = { _current: null, hasNext: function () { return !!this._next }, next: function () { var e, t, n = this._current = this._next; if (this._current) if (e = n.firstChild) this._next = e; else { for (t = null; n !== this.root && !(t = n.nextSibling);)n = n.parentNode; this._next = t } return this._current }, detach: function () { this._current = this._next = this.root = null } }, N.prototype = { equals: function (e) { return !!e && this.node === e.node && this.offset == e.offset }, inspect: function () { return "[DomPosition(" + b(this.node) + ":" + this.offset + ")]" }, toString: function () { return this.inspect() } }, x.prototype = { INDEX_SIZE_ERR: 1, HIERARCHY_REQUEST_ERR: 3, WRONG_DOCUMENT_ERR: 4, NO_MODIFICATION_ALLOWED_ERR: 7, NOT_FOUND_ERR: 8, NOT_SUPPORTED_ERR: 9, INVALID_STATE_ERR: 11, INVALID_NODE_TYPE_ERR: 24 }, x.prototype.toString = function () { return this.message }, e.dom = { arrayContains: a, isHtmlNamespace: function (e) { var t; return typeof e.namespaceURI == n || null === (t = e.namespaceURI) || "http://www.w3.org/1999/xhtml" == t }, parentElement: function (e) { var t = e.parentNode; return 1 == t.nodeType ? t : null }, getNodeIndex: s, getNodeLength: function (e) { switch (e.nodeType) { case 7: case 10: return 0; case 3: case 8: return e.length; default: return e.childNodes.length } }, getCommonAncestor: l, isAncestorOf: c, isOrIsAncestorOf: function (e, t) { return c(e, t, !0) }, getClosestAncestorIn: d, isCharacterDataNode: u, isTextOrCommentNode: function (e) { if (!e) return !1; var t = e.nodeType; return 3 == t || 8 == t }, insertAfter: h, splitDataNode: function (e, t, n) { var o = e.cloneNode(!1); if (o.deleteData(0, t), e.deleteData(t, e.length - t), h(o, e), n) for (var r, i = 0; r = n[i++];)r.node == e && r.offset > t ? (r.node = o, r.offset -= t) : r.node == e.parentNode && r.offset > s(e) && ++r.offset; return o }, getDocument: f, getWindow: m, getIframeWindow: function (e) { if (typeof e.contentWindow != n) return e.contentWindow; if (typeof e.contentDocument != n) return e.contentDocument.defaultView; throw t.createError("getIframeWindow: No Window object found for iframe element") }, getIframeDocument: p, getBody: o.getBody, isWindow: g, getContentDocument: function (e, t, n) { var r; if (e ? o.isHostProperty(e, "nodeType") ? r = 1 == e.nodeType && "iframe" == e.tagName.toLowerCase() ? p(e) : f(e) : g(e) && (r = e.document) : r = document, !r) throw t.createError(n + "(): Parameter must be a Window object or DOM node"); return r }, getRootContainer: function (e) { for (var t; t = e.parentNode;)e = t; return e }, comparePoints: function (e, n, o, r) { var i, a, c, u, h; if (e == o) return n === r ? 0 : n < r ? -1 : 1; if (i = d(o, e, !0)) return n <= s(i) ? -1 : 1; if (i = d(e, o, !0)) return s(i) < r ? -1 : 1; if (!(a = l(e, o))) throw new Error("comparePoints error: nodes have no common ancestor"); if ((c = e === a ? a : d(e, a, !0)) === (u = o === a ? a : d(o, a, !0))) throw t.createError("comparePoints got to case 4 and childA and childB are the same!"); for (h = a.firstChild; h;) { if (h === c) return -1; if (h === u) return 1; h = h.nextSibling } }, isBrokenNode: w, inspectNode: b, getComputedStyleProperty: y, fragmentFromNodeChildren: function (e) { for (var t, n = f(e).createDocumentFragment(); t = e.firstChild;)n.appendChild(t); return n }, createIterator: function (e) { return new C(e) }, DomPosition: N }, e.DOMException = x }), v.createCoreModule("DomRange", ["DomUtil"], function (e, t) { var n = e.dom, o = e.util, r = n.DomPosition, i = e.DOMException, a = n.isCharacterDataNode, s = n.getNodeIndex, l = n.isOrIsAncestorOf, c = n.getDocument, d = n.comparePoints, u = n.splitDataNode, h = n.getClosestAncestorIn, f = n.getNodeLength, m = n.arrayContains, p = n.getRootContainer, g = e.features.crashyTextNodes; function y(e, t) { return 3 != e.nodeType && (l(e, t.startContainer) || l(e, t.endContainer)) } function v(e) { return e.document || c(e.startContainer) } function w(e) { return new r(e.parentNode, s(e)) } function b(e) { return new r(e.parentNode, s(e) + 1) } function C(e, t, o) { var r = 11 == e.nodeType ? e.firstChild : e; return a(t) ? o == t.length ? n.insertAfter(e, t) : t.parentNode.insertBefore(e, 0 == o ? t : u(t, o)) : o >= t.childNodes.length ? t.appendChild(e) : t.insertBefore(e, t.childNodes[o]), r } function N(e, t, n) { if (F(e), F(t), v(t) != v(e)) throw new i("WRONG_DOCUMENT_ERR"); var o = d(e.startContainer, e.startOffset, t.endContainer, t.endOffset), r = d(e.endContainer, e.endOffset, t.startContainer, t.startOffset); return n ? o <= 0 && r >= 0 : o < 0 && r > 0 } function x(e, t, o) { var r, i, a, s; for (o = o || { stop: !1 }; a = e.next();)if (e.isPartiallySelectedSubtree()) { if (!1 === t(a)) return void (o.stop = !0); if (x(s = e.getSubtreeIterator(), t, o), s.detach(), o.stop) return } else for (r = n.createIterator(a); i = r.next();)if (!1 === t(i)) return void (o.stop = !0) } function E(e) { for (var t; e.next();)e.isPartiallySelectedSubtree() ? (E(t = e.getSubtreeIterator()), t.detach()) : e.remove() } function S(e) { for (var t, n, o = v(e.range).createDocumentFragment(); t = e.next();) { if (e.isPartiallySelectedSubtree() ? (t = t.cloneNode(!1), n = e.getSubtreeIterator(), t.appendChild(S(n)), n.detach()) : e.remove(), 10 == t.nodeType) throw new i("HIERARCHY_REQUEST_ERR"); o.appendChild(t) } return o } function T(e) { return "[" + (void 0 === e.getName ? "Range" : e.getName()) + "(" + n.inspectNode(e.startContainer) + ":" + e.startOffset + ", " + n.inspectNode(e.endContainer) + ":" + e.endOffset + ")]" } function R(e, t) { if (this.range = e, this.clonePartiallySelectedTextNodes = t, !e.collapsed) { this.sc = e.startContainer, this.so = e.startOffset, this.ec = e.endContainer, this.eo = e.endOffset; var n = e.commonAncestorContainer; this.sc === this.ec && a(this.sc) ? (this.isSingleCharacterDataNode = !0, this._first = this._last = this._next = this.sc) : (this._first = this._next = this.sc !== n || a(this.sc) ? h(this.sc, n, !0) : this.sc.childNodes[this.so], this._last = this.ec !== n || a(this.ec) ? h(this.ec, n, !0) : this.ec.childNodes[this.eo - 1]) } } R.prototype = { _current: null, _next: null, _first: null, _last: null, isSingleCharacterDataNode: !1, reset: function () { this._current = null, this._next = this._first }, hasNext: function () { return !!this._next }, next: function () { var e = this._current = this._next; return e && (this._next = e !== this._last ? e.nextSibling : null, a(e) && this.clonePartiallySelectedTextNodes && (e === this.ec && (e = e.cloneNode(!0)).deleteData(this.eo, e.length - this.eo), this._current === this.sc && (e = e.cloneNode(!0)).deleteData(0, this.so))), e }, remove: function () { var e, t, n = this._current; !a(n) || n !== this.sc && n !== this.ec ? n.parentNode && n.parentNode.removeChild(n) : (e = n === this.sc ? this.so : 0) != (t = n === this.ec ? this.eo : n.length) && n.deleteData(e, t - e) }, isPartiallySelectedSubtree: function () { return y(this._current, this.range) }, getSubtreeIterator: function () { var e; if (this.isSingleCharacterDataNode) (e = this.range.cloneRange()).collapse(!1); else { e = new he(v(this.range)); var t = this._current, n = t, o = 0, r = t, i = f(t); l(t, this.sc) && (n = this.sc, o = this.so), l(t, this.ec) && (r = this.ec, i = this.eo), ue(e, n, o, r, i) } return new R(e, this.clonePartiallySelectedTextNodes) }, detach: function () { this.range = this._current = this._next = this._first = this._last = this.sc = this.so = this.ec = this.eo = null } }; var A = [1, 3, 4, 5, 7, 8, 10], _ = [2, 9, 11], O = [1, 3, 4, 5, 7, 8, 10, 11], I = [1, 3, 4, 5, 7, 8]; function k(e) { return function (t, n) { for (var o, r = n ? t : t.parentNode; r;) { if (o = r.nodeType, m(e, o)) return r; r = r.parentNode } return null } } var L = k([9, 11]), D = k([5, 6, 10, 12]), M = k([6, 10, 12]); function P(e, t) { if (M(e, t)) throw new i("INVALID_NODE_TYPE_ERR") } function B(e, t) { if (!m(t, e.nodeType)) throw new i("INVALID_NODE_TYPE_ERR") } function H(e, t) { if (t < 0 || t > (a(e) ? e.length : e.childNodes.length)) throw new i("INDEX_SIZE_ERR") } function z(e, t) { if (L(e, !0) !== L(t, !0)) throw new i("WRONG_DOCUMENT_ERR") } function j(e) { if (D(e, !0)) throw new i("NO_MODIFICATION_ALLOWED_ERR") } function q(e, t) { if (!e) throw new i(t) } function V(e) { return g && n.isBrokenNode(e) || !m(_, e.nodeType) && !L(e, !0) } function W(e, t) { return t <= (a(e) ? e.length : e.childNodes.length) } function U(e) { return !!e.startContainer && !!e.endContainer && !V(e.startContainer) && !V(e.endContainer) && W(e.startContainer, e.startOffset) && W(e.endContainer, e.endOffset) } function F(e) { if (!U(e)) throw new Error("Range error: Range is no longer valid after DOM mutation (" + e.inspect() + ")") } var $ = document.createElement("style"), K = !1; try { $.innerHTML = "<b>x</b>", K = 3 == $.firstChild.nodeType } catch (e) { } e.features.htmlParsingConforms = K; var G = K ? function (e) { var t = this.startContainer, o = c(t); if (!t) throw new i("INVALID_STATE_ERR"); var r = null; return 1 == t.nodeType ? r = t : a(t) && (r = n.parentElement(t)), (r = null === r || "HTML" == r.nodeName && n.isHtmlNamespace(c(r).documentElement) && n.isHtmlNamespace(r) ? o.createElement("body") : r.cloneNode(!1)).innerHTML = e, n.fragmentFromNodeChildren(r) } : function (e) { var t = v(this).createElement("body"); return t.innerHTML = e, n.fragmentFromNodeChildren(t) }; function X(e, t) { F(e); var n = e.startContainer, o = e.startOffset, r = e.endContainer, i = e.endOffset, l = n === r; a(r) && i > 0 && i < r.length && u(r, i, t), a(n) && o > 0 && o < n.length && (n = u(n, o, t), l ? (i -= o, r = n) : r == n.parentNode && i >= s(n) && i++ , o = 0), e.setStartAndEnd(n, o, r, i) } function Y(e) { F(e); var t = e.commonAncestorContainer.parentNode.cloneNode(!1); return t.appendChild(e.cloneContents()), t.innerHTML } var Q = ["startContainer", "startOffset", "endContainer", "endOffset", "collapsed", "commonAncestorContainer"], Z = 0, J = 1, ee = 2, te = 3, ne = 0, oe = 1, re = 2, ie = 3; function ae(e) { e.START_TO_START = Z, e.START_TO_END = J, e.END_TO_END = ee, e.END_TO_START = te, e.NODE_BEFORE = ne, e.NODE_AFTER = oe, e.NODE_BEFORE_AND_AFTER = re, e.NODE_INSIDE = ie } function se(e) { ae(e), ae(e.prototype) } function le(e, t) { return function () { F(this); var n, o = this.startContainer, r = this.startOffset, i = this.commonAncestorContainer, a = new R(this, !0); o !== i && (o = (n = b(h(o, i, !0))).node, r = n.offset), x(a, j), a.reset(); var s = e(a); return a.detach(), t(this, o, r, o, r), s } } function ce(t, n) { function r(e, t) { return function (n) { B(n, A), B(p(n), _); var o = (e ? w : b)(n); (t ? i : l)(this, o.node, o.offset) } } function i(e, t, o) { var r = e.endContainer, i = e.endOffset; t === e.startContainer && o === e.startOffset || (p(t) == p(r) && 1 != d(t, o, r, i) || (r = t, i = o), n(e, t, o, r, i)) } function l(e, t, o) { var r = e.startContainer, i = e.startOffset; t === e.endContainer && o === e.endOffset || (p(t) == p(r) && -1 != d(t, o, r, i) || (r = t, i = o), n(e, r, i, t, o)) } var c = function () { }; c.prototype = e.rangePrototype, t.prototype = new c, o.extend(t.prototype, { setStart: function (e, t) { P(e, !0), H(e, t), i(this, e, t) }, setEnd: function (e, t) { P(e, !0), H(e, t), l(this, e, t) }, setStartAndEnd: function () { var e = arguments, t = e[0], o = e[1], r = t, i = o; switch (e.length) { case 3: i = e[2]; break; case 4: r = e[2], i = e[3] }n(this, t, o, r, i) }, setBoundary: function (e, t, n) { this["set" + (n ? "Start" : "End")](e, t) }, setStartBefore: r(!0, !0), setStartAfter: r(!1, !0), setEndBefore: r(!0, !1), setEndAfter: r(!1, !1), collapse: function (e) { F(this), e ? n(this, this.startContainer, this.startOffset, this.startContainer, this.startOffset) : n(this, this.endContainer, this.endOffset, this.endContainer, this.endOffset) }, selectNodeContents: function (e) { P(e, !0), n(this, e, 0, e, f(e)) }, selectNode: function (e) { P(e, !1), B(e, A); var t = w(e), o = b(e); n(this, t.node, t.offset, o.node, o.offset) }, extractContents: le(S, n), deleteContents: le(E, n), canSurroundContents: function () { F(this), j(this.startContainer), j(this.endContainer); var e = new R(this, !0), t = e._first && y(e._first, this) || e._last && y(e._last, this); return e.detach(), !t }, splitBoundaries: function () { X(this) }, splitBoundariesPreservingPositions: function (e) { X(this, e) }, normalizeBoundaries: function () { F(this); var e = this.startContainer, t = this.startOffset, o = this.endContainer, r = this.endOffset, i = function (e) { var t = e.nextSibling; t && t.nodeType == e.nodeType && (o = e, r = e.length, e.appendData(t.data), t.parentNode.removeChild(t)) }, l = function (n) { var i = n.previousSibling; if (i && i.nodeType == n.nodeType) { e = n; var a = n.length; if (t = i.length, n.insertData(0, i.data), i.parentNode.removeChild(i), e == o) r += t, o = e; else if (o == n.parentNode) { var l = s(n); r == l ? (o = n, r = a) : r > l && r-- } } }, c = !0; if (a(o)) o.length == r && i(o); else { if (r > 0) { var d = o.childNodes[r - 1]; d && a(d) && i(d) } c = !this.collapsed } if (c) { if (a(e)) 0 == t && l(e); else if (t < e.childNodes.length) { var u = e.childNodes[t]; u && a(u) && l(u) } } else e = o, t = r; n(this, e, t, o, r) }, collapseToPoint: function (e, t) { P(e, !0), H(e, t), this.setStartAndEnd(e, t) } }), se(t) } function de(e) { e.collapsed = e.startContainer === e.endContainer && e.startOffset === e.endOffset, e.commonAncestorContainer = e.collapsed ? e.startContainer : n.getCommonAncestor(e.startContainer, e.endContainer) } function ue(e, t, o, r, i) { e.startContainer = t, e.startOffset = o, e.endContainer = r, e.endOffset = i, e.document = n.getDocument(t), de(e) } function he(e) { this.startContainer = e, this.startOffset = 0, this.endContainer = e, this.endOffset = 0, this.document = e, de(this) } o.extend(e.rangePrototype, { compareBoundaryPoints: function (e, t) { var n, o, r, i; F(this), z(this.startContainer, t.startContainer); var a = e == te || e == Z ? "start" : "end", s = e == J || e == Z ? "start" : "end"; return n = this[a + "Container"], o = this[a + "Offset"], r = t[s + "Container"], i = t[s + "Offset"], d(n, o, r, i) }, insertNode: function (e) { if (F(this), B(e, O), j(this.startContainer), l(e, this.startContainer)) throw new i("HIERARCHY_REQUEST_ERR"); var t = C(e, this.startContainer, this.startOffset); this.setStartBefore(t) }, cloneContents: function () { var e, t; if (F(this), this.collapsed) return v(this).createDocumentFragment(); if (this.startContainer === this.endContainer && a(this.startContainer)) return (e = this.startContainer.cloneNode(!0)).data = e.data.slice(this.startOffset, this.endOffset), (t = v(this).createDocumentFragment()).appendChild(e), t; var n = new R(this, !0); return e = function e(t) { for (var n, o, r, a = v(t.range).createDocumentFragment(); o = t.next();) { if (n = t.isPartiallySelectedSubtree(), o = o.cloneNode(!n), n && (r = t.getSubtreeIterator(), o.appendChild(e(r)), r.detach()), 10 == o.nodeType) throw new i("HIERARCHY_REQUEST_ERR"); a.appendChild(o) } return a }(n), n.detach(), e }, canSurroundContents: function () { F(this), j(this.startContainer), j(this.endContainer); var e = new R(this, !0), t = e._first && y(e._first, this) || e._last && y(e._last, this); return e.detach(), !t }, surroundContents: function (e) { if (B(e, I), !this.canSurroundContents()) throw new i("INVALID_STATE_ERR"); var t = this.extractContents(); if (e.hasChildNodes()) for (; e.lastChild;)e.removeChild(e.lastChild); C(e, this.startContainer, this.startOffset), e.appendChild(t), this.selectNode(e) }, cloneRange: function () { F(this); for (var e, t = new he(v(this)), n = Q.length; n--;)t[e = Q[n]] = this[e]; return t }, toString: function () { F(this); var e = this.startContainer; if (e === this.endContainer && a(e)) return 3 == e.nodeType || 4 == e.nodeType ? e.data.slice(this.startOffset, this.endOffset) : ""; var t = [], n = new R(this, !0); return x(n, function (e) { 3 != e.nodeType && 4 != e.nodeType || t.push(e.data) }), n.detach(), t.join("") }, compareNode: function (e) { F(this); var t = e.parentNode, n = s(e); if (!t) throw new i("NOT_FOUND_ERR"); var o = this.comparePoint(t, n), r = this.comparePoint(t, n + 1); return o < 0 ? r > 0 ? re : ne : r > 0 ? oe : ie }, comparePoint: function (e, t) { return F(this), q(e, "HIERARCHY_REQUEST_ERR"), z(e, this.startContainer), d(e, t, this.startContainer, this.startOffset) < 0 ? -1 : d(e, t, this.endContainer, this.endOffset) > 0 ? 1 : 0 }, createContextualFragment: G, toHtml: function () { return Y(this) }, intersectsNode: function (e, t) { if (F(this), q(e, "NOT_FOUND_ERR"), c(e) !== v(this)) return !1; var n = e.parentNode, o = s(e); q(n, "NOT_FOUND_ERR"); var r = d(n, o, this.endContainer, this.endOffset), i = d(n, o + 1, this.startContainer, this.startOffset); return t ? r <= 0 && i >= 0 : r < 0 && i > 0 }, isPointInRange: function (e, t) { return F(this), q(e, "HIERARCHY_REQUEST_ERR"), z(e, this.startContainer), d(e, t, this.startContainer, this.startOffset) >= 0 && d(e, t, this.endContainer, this.endOffset) <= 0 }, intersectsRange: function (e) { return N(this, e, !1) }, intersectsOrTouchesRange: function (e) { return N(this, e, !0) }, intersection: function (e) { if (this.intersectsRange(e)) { var t = d(this.startContainer, this.startOffset, e.startContainer, e.startOffset), n = d(this.endContainer, this.endOffset, e.endContainer, e.endOffset), o = this.cloneRange(); return -1 == t && o.setStart(e.startContainer, e.startOffset), 1 == n && o.setEnd(e.endContainer, e.endOffset), o } return null }, union: function (e) { if (this.intersectsOrTouchesRange(e)) { var t = this.cloneRange(); return -1 == d(e.startContainer, e.startOffset, this.startContainer, this.startOffset) && t.setStart(e.startContainer, e.startOffset), 1 == d(e.endContainer, e.endOffset, this.endContainer, this.endOffset) && t.setEnd(e.endContainer, e.endOffset), t } throw new i("Ranges do not intersect") }, containsNode: function (e, t) { return t ? this.intersectsNode(e, !1) : this.compareNode(e) == ie }, containsNodeContents: function (e) { return this.comparePoint(e, 0) >= 0 && this.comparePoint(e, f(e)) <= 0 }, containsRange: function (e) { var t = this.intersection(e); return null !== t && e.equals(t) }, containsNodeText: function (e) { var t = this.cloneRange(); t.selectNode(e); var n = t.getNodes([3]); if (n.length > 0) { t.setStart(n[0], 0); var o = n.pop(); return t.setEnd(o, o.length), this.containsRange(t) } return this.containsNodeContents(e) }, getNodes: function (e, t) { return F(this), function (e, t, n) { var o, r = !(!t || !t.length), i = !!n; r && (o = new RegExp("^(" + t.join("|") + ")$")); var s = []; return x(new R(e, !1), function (t) { if ((!r || o.test(t.nodeType)) && (!i || n(t))) { var l = e.startContainer; if (t != l || !a(l) || e.startOffset != l.length) { var c = e.endContainer; t == c && a(c) && 0 == e.endOffset || s.push(t) } } }), s }(this, e, t) }, getDocument: function () { return v(this) }, collapseBefore: function (e) { this.setEndBefore(e), this.collapse(!1) }, collapseAfter: function (e) { this.setStartAfter(e), this.collapse(!0) }, getBookmark: function (t) { var o = v(this), r = e.createRange(o); t = t || n.getBody(o), r.selectNodeContents(t); var i = this.intersection(r), a = 0, s = 0; return i && (r.setEnd(i.startContainer, i.startOffset), s = (a = r.toString().length) + i.toString().length), { start: a, end: s, containerNode: t } }, moveToBookmark: function (e) { var t = e.containerNode, n = 0; this.setStart(t, 0), this.collapse(!0); for (var o, r, i, a, s = [t], l = !1, c = !1; !c && (o = s.pop());)if (3 == o.nodeType) r = n + o.length, !l && e.start >= n && e.start <= r && (this.setStart(o, e.start - n), l = !0), l && e.end >= n && e.end <= r && (this.setEnd(o, e.end - n), c = !0), n = r; else for (i = (a = o.childNodes).length; i--;)s.push(a[i]) }, getName: function () { return "DomRange" }, equals: function (e) { return he.rangesEqual(this, e) }, isValid: function () { return U(this) }, inspect: function () { return T(this) }, detach: function () { } }), ce(he, ue), o.extend(he, { rangeProperties: Q, RangeIterator: R, copyComparisonConstants: se, createPrototypeRange: ce, inspect: T, toHtml: Y, getRangeDocument: v, rangesEqual: function (e, t) { return e.startContainer === t.startContainer && e.startOffset === t.startOffset && e.endContainer === t.endContainer && e.endOffset === t.endOffset } }), e.DomRange = he }), v.createCoreModule("WrappedRange", ["DomRange"], function (e, t) { var n, o, r = e.dom, i = e.util, a = r.DomPosition, s = e.DomRange, l = r.getBody, c = r.getContentDocument, d = r.isCharacterDataNode; if (e.features.implementsDomRange && function () { var o, a, d = s.rangeProperties; function u(e) { for (var t, n = d.length; n--;)e[t = d[n]] = e.nativeRange[t]; e.collapsed = e.startContainer === e.endContainer && e.startOffset === e.endOffset } n = function (e) { if (!e) throw t.createError("WrappedRange: Range must be specified"); this.nativeRange = e, u(this) }, s.createPrototypeRange(n, function (e, t, n, o, r) { var i = e.startContainer !== t || e.startOffset != n, a = e.endContainer !== o || e.endOffset != r, s = !e.equals(e.nativeRange); (i || a || s) && (e.setEnd(o, r), e.setStart(t, n)) }), (o = n.prototype).selectNode = function (e) { this.nativeRange.selectNode(e), u(this) }, o.cloneContents = function () { return this.nativeRange.cloneContents() }, o.surroundContents = function (e) { this.nativeRange.surroundContents(e), u(this) }, o.collapse = function (e) { this.nativeRange.collapse(e), u(this) }, o.cloneRange = function () { return new n(this.nativeRange.cloneRange()) }, o.refresh = function () { u(this) }, o.toString = function () { return this.nativeRange.toString() }; var h = document.createTextNode("test"); l(document).appendChild(h); var f = document.createRange(); f.setStart(h, 0), f.setEnd(h, 0); try { f.setStart(h, 1), o.setStart = function (e, t) { this.nativeRange.setStart(e, t), u(this) }, o.setEnd = function (e, t) { this.nativeRange.setEnd(e, t), u(this) }, a = function (e) { return function (t) { this.nativeRange[e](t), u(this) } } } catch (e) { o.setStart = function (e, t) { try { this.nativeRange.setStart(e, t) } catch (n) { this.nativeRange.setEnd(e, t), this.nativeRange.setStart(e, t) } u(this) }, o.setEnd = function (e, t) { try { this.nativeRange.setEnd(e, t) } catch (n) { this.nativeRange.setStart(e, t), this.nativeRange.setEnd(e, t) } u(this) }, a = function (e, t) { return function (n) { try { this.nativeRange[e](n) } catch (o) { this.nativeRange[t](n), this.nativeRange[e](n) } u(this) } } } o.setStartBefore = a("setStartBefore", "setEndBefore"), o.setStartAfter = a("setStartAfter", "setEndAfter"), o.setEndBefore = a("setEndBefore", "setStartBefore"), o.setEndAfter = a("setEndAfter", "setStartAfter"), o.selectNodeContents = function (e) { this.setStartAndEnd(e, 0, r.getNodeLength(e)) }, f.selectNodeContents(h), f.setEnd(h, 3); var m = document.createRange(); m.selectNodeContents(h), m.setEnd(h, 4), m.setStart(h, 2), -1 == f.compareBoundaryPoints(f.START_TO_END, m) && 1 == f.compareBoundaryPoints(f.END_TO_START, m) ? o.compareBoundaryPoints = function (e, t) { return e == (t = t.nativeRange || t).START_TO_END ? e = t.END_TO_START : e == t.END_TO_START && (e = t.START_TO_END), this.nativeRange.compareBoundaryPoints(e, t) } : o.compareBoundaryPoints = function (e, t) { return this.nativeRange.compareBoundaryPoints(e, t.nativeRange || t) }; var p = document.createElement("div"); p.innerHTML = "123"; var g = p.firstChild, y = l(document); y.appendChild(p), f.setStart(g, 1), f.setEnd(g, 2), f.deleteContents(), "13" == g.data && (o.deleteContents = function () { this.nativeRange.deleteContents(), u(this) }, o.extractContents = function () { var e = this.nativeRange.extractContents(); return u(this), e }), y.removeChild(p), y = null, i.isHostMethod(f, "createContextualFragment") && (o.createContextualFragment = function (e) { return this.nativeRange.createContextualFragment(e) }), l(document).removeChild(h), o.getName = function () { return "WrappedRange" }, e.WrappedRange = n, e.createNativeRange = function (e) { return (e = c(e, t, "createNativeRange")).createRange() } }(), e.features.implementsTextRange) { var u = function (e, t, n, o, i) { var s = e.duplicate(); s.collapse(n); var l = s.parentElement(); if (r.isOrIsAncestorOf(t, l) || (l = t), !l.canHaveHTML) { var c = new a(l.parentNode, r.getNodeIndex(l)); return { boundaryPosition: c, nodeInfo: { nodeIndex: c.offset, containerElement: c.node } } } var u = r.getDocument(l).createElement("span"); u.parentNode && u.parentNode.removeChild(u); for (var h, f, m, p, g, y = n ? "StartToStart" : "StartToEnd", v = i && i.containerElement == l ? i.nodeIndex : 0, w = l.childNodes.length, b = w, C = b; C == w ? l.appendChild(u) : l.insertBefore(u, l.childNodes[C]), s.moveToElementText(u), 0 != (h = s.compareEndPoints(y, e)) && v != b;) { if (-1 == h) { if (b == v + 1) break; v = C } else b = b == v + 1 ? v : C; C = Math.floor((v + b) / 2), l.removeChild(u) } if (g = u.nextSibling, -1 == h && g && d(g)) { var N; if (s.setEndPoint(n ? "EndToStart" : "EndToEnd", e), /[\r\n]/.test(g.data)) { var x = s.duplicate(), E = x.text.replace(/\r\n/g, "\r").length; for (N = x.moveStart("character", E); -1 == (h = x.compareEndPoints("StartToEnd", x));)N++ , x.moveStart("character", 1) } else N = s.text.length; p = new a(g, N) } else f = (o || !n) && u.previousSibling, p = (m = (o || n) && u.nextSibling) && d(m) ? new a(m, 0) : f && d(f) ? new a(f, f.data.length) : new a(l, r.getNodeIndex(u)); return u.parentNode.removeChild(u), { boundaryPosition: p, nodeInfo: { nodeIndex: C, containerElement: l } } }, h = function (e, t) { var n, o, i, a, s = e.offset, c = r.getDocument(e.node), u = l(c).createTextRange(), h = d(e.node); return h ? o = (n = e.node).parentNode : (n = s < (a = e.node.childNodes).length ? a[s] : null, o = e.node), (i = c.createElement("span")).innerHTML = "&#feff;", n ? o.insertBefore(i, n) : o.appendChild(i), u.moveToElementText(i), u.collapse(!t), o.removeChild(i), h && u[t ? "moveStart" : "moveEnd"]("character", s), u }; ((o = function (e) { this.textRange = e, this.refresh() }).prototype = new s(document)).refresh = function () { var e, t, n, o, i = function (e) { var t = e.parentElement(), n = e.duplicate(); n.collapse(!0); var o = n.parentElement(); (n = e.duplicate()).collapse(!1); var i = n.parentElement(), a = o == i ? o : r.getCommonAncestor(o, i); return a == t ? a : r.getCommonAncestor(t, a) }(this.textRange); 0 == (o = this.textRange).compareEndPoints("StartToEnd", o) ? t = e = u(this.textRange, i, !0, !0).boundaryPosition : (e = (n = u(this.textRange, i, !0, !1)).boundaryPosition, t = u(this.textRange, i, !1, !1, n.nodeInfo).boundaryPosition), this.setStart(e.node, e.offset), this.setEnd(t.node, t.offset) }, o.prototype.getName = function () { return "WrappedTextRange" }, s.copyComparisonConstants(o); var f = function (e) { if (e.collapsed) return h(new a(e.startContainer, e.startOffset), !0); var t = h(new a(e.startContainer, e.startOffset), !0), n = h(new a(e.endContainer, e.endOffset), !1), o = l(s.getRangeDocument(e)).createTextRange(); return o.setEndPoint("StartToStart", t), o.setEndPoint("EndToEnd", n), o }; if (o.rangeToTextRange = f, o.prototype.toTextRange = function () { return f(this) }, e.WrappedTextRange = o, !e.features.implementsDomRange || e.config.preferTextRange) { var m = function () { return this }(); void 0 === m.Range && (m.Range = o), e.createNativeRange = function (e) { return e = c(e, t, "createNativeRange"), l(e).createTextRange() }, e.WrappedRange = o } } e.createRange = function (n) { return n = c(n, t, "createRange"), new e.WrappedRange(e.createNativeRange(n)) }, e.createRangyRange = function (e) { return e = c(e, t, "createRangyRange"), new s(e) }, e.createIframeRange = function (n) { return t.deprecationNotice("createIframeRange()", "createRange(iframeEl)"), e.createRange(n) }, e.createIframeRangyRange = function (n) { return t.deprecationNotice("createIframeRangyRange()", "createRangyRange(iframeEl)"), e.createRangyRange(n) }, e.addShimListener(function (t) { var n = t.document; void 0 === n.createRange && (n.createRange = function () { return e.createRange(n) }), n = t = null }) }), v.createCoreModule("WrappedSelection", ["DomRange", "WrappedRange"], function (e, t) { e.config.checkSelectionRanges = !0; var n, o, r = e.dom, i = e.util, a = i.isHostMethod, s = e.DomRange, l = e.WrappedRange, c = e.DOMException, d = r.DomPosition, u = e.features, h = r.getDocument, f = r.getBody, m = s.rangesEqual; function p(e) { return "string" == typeof e ? /^backward(s)?$/i.test(e) : !!e } function g(e, n) { if (e) { if (r.isWindow(e)) return e; if (e instanceof V) return e.win; var o = r.getContentDocument(e, t, n); return r.getWindow(o) } return window } function y(e) { return g(e, "getDocSelection").document.selection } function v(e) { var t = !1; return e.anchorNode && (t = 1 == r.comparePoints(e.anchorNode, e.anchorOffset, e.focusNode, e.focusOffset)), t } var w = a(window, "getSelection"), b = i.isHostObject(document, "selection"); u.implementsWinGetSelection = w, u.implementsDocSelection = b; var C = b && (!w || e.config.preferTextRange); C ? (n = y, e.isSelectionValid = function (e) { var t = g(e, "isSelectionValid").document, n = t.selection; return "None" != n.type || h(n.createRange().parentElement()) == t }) : w ? (n = function (e) { return g(e, "getWinSelection").getSelection() }, e.isSelectionValid = function () { return !0 }) : t.fail("Neither document.selection or window.getSelection() detected."), e.getNativeSelection = n; var N = n(), x = e.createNativeRange(document), E = f(document), S = i.areHostProperties(N, ["anchorNode", "focusNode", "anchorOffset", "focusOffset"]); u.selectionHasAnchorAndFocus = S; var T = a(N, "extend"); u.selectionHasExtend = T; var R = "number" == typeof N.rangeCount; u.selectionHasRangeCount = R; var A = !1, _ = !0, O = T ? function (t, n) { var o = s.getRangeDocument(n), r = e.createRange(o); r.collapseToPoint(n.endContainer, n.endOffset), t.addRange(P(r)), t.extend(n.startContainer, n.startOffset) } : null; i.areHostMethods(N, ["addRange", "getRangeAt", "removeAllRanges"]) && "number" == typeof N.rangeCount && u.implementsDomRange && function () { var t = window.getSelection(); if (t) { for (var n = t.rangeCount, o = n > 1, r = [], i = v(t), a = 0; a < n; ++a)r[a] = t.getRangeAt(a); var s = f(document), l = s.appendChild(document.createElement("div")); l.contentEditable = "false"; var c = l.appendChild(document.createTextNode("   ")), d = document.createRange(); if (d.setStart(c, 1), d.collapse(!0), t.addRange(d), _ = 1 == t.rangeCount, t.removeAllRanges(), !o) { var u = window.navigator.appVersion.match(/Chrome\/(.*?) /); if (u && parseInt(u[1]) >= 36) A = !1; else { var h = d.cloneRange(); d.setStart(c, 0), h.setEnd(c, 3), h.setStart(c, 2), t.addRange(d), t.addRange(h), A = 2 == t.rangeCount } } for (s.removeChild(l), t.removeAllRanges(), a = 0; a < n; ++a)0 == a && i ? O ? O(t, r[a]) : (e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"), t.addRange(r[a])) : t.addRange(r[a]) } }(), u.selectionSupportsMultipleRanges = A, u.collapsedNonEditableSelectionsSupported = _; var I, k, L = !1; function D(e, t, n) { var o = n ? "end" : "start", r = n ? "start" : "end"; e.anchorNode = t[o + "Container"], e.anchorOffset = t[o + "Offset"], e.focusNode = t[r + "Container"], e.focusOffset = t[r + "Offset"] } function M(e) { e.anchorNode = e.focusNode = null, e.anchorOffset = e.focusOffset = 0, e.rangeCount = 0, e.isCollapsed = !0, e._ranges.length = 0 } function P(t) { var n; return t instanceof s ? ((n = e.createNativeRange(t.getDocument())).setEnd(t.endContainer, t.endOffset), n.setStart(t.startContainer, t.startOffset)) : t instanceof l ? n = t.nativeRange : u.implementsDomRange && t instanceof r.getWindow(t.startContainer).Range && (n = t), n } function B(e) { var n = e.getNodes(); if (!function (e) { if (!e.length || 1 != e[0].nodeType) return !1; for (var t = 1, n = e.length; t < n; ++t)if (!r.isAncestorOf(e[0], e[t])) return !1; return !0 }(n)) throw t.createError("getSingleElementFromRange: range " + e.inspect() + " did not consist of a single element"); return n[0] } function H(e) { return !!e && void 0 !== e.text } function z(e, t) { var n = new l(t); e._ranges = [n], D(e, n, !1), e.rangeCount = 1, e.isCollapsed = n.collapsed } function j(t) { if (t._ranges.length = 0, "None" == t.docSelection.type) M(t); else { var n = t.docSelection.createRange(); if (H(n)) z(t, n); else { t.rangeCount = n.length; for (var o, r = h(n.item(0)), i = 0; i < t.rangeCount; ++i)(o = e.createRange(r)).selectNode(n.item(i)), t._ranges.push(o); t.isCollapsed = 1 == t.rangeCount && t._ranges[0].collapsed, D(t, t._ranges[t.rangeCount - 1], !1) } } } function q(e, n) { for (var o = e.docSelection.createRange(), r = B(n), i = h(o.item(0)), a = f(i).createControlRange(), s = 0, l = o.length; s < l; ++s)a.add(o.item(s)); try { a.add(r) } catch (e) { throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)") } a.select(), j(e) } function V(e, t, n) { this.nativeSelection = e, this.docSelection = t, this._ranges = [], this.win = n, this.refresh() } function W(e) { e.win = e.anchorNode = e.focusNode = e._ranges = null, e.rangeCount = e.anchorOffset = e.focusOffset = 0, e.detached = !0 } E && a(E, "createControlRange") && (I = E.createControlRange(), i.areHostProperties(I, ["item", "add"]) && (L = !0)), u.implementsControlRange = L, o = S ? function (e) { return e.anchorNode === e.focusNode && e.anchorOffset === e.focusOffset } : function (e) { return !!e.rangeCount && e.getRangeAt(e.rangeCount - 1).collapsed }, a(N, "getRangeAt") ? k = function (e, t) { try { return e.getRangeAt(t) } catch (e) { return null } } : S && (k = function (t) { var n = h(t.anchorNode), o = e.createRange(n); return o.setStartAndEnd(t.anchorNode, t.anchorOffset, t.focusNode, t.focusOffset), o.collapsed !== this.isCollapsed && o.setStartAndEnd(t.focusNode, t.focusOffset, t.anchorNode, t.anchorOffset), o }), V.prototype = e.selectionPrototype; var U = []; function F(e, t) { for (var n, o, r = U.length; r--;)if (o = (n = U[r]).selection, "deleteAll" == t) W(o); else if (n.win == e) return "delete" == t ? (U.splice(r, 1), !0) : o; return "deleteAll" == t && (U.length = 0), null } var $ = function (e) { if (e && e instanceof V) return e.refresh(), e; var t = F(e = g(e, "getNativeSelection")), o = n(e), r = b ? y(e) : null; return t ? (t.nativeSelection = o, t.docSelection = r, t.refresh()) : (t = new V(o, r, e), U.push({ win: e, selection: t })), t }; e.getSelection = $, e.getIframeSelection = function (n) { return t.deprecationNotice("getIframeSelection()", "getSelection(iframeEl)"), e.getSelection(r.getIframeWindow(n)) }; var K, G = V.prototype; function X(e, n) { for (var o, r = h(n[0].startContainer), i = f(r).createControlRange(), a = 0, s = n.length; a < s; ++a) { o = B(n[a]); try { i.add(o) } catch (e) { throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)") } } i.select(), j(e) } if (!C && S && i.areHostMethods(N, ["removeAllRanges", "addRange"])) { G.removeAllRanges = function () { this.nativeSelection.removeAllRanges(), M(this) }; var Y = function (e, t) { O(e.nativeSelection, t), e.refresh() }; G.addRange = R ? function (t, n) { var r; if (L && b && "Control" == this.docSelection.type) q(this, t); else if (p(n) && T) Y(this, t); else if (A ? r = this.rangeCount : (this.removeAllRanges(), r = 0), this.nativeSelection.addRange(P(t).cloneRange()), this.rangeCount = this.nativeSelection.rangeCount, this.rangeCount == r + 1) { if (e.config.checkSelectionRanges) { var i = k(this.nativeSelection, this.rangeCount - 1); i && !m(i, t) && (t = new l(i)) } this._ranges[this.rangeCount - 1] = t, D(this, t, Q(this.nativeSelection)), this.isCollapsed = o(this) } else this.refresh() } : function (e, t) { p(t) && T ? Y(this, e) : (this.nativeSelection.addRange(P(e)), this.refresh()) }, G.setRanges = function (e) { if (L && b && e.length > 1) X(this, e); else { this.removeAllRanges(); for (var t = 0, n = e.length; t < n; ++t)this.addRange(e[t]) } } } else { if (!(a(N, "empty") && a(x, "select") && L && C)) return t.fail("No means of selecting a Range or TextRange was found"), !1; G.removeAllRanges = function () { try { if (this.docSelection.empty(), "None" != this.docSelection.type) { var e; if (this.anchorNode) e = h(this.anchorNode); else if ("Control" == this.docSelection.type) { var t = this.docSelection.createRange(); t.length && (e = h(t.item(0))) } if (e) f(e).createTextRange().select(), this.docSelection.empty() } } catch (e) { } M(this) }, G.addRange = function (t) { "Control" == this.docSelection.type ? q(this, t) : (e.WrappedTextRange.rangeToTextRange(t).select(), this._ranges[0] = t, this.rangeCount = 1, this.isCollapsed = this._ranges[0].collapsed, D(this, t, !1)) }, G.setRanges = function (e) { this.removeAllRanges(); var t = e.length; t > 1 ? X(this, e) : t && this.addRange(e[0]) } } if (G.getRangeAt = function (e) { if (e < 0 || e >= this.rangeCount) throw new c("INDEX_SIZE_ERR"); return this._ranges[e].cloneRange() }, C) K = function (t) { var n; e.isSelectionValid(t.win) ? n = t.docSelection.createRange() : (n = f(t.win.document).createTextRange()).collapse(!0), "Control" == t.docSelection.type ? j(t) : H(n) ? z(t, n) : M(t) }; else if (a(N, "getRangeAt") && "number" == typeof N.rangeCount) K = function (t) { if (L && b && "Control" == t.docSelection.type) j(t); else if (t._ranges.length = t.rangeCount = t.nativeSelection.rangeCount, t.rangeCount) { for (var n = 0, r = t.rangeCount; n < r; ++n)t._ranges[n] = new e.WrappedRange(t.nativeSelection.getRangeAt(n)); D(t, t._ranges[t.rangeCount - 1], Q(t.nativeSelection)), t.isCollapsed = o(t) } else M(t) }; else { if (!S || "boolean" != typeof N.isCollapsed || "boolean" != typeof x.collapsed || !u.implementsDomRange) return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"), !1; K = function (e) { var t, n = e.nativeSelection; n.anchorNode ? (t = k(n, 0), e._ranges = [t], e.rangeCount = 1, function (e) { var t = e.nativeSelection; e.anchorNode = t.anchorNode, e.anchorOffset = t.anchorOffset, e.focusNode = t.focusNode, e.focusOffset = t.focusOffset }(e), e.isCollapsed = o(e)) : M(e) } } G.refresh = function (e) { var t = e ? this._ranges.slice(0) : null, n = this.anchorNode, o = this.anchorOffset; if (K(this), e) { var r = t.length; if (r != this._ranges.length) return !0; if (this.anchorNode != n || this.anchorOffset != o) return !0; for (; r--;)if (!m(t[r], this._ranges[r])) return !0; return !1 } }; var Q, Z = function (e, t) { var n = e.getAllRanges(); e.removeAllRanges(); for (var o = 0, r = n.length; o < r; ++o)m(t, n[o]) || e.addRange(n[o]); e.rangeCount || M(e) }; function J(e, t) { if (e.win.document != h(t)) throw new c("WRONG_DOCUMENT_ERR") } function ee(t) { return function (n, o) { var r; this.rangeCount ? (r = this.getRangeAt(0))["set" + (t ? "Start" : "End")](n, o) : (r = e.createRange(this.win.document)).setStartAndEnd(n, o), this.setSingleRange(r, this.isBackward()) } } function te(e) { var t = [], n = new d(e.anchorNode, e.anchorOffset), o = new d(e.focusNode, e.focusOffset), r = "function" == typeof e.getName ? e.getName() : "Selection"; if (void 0 !== e.rangeCount) for (var i = 0, a = e.rangeCount; i < a; ++i)t[i] = s.inspect(e.getRangeAt(i)); return "[" + r + "(Ranges: " + t.join(", ") + ")(anchor: " + n.inspect() + ", focus: " + o.inspect() + "]" } G.removeRange = L && b ? function (e) { if ("Control" == this.docSelection.type) { for (var t = this.docSelection.createRange(), n = B(e), o = h(t.item(0)), r = f(o).createControlRange(), i = !1, a = 0, s = t.length; a < s; ++a)t.item(a) !== n || i ? r.add(t.item(a)) : i = !0; r.select(), j(this) } else Z(this, e) } : function (e) { Z(this, e) }, !C && S && u.implementsDomRange ? (Q = v, G.isBackward = function () { return Q(this) }) : Q = G.isBackward = function () { return !1 }, G.isBackwards = G.isBackward, G.toString = function () { for (var e = [], t = 0, n = this.rangeCount; t < n; ++t)e[t] = "" + this._ranges[t]; return e.join("") }, G.collapse = function (t, n) { J(this, t); var o = e.createRange(t); o.collapseToPoint(t, n), this.setSingleRange(o), this.isCollapsed = !0 }, G.collapseToStart = function () { if (!this.rangeCount) throw new c("INVALID_STATE_ERR"); var e = this._ranges[0]; this.collapse(e.startContainer, e.startOffset) }, G.collapseToEnd = function () { if (!this.rangeCount) throw new c("INVALID_STATE_ERR"); var e = this._ranges[this.rangeCount - 1]; this.collapse(e.endContainer, e.endOffset) }, G.selectAllChildren = function (t) { J(this, t); var n = e.createRange(t); n.selectNodeContents(t), this.setSingleRange(n) }, G.deleteFromDocument = function () { if (L && b && "Control" == this.docSelection.type) { for (var e, t = this.docSelection.createRange(); t.length;)e = t.item(0), t.remove(e), e.parentNode.removeChild(e); this.refresh() } else if (this.rangeCount) { var n = this.getAllRanges(); if (n.length) { this.removeAllRanges(); for (var o = 0, r = n.length; o < r; ++o)n[o].deleteContents(); this.addRange(n[r - 1]) } } }, G.eachRange = function (e, t) { for (var n = 0, o = this._ranges.length; n < o; ++n)if (e(this.getRangeAt(n))) return t }, G.getAllRanges = function () { var e = []; return this.eachRange(function (t) { e.push(t) }), e }, G.setSingleRange = function (e, t) { this.removeAllRanges(), this.addRange(e, t) }, G.callMethodOnEachRange = function (e, t) { var n = []; return this.eachRange(function (o) { n.push(o[e].apply(o, t)) }), n }, G.setStart = ee(!0), G.setEnd = ee(!1), e.rangePrototype.select = function (e) { $(this.getDocument()).setSingleRange(this, e) }, G.changeEachRange = function (e) { var t = [], n = this.isBackward(); this.eachRange(function (n) { e(n), t.push(n) }), this.removeAllRanges(), n && 1 == t.length ? this.addRange(t[0], "backward") : this.setRanges(t) }, G.containsNode = function (e, t) { return this.eachRange(function (n) { return n.containsNode(e, t) }, !0) || !1 }, G.getBookmark = function (e) { return { backward: this.isBackward(), rangeBookmarks: this.callMethodOnEachRange("getBookmark", [e]) } }, G.moveToBookmark = function (t) { for (var n, o, r = [], i = 0; n = t.rangeBookmarks[i++];)(o = e.createRange(this.win)).moveToBookmark(n), r.push(o); t.backward ? this.setSingleRange(r[0], "backward") : this.setRanges(r) }, G.toHtml = function () { var e = []; return this.eachRange(function (t) { e.push(s.toHtml(t)) }), e.join("") }, u.implementsTextRange && (G.getNativeTextRange = function () { var n; if (n = this.docSelection) { var o = n.createRange(); if (H(o)) return o; throw t.createError("getNativeTextRange: selection is a control selection") } if (this.rangeCount > 0) return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0)); throw t.createError("getNativeTextRange: selection contains no range") }), G.getName = function () { return "WrappedSelection" }, G.inspect = function () { return te(this) }, G.detach = function () { F(this.win, "delete"), W(this) }, V.detachAll = function () { F(null, "deleteAll") }, V.inspect = te, V.isDirectionBackward = p, e.Selection = V, e.selectionPrototype = G, e.addShimListener(function (e) { void 0 === e.getSelection && (e.getSelection = function () { return $(e) }), e = null }) }), v; C("No document found") } else C("No window found") }, this), function (e, t) { "function" == typeof define && define.amd ? define(["rangy"], e) : e(t.rangy) }(function (e) { e.createModule("SaveRestore", ["WrappedRange"], function (e, t) { var n = e.dom, o = "\ufeff"; function r(e, t) { return (t || document).getElementById(e) } function i(e, t) { var r, i = "selectionBoundary_" + +new Date + "_" + ("" + Math.random()).slice(2), a = n.getDocument(e.startContainer), s = e.cloneRange(); return s.collapse(t), (r = a.createElement("span")).id = i, r.style.lineHeight = "0", r.style.display = "none", r.className = "rangySelectionBoundary", r.appendChild(a.createTextNode(o)), s.insertNode(r), r } function a(e, n, o, i) { var a = r(o, e); a ? (n[i ? "setStartBefore" : "setEndBefore"](a), a.parentNode.removeChild(a)) : t.warn("Marker element has been removed. Cannot restore selection.") } function s(e, t) { return t.compareBoundaryPoints(e.START_TO_START, e) } function l(t, n) { var o, r = e.DomRange.getRangeDocument(t), a = t.toString(); return t.collapsed ? { document: r, markerId: (o = i(t, !1)).id, collapsed: !0 } : (o = i(t, !1), { document: r, startMarkerId: i(t, !0).id, endMarkerId: o.id, collapsed: !1, backward: n, toString: function () { return "original text: '" + a + "', new text: '" + t.toString() + "'" } }) } function c(n, o) { var i = n.document; void 0 === o && (o = !0); var s = e.createRange(i); if (n.collapsed) { var l = r(n.markerId, i); if (l) { l.style.display = "inline"; var c = l.previousSibling; c && 3 == c.nodeType ? (l.parentNode.removeChild(l), s.collapseToPoint(c, c.length)) : (s.collapseBefore(l), l.parentNode.removeChild(l)) } else t.warn("Marker element has been removed. Cannot restore selection.") } else a(i, s, n.startMarkerId, !0), a(i, s, n.endMarkerId, !1); return o && s.normalizeBoundaries(), s } function d(t, n) { var o, i, a = []; (t = t.slice(0)).sort(s); for (var c = 0, d = t.length; c < d; ++c)a[c] = l(t[c], n); for (c = d - 1; c >= 0; --c)o = t[c], i = e.DomRange.getRangeDocument(o), o.collapsed ? o.collapseAfter(r(a[c].markerId, i)) : (o.setEndBefore(r(a[c].endMarkerId, i)), o.setStartAfter(r(a[c].startMarkerId, i))); return a } function u(e) { for (var t = [], n = e.length - 1; n >= 0; n--)t[n] = c(e[n], !0); return t } function h(e, t) { var n = r(t, e); n && n.parentNode.removeChild(n) } e.util.extend(e, { saveRange: l, restoreRange: c, saveRanges: d, restoreRanges: u, saveSelection: function (n) { if (!e.isSelectionValid(n)) return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."), null; var o = e.getSelection(n), r = o.getAllRanges(), i = 1 == r.length && o.isBackward(), a = d(r, i); return i ? o.setSingleRange(r[0], "backward") : o.setRanges(r), { win: n, rangeInfos: a, restored: !1 } }, restoreSelection: function (t, n) { if (!t.restored) { var o = t.rangeInfos, r = e.getSelection(t.win), i = u(o); 1 == o.length && n && e.features.selectionHasExtend && o[0].backward ? (r.removeAllRanges(), r.addRange(i[0], !0)) : r.setRanges(i), t.restored = !0 } }, removeMarkerElement: h, removeMarkers: function (e) { for (var t, n = e.rangeInfos, o = 0, r = n.length; o < r; ++o)(t = n[o]).collapsed ? h(e.doc, t.markerId) : (h(e.doc, t.startMarkerId), h(e.doc, t.endMarkerId)) } }) }) }, this); var Base = function () { }; Base.extend = function (e, t) { var n = Base.prototype.extend; Base._prototyping = !0; var o = new this; n.call(o, e), o.base = function () { }, delete Base._prototyping; var r = o.constructor, i = o.constructor = function () { if (!Base._prototyping) if (this._constructing || this.constructor == i) this._constructing = !0, r.apply(this, arguments), delete this._constructing; else if (null != arguments[0]) return (arguments[0].extend || n).call(arguments[0], o) }; return i.ancestor = this, i.extend = this.extend, i.forEach = this.forEach, i.implement = this.implement, i.prototype = o, i.toString = this.toString, i.valueOf = function (e) { return "object" == e ? i : r.valueOf() }, n.call(i, t), "function" == typeof i.init && i.init(), i }, Base.prototype = { extend: function (e, t) { if (arguments.length > 1) { var n = this[e]; if (n && "function" == typeof t && (!n.valueOf || n.valueOf() != t.valueOf()) && /\bbase\b/.test(t)) { var o = t.valueOf(); (t = function () { var e = this.base || Base.prototype.base; this.base = n; var t = o.apply(this, arguments); return this.base = e, t }).valueOf = function (e) { return "object" == e ? t : o }, t.toString = Base.toString } this[e] = t } else if (e) { var r = Base.prototype.extend; Base._prototyping || "function" == typeof this || (r = this.extend || r); for (var i = { toSource: null }, a = ["constructor", "toString", "valueOf"], s = Base._prototyping ? 0 : 1; l = a[s++];)e[l] != i[l] && r.call(this, l, e[l]); for (var l in e) i[l] || r.call(this, l, e[l]) } return this } }, Base = Base.extend({ constructor: function () { this.extend(arguments[0]) } }, { ancestor: Object, version: "1.1", forEach: function (e, t, n) { for (var o in e) void 0 === this.prototype[o] && t.call(n, e[o], o, e) }, implement: function () { for (var e = 0; e < arguments.length; e++)"function" == typeof arguments[e] ? arguments[e](this.prototype) : this.prototype.extend(arguments[e]); return this }, toString: function () { return String(this.valueOf()) } }), wysihtml5.browser = function () { var e, t, n = navigator.userAgent, o = document.createElement("div"), r = -1 !== n.indexOf("Gecko") && -1 === n.indexOf("KHTML"), i = -1 !== n.indexOf("AppleWebKit/"), a = -1 !== n.indexOf("Chrome/"), s = -1 !== n.indexOf("Opera/"); function l(e, t) { var n, o = -1; return "Microsoft Internet Explorer" == navigator.appName ? n = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})") : "Netscape" == navigator.appName && (n = new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")), n && null != n.exec(navigator.userAgent) && (o = parseFloat(RegExp.$1)), -1 !== o && (!e || (t ? "<" === t ? e < o : ">" === t ? e > o : "<=" === t ? e <= o : ">=" === t ? e >= o : void 0 : e === o)) } return { USER_AGENT: n, supported: function () { var e = this.USER_AGENT.toLowerCase(), t = "contentEditable" in o, n = document.execCommand && document.queryCommandSupported && document.queryCommandState, r = document.querySelector && document.querySelectorAll, i = this.isIos() && function (e) { return +(/ipad|iphone|ipod/.test(e) && e.match(/ os (\d+).+? like mac os x/) || [void 0, 0])[1] }(e) < 5 || this.isAndroid() && function (e) { return +(e.match(/android (\d+)/) || [void 0, 0])[1] }(e) < 4 || -1 !== e.indexOf("opera mobi") || -1 !== e.indexOf("hpwos/"); return t && n && r && !i }, isTouchDevice: function () { return this.supportsEvent("touchmove") }, isIos: function () { return /ipad|iphone|ipod/i.test(this.USER_AGENT) }, isAndroid: function () { return -1 !== this.USER_AGENT.indexOf("Android") }, supportsSandboxedIframes: function () { return l() }, throwsMixedContentWarningWhenIframeSrcIsEmpty: function () { return !("querySelector" in document) }, displaysCaretInEmptyContentEditableCorrectly: function () { return l() }, hasCurrentStyleProperty: function () { return "currentStyle" in o }, hasHistoryIssue: function () { return r && "Mac" === navigator.platform.substr(0, 3) }, insertsLineBreaksOnReturn: function () { return r }, supportsPlaceholderAttributeOn: function (e) { return "placeholder" in e }, supportsEvent: function (e) { return "on" + e in o || (o.setAttribute("on" + e, "return;"), "function" == typeof o["on" + e]) }, supportsEventsInIframeCorrectly: function () { return !s }, supportsHTML5Tags: function (e) { var t = e.createElement("div"), n = "<article>foo</article>"; return t.innerHTML = n, t.innerHTML.toLowerCase() === n }, supportsCommand: (e = { formatBlock: l(10, "<="), insertUnorderedList: l(), insertOrderedList: l() }, t = { insertHTML: r }, function (n, o) { if (!e[o]) { try { return n.queryCommandSupported(o) } catch (e) { } try { return n.queryCommandEnabled(o) } catch (e) { return !!t[o] } } return !1 }), doesAutoLinkingInContentEditable: function () { return l() }, canDisableAutoLinking: function () { return this.supportsCommand(document, "AutoUrlDetect") }, clearsContentEditableCorrectly: function () { return r || s || i }, supportsGetAttributeCorrectly: function () { return "1" != document.createElement("td").getAttribute("rowspan") }, canSelectImagesInContentEditable: function () { return r || l() || s }, autoScrollsToCaret: function () { return !i }, autoClosesUnclosedTags: function () { var e, t, n = o.cloneNode(!1); return n.innerHTML = "<p><div></div>", t = n.innerHTML.toLowerCase(), e = "<p></p><div></div>" === t || "<p><div></div></p>" === t, this.autoClosesUnclosedTags = function () { return e }, e }, supportsNativeGetElementsByClassName: function () { return -1 !== String(document.getElementsByClassName).indexOf("[native code]") }, supportsSelectionModify: function () { return "getSelection" in window && "modify" in window.getSelection() }, needsSpaceAfterLineBreak: function () { return s }, supportsSpeechApiOn: function (e) { return (n.match(/Chrome\/(\d+)/) || [void 0, 0])[1] >= 11 && ("onwebkitspeechchange" in e || "speech" in e) }, crashesWhenDefineProperty: function (e) { return l(9) && ("XMLHttpRequest" === e || "XDomainRequest" === e) }, doesAsyncFocus: function () { return l() }, hasProblemsSettingCaretAfterImg: function () { return l() }, hasUndoInContextMenu: function () { return r || a || s }, hasInsertNodeIssue: function () { return s }, hasIframeFocusIssue: function () { return l() }, createsNestedInvalidMarkupAfterPaste: function () { return i }, supportsMutationEvents: function () { return "MutationEvent" in window }, supportsModenPaste: function () { return !("clipboardData" in window) } } }(), wysihtml5.lang.array = function (e) { return { contains: function (t) { if (Array.isArray(t)) { for (var n = t.length; n--;)if (-1 !== wysihtml5.lang.array(e).indexOf(t[n])) return !0; return !1 } return -1 !== wysihtml5.lang.array(e).indexOf(t) }, indexOf: function (t) { if (e.indexOf) return e.indexOf(t); for (var n = 0, o = e.length; n < o; n++)if (e[n] === t) return n; return -1 }, without: function (t) { t = wysihtml5.lang.array(t); for (var n = [], o = 0, r = e.length; o < r; o++)t.contains(e[o]) || n.push(e[o]); return n }, get: function () { for (var t = 0, n = e.length, o = []; t < n; t++)o.push(e[t]); return o }, map: function (t, n) { if (Array.prototype.map) return e.map(t, n); for (var o = e.length >>> 0, r = new Array(o), i = 0; i < o; i++)r[i] = t.call(n, e[i], i, e); return r }, unique: function () { for (var t = [], n = e.length, o = 0; o < n;)wysihtml5.lang.array(t).contains(e[o]) || t.push(e[o]), o++; return t } } }, wysihtml5.lang.Dispatcher = Base.extend({ on: function (e, t) { return this.events = this.events || {}, this.events[e] = this.events[e] || [], this.events[e].push(t), this }, off: function (e, t) { this.events = this.events || {}; var n, o, r = 0; if (e) { for (n = this.events[e] || [], o = []; r < n.length; r++)n[r] !== t && t && o.push(n[r]); this.events[e] = o } else this.events = {}; return this }, fire: function (e, t) { this.events = this.events || {}; for (var n = this.events[e] || [], o = 0; o < n.length; o++)n[o].call(this, t); return this }, observe: function () { return this.on.apply(this, arguments) }, stopObserving: function () { return this.off.apply(this, arguments) } }), wysihtml5.lang.object = function (e) { return { merge: function (t) { for (var n in t) e[n] = t[n]; return this }, get: function () { return e }, clone: function (t) { var n, o = {}; if (null === e || !wysihtml5.lang.object(e).isPlainObject()) return e; for (n in e) e.hasOwnProperty(n) && (o[n] = t ? wysihtml5.lang.object(e[n]).clone(t) : e[n]); return o }, isArray: function () { return "[object Array]" === Object.prototype.toString.call(e) }, isFunction: function () { return "[object Function]" === Object.prototype.toString.call(e) }, isPlainObject: function () { return "[object Object]" === Object.prototype.toString.call(e) } } }, function () { var e = /^\s+/, t = /\s+$/, n = /[&<>\t"]/g, o = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "\t": "&nbsp; " }; wysihtml5.lang.string = function (r) { return r = String(r), { trim: function () { return r.replace(e, "").replace(t, "") }, interpolate: function (e) { for (var t in e) r = this.replace("#{" + t + "}").by(e[t]); return r }, replace: function (e) { return { by: function (t) { return r.split(e).join(t) } } }, escapeHTML: function (e, t) { var i = r.replace(n, function (e) { return o[e] }); return e && (i = i.replace(/(?:\r\n|\r|\n)/g, "<br />")), t && (i = i.replace(/  /gi, "&nbsp; ")), i } } } }(), function (e) { var t = e.lang.array(["CODE", "PRE", "A", "SCRIPT", "HEAD", "TITLE", "STYLE"]), n = /((https?:\/\/|www\.)[^\s<]{3,})/gi, o = /([^\w\/\-](,?))$/i, r = 100, i = { ")": "(", "]": "[", "}": "{" }; e.dom.autoLink = function (a, s) { return function (n, o) { for (var r; n.parentNode;) { if (n = n.parentNode, r = n.nodeName, n.className && e.lang.array(n.className.split(" ")).contains(o)) return !0; if (t.contains(r)) return !0; if ("body" === r) return !1 } return !1 }(a, s) ? a : (a === a.ownerDocument.documentElement && (a = a.ownerDocument.body), function a(s, l) { if (!(t.contains(s.nodeName) || s.className && e.lang.array(s.className.split(" ")).contains(l))) { if (s.nodeType !== e.TEXT_NODE || !s.data.match(n)) { for (var c = e.lang.array(s.childNodes).get(), d = c.length, u = 0; u < d; u++)a(c[u], l); return s } !function (t) { var a = t.parentNode, s = e.lang.string(t.data).escapeHTML(), l = function (e) { var t = e._wysihtml5_tempElement; return t || (t = e._wysihtml5_tempElement = e.createElement("div")), t }(a.ownerDocument); for (l.innerHTML = "<span></span>" + s.replace(n, function (e, t) { var n = (t.match(o) || [])[1] || "", a = i[n]; (t = t.replace(o, "")).split(a).length > t.split(n).length && (t += n, n = ""); var s = t, l = t; return t.length > r && (l = l.substr(0, r) + "..."), "www." === s.substr(0, 4) && (s = "http://" + s), '<a href="' + s + '">' + l + "</a>" + n }), l.removeChild(l.firstChild); l.firstChild;)a.insertBefore(l.firstChild, t); a.removeChild(t) }(s) } }(a, s)) }, e.dom.autoLink.URL_REG_EXP = n }(wysihtml5), function (e) { var t = e.dom; t.addClass = function (e, n) { var o = e.classList; if (o) return o.add(n); t.hasClass(e, n) || (e.className += " " + n) }, t.removeClass = function (e, t) { var n = e.classList; if (n) return n.remove(t); e.className = e.className.replace(new RegExp("(^|\\s+)" + t + "(\\s+|$)"), " ") }, t.hasClass = function (e, t) { var n = e.classList; if (n) return n.contains(t); var o = e.className; return o.length > 0 && (o == t || new RegExp("(^|\\s)" + t + "(\\s|$)").test(o)) } }(wysihtml5), wysihtml5.dom.contains = function () { var e = document.documentElement; return e.contains ? function (e, t) { return t.nodeType !== wysihtml5.ELEMENT_NODE && (t = t.parentNode), e !== t && e.contains(t) } : e.compareDocumentPosition ? function (e, t) { return !!(16 & e.compareDocumentPosition(t)) } : void 0 }(), wysihtml5.dom.convertToList = function () { function e(e, t) { var n = e.createElement("li"); return t.appendChild(n), n } return function (t, n, o) { if ("UL" === t.nodeName || "OL" === t.nodeName || "MENU" === t.nodeName) return t; var r, i, a, s, l, c, d, u, h, f = t.ownerDocument, m = function (e, t) { return e.createElement(t) }(f, n), p = t.querySelectorAll("br"), g = p.length; for (h = 0; h < g; h++)for (s = p[h]; (l = s.parentNode) && l !== t && l.lastChild === s;) { if ("block" === wysihtml5.dom.getStyle("display").from(l)) { l.removeChild(s); break } wysihtml5.dom.insert(s).after(s.parentNode) } for (i = (r = wysihtml5.lang.array(t.childNodes).get()).length, h = 0; h < i; h++)u = u || e(f, m), a = r[h], c = "block" === wysihtml5.dom.getStyle("display").from(a), d = "BR" === a.nodeName, !c || o && wysihtml5.dom.hasClass(a, o) ? d ? u = u.firstChild ? null : u : u.appendChild(a) : ((u = u.firstChild ? e(f, m) : u).appendChild(a), u = null); return 0 === r.length && e(f, m), t.parentNode.replaceChild(m, t), m } }(), wysihtml5.dom.copyAttributes = function (e) { return { from: function (t) { return { to: function (n) { for (var o, r = 0, i = e.length; r < i; r++)o = e[r], void 0 !== t[o] && "" !== t[o] && (n[o] = t[o]); return { andTo: arguments.callee } } } } } }, function (e) { var t = ["-webkit-box-sizing", "-moz-box-sizing", "-ms-box-sizing", "box-sizing"], n = function (n) { for (var o = 0, r = t.length; o < r; o++)if ("border-box" === e.getStyle(t[o]).from(n)) return t[o] }; e.copyStyles = function (o) { return { from: function (r) { (function (t) { return !!n(t) && parseInt(e.getStyle("width").from(t), 10) < t.offsetWidth })(r) && (o = wysihtml5.lang.array(o).without(t)); for (var i, a = "", s = o.length, l = 0; l < s; l++)i = o[l], a += i + ":" + e.getStyle(i).from(r) + ";"; return { to: function (t) { return e.setStyles(a).on(t), { andTo: arguments.callee } } } } } } }(wysihtml5.dom), function (e) { e.dom.delegate = function (t, n, o, r) { return e.dom.observe(t, o, function (o) { for (var i = o.target, a = e.lang.array(t.querySelectorAll(n)); i && i !== t;) { if (a.contains(i)) { r.call(i, o); break } i = i.parentNode } }) } }(wysihtml5), function (e) { e.dom.domNode = function (t) { var n = [e.ELEMENT_NODE, e.TEXT_NODE], o = function (t) { return t.nodeType === e.TEXT_NODE && /^\s*$/g.test(t.data) }; return { prev: function (r) { var i = t.previousSibling, a = r && r.nodeTypes ? r.nodeTypes : n; return i ? !e.lang.array(a).contains(i.nodeType) || r && r.ignoreBlankTexts && o(i) ? e.dom.domNode(i).prev(r) : i : null }, next: function (r) { var i = t.nextSibling, a = r && r.nodeTypes ? r.nodeTypes : n; return i ? !e.lang.array(a).contains(i.nodeType) || r && r.ignoreBlankTexts && o(i) ? e.dom.domNode(i).next(r) : i : null } } } }(wysihtml5), wysihtml5.dom.getAsDom = function () { var e = ["abbr", "article", "aside", "audio", "bdi", "canvas", "command", "datalist", "details", "figcaption", "figure", "footer", "header", "hgroup", "keygen", "mark", "meter", "nav", "output", "progress", "rp", "rt", "ruby", "svg", "section", "source", "summary", "time", "track", "video", "wbr"]; return function (t, n) { var o; return n = n || document, "object" == typeof t && t.nodeType ? (o = n.createElement("div")).appendChild(t) : wysihtml5.browser.supportsHTML5Tags(n) ? (o = n.createElement("div")).innerHTML = t : (!function (t) { if (!t._wysihtml5_supportsHTML5Tags) { for (var n = 0, o = e.length; n < o; n++)t.createElement(e[n]); t._wysihtml5_supportsHTML5Tags = !0 } }(n), o = function (e, t) { var n = t.createElement("div"); n.style.display = "none", t.body.appendChild(n); try { n.innerHTML = e } catch (e) { } return t.body.removeChild(n), n }(t, n)), o } }(), wysihtml5.dom.getParentElement = function () { function e(e) { return e.nodeType === wysihtml5.ELEMENT_NODE } function t(e, t, n) { var o = (e.className || "").match(n) || []; return t ? o[o.length - 1] === t : !!o.length } return function (n, o, r, i) { var a, s, l, c, d, u, h = o.cssStyle || o.styleRegExp, f = o.className || o.classRegExp; for (r = r || 50; r-- && n && "BODY" !== n.nodeName && (!i || n !== i);) { if (e(n) && (d = n.nodeName, !(u = o.nodeName) || !u.length || ("string" == typeof u ? d === u : wysihtml5.lang.array(u).contains(d))) && (!h || (a = n, s = o.cssStyle, l = o.styleRegExp, c = void 0, c = (a.getAttribute("style") || "").match(l) || [], s ? c[c.length - 1] === s : c.length)) && (!f || t(n, o.className, o.classRegExp))) return n; n = n.parentNode } return null } }(), wysihtml5.dom.getStyle = function () { var e = { float: "styleFloat" in document.createElement("div").style ? "styleFloat" : "cssFloat" }, t = /\-[a-z]/g; return function (n) { return { from: function (o) { if (o.nodeType === wysihtml5.ELEMENT_NODE) { var r = o.ownerDocument, i = e[n] || n.replace(t, function (e) { return e.charAt(1).toUpperCase() }), a = o.style, s = o.currentStyle, l = a[i]; if (l) return l; if (s) try { return s[i] } catch (e) { } var c, d, u = r.defaultView || r.parentWindow, h = ("height" === n || "width" === n) && "TEXTAREA" === o.nodeName; return u.getComputedStyle ? (h && (c = a.overflow, a.overflow = "hidden"), d = u.getComputedStyle(o, null).getPropertyValue(n), h && (a.overflow = c || ""), d) : void 0 } } } } }(), wysihtml5.dom.getTextNodes = function (e, t) { var n = []; for (e = e.firstChild; e; e = e.nextSibling)3 == e.nodeType ? t && /^\s*$/.test(e.innerText || e.textContent) || n.push(e) : n = n.concat(wysihtml5.dom.getTextNodes(e, t)); return n }, wysihtml5.dom.hasElementWithTagName = function () { var e = {}, t = 1; return function (n, o) { var r = function (e) { return e._wysihtml5_identifier || (e._wysihtml5_identifier = t++) }(n) + ":" + o, i = e[r]; return i || (i = e[r] = n.getElementsByTagName(o)), i.length > 0 } }(), function (e) { var t = {}, n = 1; e.dom.hasElementWithClassName = function (o, r) { if (!e.browser.supportsNativeGetElementsByClassName()) return !!o.querySelector("." + r); var i = function (e) { return e._wysihtml5_identifier || (e._wysihtml5_identifier = n++) }(o) + ":" + r, a = t[i]; return a || (a = t[i] = o.getElementsByClassName(r)), a.length > 0 } }(wysihtml5), wysihtml5.dom.insert = function (e) { return { after: function (t) { t.parentNode.insertBefore(e, t.nextSibling) }, before: function (t) { t.parentNode.insertBefore(e, t) }, into: function (t) { t.appendChild(e) } } }, wysihtml5.dom.insertCSS = function (e) { return e = e.join("\n"), { into: function (t) { var n = t.createElement("style"); n.type = "text/css", n.styleSheet ? n.styleSheet.cssText = e : n.appendChild(t.createTextNode(e)); var o = t.querySelector("head link"); if (o) o.parentNode.insertBefore(n, o); else { var r = t.querySelector("head"); r && r.appendChild(n) } } } }, function (e) { e.dom.lineBreaks = function (t) { function n(e) { return "BR" === e.nodeName } function o(t) { return !!n(t) || "block" === e.dom.getStyle("display").from(t) } return { add: function (n) { var r = t.ownerDocument, i = e.dom.domNode(t).next({ ignoreBlankTexts: !0 }), a = e.dom.domNode(t).prev({ ignoreBlankTexts: !0 }); i && !o(i) && e.dom.insert(r.createElement("br")).after(t), a && !o(a) && e.dom.insert(r.createElement("br")).before(t) }, remove: function (o) { var r = e.dom.domNode(t).next({ ignoreBlankTexts: !0 }), i = e.dom.domNode(t).prev({ ignoreBlankTexts: !0 }); r && n(r) && r.parentNode.removeChild(r), i && n(i) && i.parentNode.removeChild(i) } } } }(wysihtml5), wysihtml5.dom.observe = function (e, t, n) { for (var o, r, i = 0, a = (t = "string" == typeof t ? [t] : t).length; i < a; i++)r = t[i], e.addEventListener ? e.addEventListener(r, n, !1) : (o = function (t) { "target" in t || (t.target = t.srcElement), t.preventDefault = t.preventDefault || function () { this.returnValue = !1 }, t.stopPropagation = t.stopPropagation || function () { this.cancelBubble = !0 }, n.call(e, t) }, e.attachEvent("on" + r, o)); return { stop: function () { for (var r, i = 0, a = t.length; i < a; i++)r = t[i], e.removeEventListener ? e.removeEventListener(r, n, !1) : e.detachEvent("on" + r, o) } } }, wysihtml5.dom.parse = function (e, t) { var n = { 1: function (e, t) { var n, i, s, u = a.tags, h = e.nodeName.toLowerCase(), f = e.scopeName; if (e._wysihtml5) return null; if (e._wysihtml5 = 1, "wysihtml5-temp" === e.className) return null; f && "HTML" != f && (h = f + ":" + h); "outerHTML" in e && (wysihtml5.browser.autoClosesUnclosedTags() || "P" !== e.nodeName || "</p>" === e.outerHTML.slice(-4).toLowerCase() || (h = "div")); if (h in u) { if (!(n = u[h]) || n.remove) return null; if (n.unwrap) return !1; n = "string" == typeof n ? { rename_tag: n } : n } else { if (!e.firstChild) return null; n = { rename_tag: o } } if (n.one_of_type && !function (e, t, n, o) { var r, i; if ("SPAN" === e.nodeName && !o && ("_wysihtml5-temp-placeholder" === e.className || "rangySelectionBoundary" === e.className)) return !0; for (i in n) if (n.hasOwnProperty(i) && t.type_definitions && t.type_definitions[i] && (r = t.type_definitions[i], l(e, r))) return !0; return !1 }(e, a, n.one_of_type, t)) { if (!n.remove_action) return null; if ("unwrap" === n.remove_action) return !1; if ("rename" !== n.remove_action) return null; s = n.remove_action_rename_to || o } i = e.ownerDocument.createElement(s || n.rename_tag || h), function (e, t, n, o) { var i, s, l, u, h, f = {}, m = n.set_class, p = n.add_class, g = n.add_style, w = n.set_attributes, b = a.classes, C = 0, N = [], x = [], E = [], S = []; w && (f = wysihtml5.lang.object(w).clone()); f = wysihtml5.lang.object(f).merge(function (e, t) { var n, o, r, i = wysihtml5.lang.object(a.attributes || {}).clone(), s = wysihtml5.lang.object(i).merge(wysihtml5.lang.object(t || {}).clone()).get(), l = {}, u = wysihtml5.dom.getAttributes(e); for (n in s) if (/\*$/.test(n)) { r = c(n.slice(0, -1), u); for (var h = 0, f = r.length; h < f; h++)!1 !== (o = d(r[h], u[r[h]], s[n], e.nodeName)) && (l[r[h]] = o) } else !1 !== (o = d(n, u[n], s[n], e.nodeName)) && (l[n] = o); return l }(e, n.check_attributes)).get(), m && N.push(m); if (p) for (u in p) (h = v[p[u]]) && "string" == typeof (l = h(wysihtml5.dom.getAttribute(e, u))) && N.push(l); if (g) for (u in g) (h = y[g[u]]) && (newStyle = h(wysihtml5.dom.getAttribute(e, u)), "string" == typeof newStyle && x.push(newStyle)); if ("string" == typeof b && "any" === b && e.getAttribute("class")) if (a.classes_blacklist) { for ((S = e.getAttribute("class")) && (N = N.concat(S.split(r))), i = N.length; C < i; C++)s = N[C], a.classes_blacklist[s] || E.push(s); E.length && (f.class = wysihtml5.lang.array(E).unique().join(" ")) } else f.class = e.getAttribute("class"); else { for (o || (b["_wysihtml5-temp-placeholder"] = 1, b._rangySelectionBoundary = 1, b["wysiwyg-tmp-selected-cell"] = 1), (S = e.getAttribute("class")) && (N = N.concat(S.split(r))), i = N.length; C < i; C++)s = N[C], b[s] && E.push(s); E.length && (f.class = wysihtml5.lang.array(E).unique().join(" ")) } f.class && o && (f.class = f.class.replace("wysiwyg-tmp-selected-cell", ""), /^\s*$/g.test(f.class) && delete f.class); x.length && (f.style = wysihtml5.lang.array(x).unique().join(" ")); for (u in f) try { t.setAttribute(u, f[u]) } catch (e) { } f.src && (void 0 !== f.width && t.setAttribute("width", f.width), void 0 !== f.height && t.setAttribute("height", f.height)) }(e, i, n, t), function (e, t, n) { var o, r; if (n && n.keep_styles) for (o in n.keep_styles) if (n.keep_styles.hasOwnProperty(o)) { if (r = "float" === o ? e.style.styleFloat || e.style.cssFloat : e.style[o], n.keep_styles[o] instanceof RegExp && !n.keep_styles[o].test(r)) continue; "float" === o ? t.style[e.style.styleFloat ? "styleFloat" : "cssFloat"] = r : e.style[o] && (t.style[o] = r) } }(e, i, n), e = null, i.normalize && i.normalize(); return i }, 3: function (e) { var t = e.nextSibling; if (!t || t.nodeType !== wysihtml5.TEXT_NODE) { var n = e.data.replace(u, ""); return e.ownerDocument.createTextNode(n) } t.data = e.data.replace(u, "") + t.data.replace(u, "") }, 8: function (e) { if (a.comments) return e.ownerDocument.createComment(e.nodeValue) } }, o = "span", r = /\s+/, i = { tags: {}, classes: {} }, a = {}; function s(e, t, r, i) { var a, l, c, d = e.nodeType, u = e.childNodes, h = u.length, f = n[d], m = 0; if (i && 1 === d && wysihtml5.dom.hasClass(e, i)) return e; if (!(l = f && f(e, r))) { if (!1 === l) { for (a = e.ownerDocument.createDocumentFragment(), m = h; m--;)u[m] && (c = s(u[m], t, r, i)) && (u[m] === c && m-- , a.insertBefore(c, a.firstChild)); return "block" === wysihtml5.dom.getStyle("display").from(e) && a.appendChild(e.ownerDocument.createElement("br")), wysihtml5.lang.array(["div", "pre", "p", "table", "td", "th", "ul", "ol", "li", "dd", "dl", "footer", "header", "section", "h1", "h2", "h3", "h4", "h5", "h6"]).contains(e.nodeName.toLowerCase()) && e.parentNode.lastChild !== e && (e.nextSibling && 3 === e.nextSibling.nodeType && /^\s/.test(e.nextSibling.nodeValue) || a.appendChild(e.ownerDocument.createTextNode(" "))), a.normalize && a.normalize(), a } return null } for (m = 0; m < h; m++)u[m] && (c = s(u[m], t, r, i)) && (u[m] === c && m-- , l.appendChild(c)); if (t && l.nodeName.toLowerCase() === o && (!l.childNodes.length || /^\s*$/gi.test(l.innerHTML) && (r || "_wysihtml5-temp-placeholder" !== e.className && "rangySelectionBoundary" !== e.className) || !l.attributes.length)) { for (a = l.ownerDocument.createDocumentFragment(); l.firstChild;)a.appendChild(l.firstChild); return a.normalize && a.normalize(), a } return l.normalize && l.normalize(), l } function l(e, t) { var n, o, i, a, s, l = e.getAttribute("class"), c = e.getAttribute("style"); if (t.methods) for (var d in t.methods) if (t.methods.hasOwnProperty(d) && w[d] && w[d](e)) return !0; if (l && t.classes) { n = (l = l.replace(/^\s+/g, "").replace(/\s+$/g, "").split(r)).length; for (var u = 0; u < n; u++)if (t.classes[l[u]]) return !0 } if (c && t.styles) for (o in c = c.split(";"), t.styles) if (t.styles.hasOwnProperty(o)) for (var h = c.length; h--;)if ((s = c[h].split(":"))[0].replace(/\s/g, "").toLowerCase() === o && (!0 === t.styles[o] || 1 === t.styles[o] || wysihtml5.lang.array(t.styles[o]).contains(s[1].replace(/\s/g, "").toLowerCase()))) return !0; if (t.attrs) for (i in t.attrs) if (t.attrs.hasOwnProperty(i) && "string" == typeof (a = wysihtml5.dom.getAttribute(e, i)) && a.search(t.attrs[i]) > -1) return !0; return !1 } function c(e, t) { var n = []; for (var o in t) t.hasOwnProperty(o) && 0 === o.indexOf(e) && n.push(o); return n } function d(e, t, n, o) { var r, i = g[n]; return !(!i || !(t || "alt" === e && "IMG" == o) || "string" != typeof (r = i(t))) && r } var u = /\uFEFF/g; var h, f, m, p, g = { url: (h = /^https?:\/\//i, function (e) { return e && e.match(h) ? e.replace(h, function (e) { return e.toLowerCase() }) : null }), src: function () { var e = /^(\/|https?:\/\/)/i; return function (t) { return t && t.match(e) ? t.replace(e, function (e) { return e.toLowerCase() }) : null } }(), href: function () { var e = /^(#|\/|https?:\/\/|mailto:)/i; return function (t) { return t && t.match(e) ? t.replace(e, function (e) { return e.toLowerCase() }) : null } }(), alt: function () { var e = /[^ a-z0-9_\-]/gi; return function (t) { return t ? t.replace(e, "") : "" } }(), numbers: function () { var e = /\D/g; return function (t) { return (t = (t || "").replace(e, "")) || null } }(), any: function (e) { return e } }, y = { align_text: (f = { left: "text-align: left;", right: "text-align: right;", center: "text-align: center;" }, function (e) { return f[String(e).toLowerCase()] }) }, v = { align_img: function () { var e = { left: "wysiwyg-float-left", right: "wysiwyg-float-right" }; return function (t) { return e[String(t).toLowerCase()] } }(), align_text: function () { var e = { left: "wysiwyg-text-align-left", right: "wysiwyg-text-align-right", center: "wysiwyg-text-align-center", justify: "wysiwyg-text-align-justify" }; return function (t) { return e[String(t).toLowerCase()] } }(), clear_br: function () { var e = { left: "wysiwyg-clear-left", right: "wysiwyg-clear-right", both: "wysiwyg-clear-both", all: "wysiwyg-clear-both" }; return function (t) { return e[String(t).toLowerCase()] } }(), size_font: function () { var e = { 1: "wysiwyg-font-size-xx-small", 2: "wysiwyg-font-size-small", 3: "wysiwyg-font-size-medium", 4: "wysiwyg-font-size-large", 5: "wysiwyg-font-size-x-large", 6: "wysiwyg-font-size-xx-large", 7: "wysiwyg-font-size-xx-large", "-": "wysiwyg-font-size-smaller", "+": "wysiwyg-font-size-larger" }; return function (t) { return e[String(t).charAt(0)] } }() }, w = { has_visible_contet: (p = ["img", "video", "picture", "br", "script", "noscript", "style", "table", "iframe", "object", "embed", "audio", "svg", "input", "button", "select", "textarea", "canvas"], function (e) { if ((m = (e.innerText || e.textContent).replace(/\s/g, "")) && m.length > 0) return !0; for (var t = p.length; t--;)if (e.querySelector(p[t])) return !0; return !!(e.offsetWidth && e.offsetWidth > 0 && e.offsetHeight && e.offsetHeight > 0) }) }, b = { unwrap: function (e) { wysihtml5.dom.unwrap(e) }, remove: function (e) { e.parentNode.removeChild(e) } }; return function (e, t) { wysihtml5.lang.object(a).merge(i).merge(t.rules).get(); var n, o, r, l = t.context || e.ownerDocument || document, c = l.createDocumentFragment(), d = "string" == typeof e, u = !1; for (!0 === t.clearInternals && (u = !0), n = d ? wysihtml5.dom.getAsDom(e, l) : e, a.selectors && function (e, t) { var n, o, r; for (n in t) if (t.hasOwnProperty(n)) { wysihtml5.lang.object(t[n]).isFunction() ? o = t[n] : "string" == typeof t[n] && b[t[n]] && (o = b[t[n]]); for (var i = (r = e.querySelectorAll(n)).length; i--;)o(r[i]) } }(n, a.selectors); n.firstChild;)(o = s(r = n.firstChild, t.cleanUp, u, t.uneditableClass)) && c.appendChild(o), r !== o && n.removeChild(r); if (t.unjoinNbsps) for (var h = wysihtml5.dom.getTextNodes(c), f = h.length; f--;)h[f].nodeValue = h[f].nodeValue.replace(/([\S\u00A0])\u00A0/gi, "$1 "); return n.innerHTML = "", n.appendChild(c), d ? wysihtml5.quirks.getCorrectInnerHTML(n) : n }(e, t) }, wysihtml5.dom.removeEmptyTextNodes = function (e) { for (var t, n = wysihtml5.lang.array(e.childNodes).get(), o = n.length, r = 0; r < o; r++)(t = n[r]).nodeType === wysihtml5.TEXT_NODE && "" === t.data && t.parentNode.removeChild(t) }, wysihtml5.dom.renameElement = function (e, t) { for (var n, o = e.ownerDocument.createElement(t); n = e.firstChild;)o.appendChild(n); return wysihtml5.dom.copyAttributes(["align", "className"]).from(e).to(o), e.parentNode.replaceChild(o, e), o }, wysihtml5.dom.replaceWithChildNodes = function (e) { if (e.parentNode) if (e.firstChild) { for (var t = e.ownerDocument.createDocumentFragment(); e.firstChild;)t.appendChild(e.firstChild); e.parentNode.replaceChild(t, e), e = t = null } else e.parentNode.removeChild(e) }, function (e) { function t(t) { return "block" === e.getStyle("display").from(t) } function n(e) { return "BR" === e.nodeName } function o(e) { var t = e.ownerDocument.createElement("br"); e.appendChild(t) } e.resolveList = function (e, r) { if (e.nodeName.match(/^(MENU|UL|OL)$/)) { var i, a, s, l, c, d = e.ownerDocument, u = d.createDocumentFragment(), h = wysihtml5.dom.domNode(e).prev({ ignoreBlankTexts: !0 }); if (r) for (!h || t(h) || n(h) || o(u); c = e.firstElementChild || e.firstChild;) { for (a = c.lastChild; i = c.firstChild;)s = i === a && !t(i) && !n(i), u.appendChild(i), s && o(u); c.parentNode.removeChild(c) } else for (; c = e.firstElementChild || e.firstChild;) { if (c.querySelector && c.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6")) for (; i = c.firstChild;)u.appendChild(i); else { for (l = d.createElement("p"); i = c.firstChild;)l.appendChild(i); u.appendChild(l) } c.parentNode.removeChild(c) } e.parentNode.replaceChild(u, e) } } }(wysihtml5.dom), function (e) { var t = document, n = ["parent", "top", "opener", "frameElement", "frames", "localStorage", "globalStorage", "sessionStorage", "indexedDB"], o = ["open", "close", "openDialog", "showModalDialog", "alert", "confirm", "prompt", "openDatabase", "postMessage", "XMLHttpRequest", "XDomainRequest"], r = ["referrer", "write", "open", "close"]; e.dom.Sandbox = Base.extend({ constructor: function (t, n) { this.callback = t || e.EMPTY_FUNCTION, this.config = e.lang.object({}).merge(n).get(), this.editableArea = this._createIframe() }, insertInto: function (e) { "string" == typeof e && (e = t.getElementById(e)), e.appendChild(this.editableArea) }, getIframe: function () { return this.editableArea }, getWindow: function () { this._readyError() }, getDocument: function () { this._readyError() }, destroy: function () { var e = this.getIframe(); e.parentNode.removeChild(e) }, _readyError: function () { throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet") }, _createIframe: function () { var n = this, o = t.createElement("iframe"); return o.className = "wysihtml5-sandbox", e.dom.setAttributes({ security: "restricted", allowtransparency: "true", frameborder: 0, width: 0, height: 0, marginwidth: 0, marginheight: 0 }).on(o), e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty() && (o.src = "javascript:'<html></html>'"), o.onload = function () { o.onreadystatechange = o.onload = null, n._onLoadIframe(o) }, o.onreadystatechange = function () { /loaded|complete/.test(o.readyState) && (o.onreadystatechange = o.onload = null, n._onLoadIframe(o)) }, o }, _onLoadIframe: function (i) { if (e.dom.contains(t.documentElement, i)) { var a = this, s = i.contentWindow, l = i.contentWindow.document, c = t.characterSet || t.charset || "utf-8", d = this._getHtml({ charset: c, stylesheets: this.config.stylesheets }); if (l.open("text/html", "replace"), l.write(d), l.close(), this.getWindow = function () { return i.contentWindow }, this.getDocument = function () { return i.contentWindow.document }, s.onerror = function (e, t, n) { throw new Error("wysihtml5.Sandbox: " + e, t, n) }, !e.browser.supportsSandboxedIframes()) { var u, h; for (u = 0, h = n.length; u < h; u++)this._unset(s, n[u]); for (u = 0, h = o.length; u < h; u++)this._unset(s, o[u], e.EMPTY_FUNCTION); for (u = 0, h = r.length; u < h; u++)this._unset(l, r[u]); this._unset(l, "cookie", "", !0) } this.loaded = !0, setTimeout(function () { a.callback(a) }, 0) } }, _getHtml: function (t) { var n, o = t.stylesheets, r = "", i = 0; if (o = "string" == typeof o ? [o] : o) for (n = o.length; i < n; i++)r += '<link rel="stylesheet" href="' + o[i] + '">'; return t.stylesheets = r, e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t) }, _unset: function (t, n, o, r) { try { t[n] = o } catch (e) { } try { t.__defineGetter__(n, function () { return o }) } catch (e) { } if (r) try { t.__defineSetter__(n, function () { }) } catch (e) { } if (!e.browser.crashesWhenDefineProperty(n)) try { var i = { get: function () { return o } }; r && (i.set = function () { }), Object.defineProperty(t, n, i) } catch (e) { } } }) }(wysihtml5), function (e) { var t = document; e.dom.ContentEditableArea = Base.extend({ getContentEditable: function () { return this.element }, getWindow: function () { return this.element.ownerDocument.defaultView }, getDocument: function () { return this.element.ownerDocument }, constructor: function (t, n, o) { this.callback = t || e.EMPTY_FUNCTION, this.config = e.lang.object({}).merge(n).get(), this.element = o ? this._bindElement(o) : this._createElement() }, _createElement: function () { var e = t.createElement("div"); return e.className = "wysihtml5-sandbox", this._loadElement(e), e }, _bindElement: function (e) { return e.className = e.className && "" != e.className ? e.className + " wysihtml5-sandbox" : "wysihtml5-sandbox", this._loadElement(e, !0), e }, _loadElement: function (e, t) { var n = this; if (!t) { var o = this._getHtml(); e.innerHTML = o } this.getWindow = function () { return e.ownerDocument.defaultView }, this.getDocument = function () { return e.ownerDocument }, this.loaded = !0, setTimeout(function () { n.callback(n) }, 0) }, _getHtml: function (e) { return "" } }) }(wysihtml5), function () { var e = { className: "class" }; wysihtml5.dom.setAttributes = function (t) { return { on: function (n) { for (var o in t) n.setAttribute(e[o] || o, t[o]) } } } }(), wysihtml5.dom.setStyles = function (e) { return { on: function (t) { var n = t.style; if ("string" != typeof e) for (var o in e) "float" === o ? (n.cssFloat = e[o], n.styleFloat = e[o]) : n[o] = e[o]; else n.cssText += ";" + e } } }, function (e) { e.simulatePlaceholder = function (t, n, o) { var r = function () { var t = n.element.offsetWidth > 0 && n.element.offsetHeight > 0; n.hasPlaceholderSet() && (n.clear(), n.element.focus(), t && setTimeout(function () { var e = n.selection.getSelection(); e.focusNode && e.anchorNode || n.selection.selectNode(n.element.firstChild || n.element) }, 0)), n.placeholderSet = !1, e.removeClass(n.element, "placeholder") }, i = function () { n.isEmpty() && (n.placeholderSet = !0, n.setValue(o), e.addClass(n.element, "placeholder")) }; t.on("set_placeholder", i).on("unset_placeholder", r).on("focus:composer", r).on("paste:composer", r).on("blur:composer", i), i() } }(wysihtml5.dom), function (e) { var t = document.documentElement; "textContent" in t ? (e.setTextContent = function (e, t) { e.textContent = t }, e.getTextContent = function (e) { return e.textContent }) : "innerText" in t ? (e.setTextContent = function (e, t) { e.innerText = t }, e.getTextContent = function (e) { return e.innerText }) : (e.setTextContent = function (e, t) { e.nodeValue = t }, e.getTextContent = function (e) { return e.nodeValue }) }(wysihtml5.dom), wysihtml5.dom.getAttribute = function (e, t) { var n = !wysihtml5.browser.supportsGetAttributeCorrectly(); return t = t.toLowerCase(), "IMG" == e.nodeName && "src" == t && !0 === wysihtml5.dom.isLoadedImage(e) ? e.src : n && "outerHTML" in e ? -1 != e.outerHTML.toLowerCase().indexOf(" " + t + "=") ? e.getAttribute(t) : null : e.getAttribute(t) }, wysihtml5.dom.getAttributes = function (e) { var t, n = !wysihtml5.browser.supportsGetAttributeCorrectly(), o = e.nodeName, r = []; for (t in e.attributes) (e.attributes.hasOwnProperty && e.attributes.hasOwnProperty(t) || !e.attributes.hasOwnProperty && Object.prototype.hasOwnProperty.call(e.attributes, t)) && e.attributes[t].specified && ("IMG" == o && "src" == e.attributes[t].name.toLowerCase() && !0 === wysihtml5.dom.isLoadedImage(e) ? r.src = e.src : wysihtml5.lang.array(["rowspan", "colspan"]).contains(e.attributes[t].name.toLowerCase()) && n ? 1 !== e.attributes[t].value && (r[e.attributes[t].name] = e.attributes[t].value) : r[e.attributes[t].name] = e.attributes[t].value); return r }, wysihtml5.dom.isLoadedImage = function (e) { try { return e.complete && !e.mozMatchesSelector(":-moz-broken") } catch (t) { if (e.complete && "complete" === e.readyState) return !0 } }, function (e) { var t = e.dom, n = function (e) { this.el = e, this.isColspan = !1, this.isRowspan = !1, this.firstCol = !0, this.lastCol = !0, this.firstRow = !0, this.lastRow = !0, this.isReal = !0, this.spanCollection = [], this.modified = !1 }, o = function (e, n) { e ? (this.cell = e, this.table = t.getParentElement(e, { nodeName: ["TABLE"] })) : n && (this.table = n, this.cell = this.table.querySelectorAll("th, td")[0]) }; function r(e, t) { for (var n, o = [], r = 0, i = e.length; r < i; r++)if (n = e[r].querySelectorAll(t)) for (var a = n.length; a--; o.unshift(n[a])); return o } function i(e) { e.parentNode.removeChild(e) } function a(e, t) { e.parentNode.insertBefore(t, e.nextSibling) } function s(e, t) { for (var n = e.nextSibling; 1 != n.nodeType;)if (n = n.nextSibling, !t || t == n.tagName.toLowerCase()) return n; return null } o.prototype = { addSpannedCellToMap: function (e, t, o, r, i, a) { for (var s = [], l = o + (a ? parseInt(a, 10) - 1 : 0), c = r + (i ? parseInt(i, 10) - 1 : 0), d = o; d <= l; d++) { void 0 === t[d] && (t[d] = []); for (var u = r; u <= c; u++)t[d][u] = new n(e), t[d][u].isColspan = i && parseInt(i, 10) > 1, t[d][u].isRowspan = a && parseInt(a, 10) > 1, t[d][u].firstCol = u == r, t[d][u].lastCol = u == c, t[d][u].firstRow = d == o, t[d][u].lastRow = d == l, t[d][u].isReal = u == r && d == o, t[d][u].spanCollection = s, s.push(t[d][u]) } }, setCellAsModified: function (e) { if (e.modified = !0, e.spanCollection.length > 0) for (var t = 0, n = e.spanCollection.length; t < n; t++)e.spanCollection[t].modified = !0 }, setTableMap: function () { var e, o, r, i, a, s, l, c, d = [], u = this.getTableRows(); for (e = 0; e < u.length; e++)for (o = u[e], r = this.getRowCells(o), s = 0, void 0 === d[e] && (d[e] = []), i = 0; i < r.length; i++) { for (a = r[i]; void 0 !== d[e][s];)s++; l = t.getAttribute(a, "colspan"), c = t.getAttribute(a, "rowspan"), l || c ? (this.addSpannedCellToMap(a, d, e, s, l, c), s += l ? parseInt(l, 10) : 1) : (d[e][s] = new n(a), s++) } return this.map = d, d }, getRowCells: function (t) { var n = this.table.querySelectorAll("table"), o = n ? r(n, "th, td") : [], i = t.querySelectorAll("th, td"); return o.length > 0 ? e.lang.array(i).without(o) : i }, getTableRows: function () { var t = this.table.querySelectorAll("table"), n = t ? r(t, "tr") : [], o = this.table.querySelectorAll("tr"); return n.length > 0 ? e.lang.array(o).without(n) : o }, getMapIndex: function (e) { for (var t = this.map.length, n = this.map && this.map[0] ? this.map[0].length : 0, o = 0; o < t; o++)for (var r = 0; r < n; r++)if (this.map[o][r].el === e) return { row: o, col: r }; return !1 }, getElementAtIndex: function (e) { return this.setTableMap(), this.map[e.row] && this.map[e.row][e.col] && this.map[e.row][e.col].el ? this.map[e.row][e.col].el : null }, getMapElsTo: function (e) { var t = []; if (this.setTableMap(), this.idx_start = this.getMapIndex(this.cell), this.idx_end = this.getMapIndex(e), this.idx_start.row > this.idx_end.row || this.idx_start.row == this.idx_end.row && this.idx_start.col > this.idx_end.col) { var n = this.idx_start; this.idx_start = this.idx_end, this.idx_end = n } if (this.idx_start.col > this.idx_end.col) { var o = this.idx_start.col; this.idx_start.col = this.idx_end.col, this.idx_end.col = o } if (null != this.idx_start && null != this.idx_end) for (var r = this.idx_start.row, i = this.idx_end.row; r <= i; r++)for (var a = this.idx_start.col, s = this.idx_end.col; a <= s; a++)t.push(this.map[r][a].el); return t }, orderSelectionEnds: function (e) { if (this.setTableMap(), this.idx_start = this.getMapIndex(this.cell), this.idx_end = this.getMapIndex(e), this.idx_start.row > this.idx_end.row || this.idx_start.row == this.idx_end.row && this.idx_start.col > this.idx_end.col) { var t = this.idx_start; this.idx_start = this.idx_end, this.idx_end = t } if (this.idx_start.col > this.idx_end.col) { var n = this.idx_start.col; this.idx_start.col = this.idx_end.col, this.idx_end.col = n } return { start: this.map[this.idx_start.row][this.idx_start.col].el, end: this.map[this.idx_end.row][this.idx_end.col].el } }, createCells: function (e, t, n) { for (var o, r = this.table.ownerDocument, i = r.createDocumentFragment(), a = 0; a < t; a++) { if (o = r.createElement(e), n) for (var s in n) n.hasOwnProperty(s) && o.setAttribute(s, n[s]); o.appendChild(document.createTextNode(" ")), i.appendChild(o) } return i }, correctColIndexForUnreals: function (e, t) { for (var n = this.map[t], o = -1, r = 0; r < e; r++)n[r].isReal && o++; return o }, getLastNewCellOnRow: function (e, t) { for (var n, o, r = this.getRowCells(e), i = 0, a = r.length; i < a; i++)if (n = r[i], !1 === (o = this.getMapIndex(n)) || void 0 !== t && o.row != t) return n; return null }, removeEmptyTable: function () { var e = this.table.querySelectorAll("td, th"); return (!e || 0 == e.length) && (i(this.table), !0) }, splitRowToCells: function (e) { if (e.isColspan) { var n = parseInt(t.getAttribute(e.el, "colspan") || 1, 10), o = e.el.tagName.toLowerCase(); if (n > 1) { var r = this.createCells(o, n - 1); a(e.el, r) } e.el.removeAttribute("colspan") } }, getRealRowEl: function (e, n) { var o = null, r = null; n = n || this.idx; for (var i = 0, a = this.map[n.row].length; i < a; i++)if ((r = this.map[n.row][i]).isReal && (o = t.getParentElement(r.el, { nodeName: ["TR"] }))) return o; return null === o && e && (o = t.getParentElement(this.map[n.row][n.col].el, { nodeName: ["TR"] }) || null), o }, injectRowAt: function (e, n, o, r, i) { var s = this.getRealRowEl(!1, { row: e, col: n }), l = this.createCells(r, o); if (s) { var c = this.correctColIndexForUnreals(n, e); c >= 0 ? a(this.getRowCells(s)[c], l) : s.insertBefore(l, s.firstChild) } else { var d = this.table.ownerDocument.createElement("tr"); d.appendChild(l), a(t.getParentElement(i.el, { nodeName: ["TR"] }), d) } }, canMerge: function (e) { if (this.to = e, this.setTableMap(), this.idx_start = this.getMapIndex(this.cell), this.idx_end = this.getMapIndex(this.to), this.idx_start.row > this.idx_end.row || this.idx_start.row == this.idx_end.row && this.idx_start.col > this.idx_end.col) { var t = this.idx_start; this.idx_start = this.idx_end, this.idx_end = t } if (this.idx_start.col > this.idx_end.col) { var n = this.idx_start.col; this.idx_start.col = this.idx_end.col, this.idx_end.col = n } for (var o = this.idx_start.row, r = this.idx_end.row; o <= r; o++)for (var i = this.idx_start.col, a = this.idx_end.col; i <= a; i++)if (this.map[o][i].isColspan || this.map[o][i].isRowspan) return !1; return !0 }, decreaseCellSpan: function (e, n) { var o = parseInt(t.getAttribute(e.el, n), 10) - 1; o >= 1 ? e.el.setAttribute(n, o) : (e.el.removeAttribute(n), "colspan" == n && (e.isColspan = !1), "rowspan" == n && (e.isRowspan = !1), e.firstCol = !0, e.lastCol = !0, e.firstRow = !0, e.lastRow = !0, e.isReal = !0) }, removeSurplusLines: function () { var e, n, o, r, a, s, l; if (this.setTableMap(), this.map) { for (o = 0, r = this.map.length; o < r; o++) { for (l = !0, a = 0, s = (e = this.map[o]).length; a < s; a++)if (n = e[a], !(t.getAttribute(n.el, "rowspan") && parseInt(t.getAttribute(n.el, "rowspan"), 10) > 1 && !0 !== n.firstRow)) { l = !1; break } if (l) for (a = 0; a < s; a++)this.decreaseCellSpan(e[a], "rowspan") } var c = this.getTableRows(); for (o = 0, r = c.length; o < r; o++)0 == (e = c[o]).childNodes.length && /^\s*$/.test(e.textContent || e.innerText) && i(e) } }, fillMissingCells: function () { var e = 0, t = 0, o = null; if (this.setTableMap(), this.map) { e = this.map.length; for (var r = 0; r < e; r++)this.map[r].length > t && (t = this.map[r].length); for (var i = 0; i < e; i++)for (var s = 0; s < t; s++)this.map[i] && !this.map[i][s] && s > 0 && (this.map[i][s] = new n(this.createCells("td", 1)), (o = this.map[i][s - 1]) && o.el && o.el.parent && a(this.map[i][s - 1].el, this.map[i][s].el)) } }, rectify: function () { return !this.removeEmptyTable() && (this.removeSurplusLines(), this.fillMissingCells(), !0) }, unmerge: function () { if (this.rectify() && (this.setTableMap(), this.idx = this.getMapIndex(this.cell), this.idx)) { var e = this.map[this.idx.row][this.idx.col], n = t.getAttribute(e.el, "colspan") ? parseInt(t.getAttribute(e.el, "colspan"), 10) : 1, o = e.el.tagName.toLowerCase(); if (e.isRowspan) { var r = parseInt(t.getAttribute(e.el, "rowspan"), 10); if (r > 1) for (var i = 1, a = r - 1; i <= a; i++)this.injectRowAt(this.idx.row + i, this.idx.col, n, o, e); e.el.removeAttribute("rowspan") } this.splitRowToCells(e) } }, merge: function (e) { if (this.rectify()) if (this.canMerge(e)) { for (var t = this.idx_end.row - this.idx_start.row + 1, n = this.idx_end.col - this.idx_start.col + 1, o = this.idx_start.row, r = this.idx_end.row; o <= r; o++)for (var a = this.idx_start.col, s = this.idx_end.col; a <= s; a++)o == this.idx_start.row && a == this.idx_start.col ? (t > 1 && this.map[o][a].el.setAttribute("rowspan", t), n > 1 && this.map[o][a].el.setAttribute("colspan", n)) : (/^\s*<br\/?>\s*$/.test(this.map[o][a].el.innerHTML.toLowerCase()) || (this.map[this.idx_start.row][this.idx_start.col].el.innerHTML += " " + this.map[o][a].el.innerHTML), i(this.map[o][a].el)); this.rectify() } else window.console && console.log("Do not know how to merge allready merged cells.") }, collapseCellToNextRow: function (e) { var n = this.getMapIndex(e.el), o = n.row + 1, r = { row: o, col: n.col }; if (o < this.map.length) { var i = this.getRealRowEl(!1, r); if (null !== i) { var s = this.correctColIndexForUnreals(r.col, r.row); if (s >= 0) a(this.getRowCells(i)[s], e.el); else { var l = this.getLastNewCellOnRow(i, o); null !== l ? a(l, e.el) : i.insertBefore(e.el, i.firstChild) } parseInt(t.getAttribute(e.el, "rowspan"), 10) > 2 ? e.el.setAttribute("rowspan", parseInt(t.getAttribute(e.el, "rowspan"), 10) - 1) : e.el.removeAttribute("rowspan") } } }, removeRowCell: function (e) { e.isReal ? e.isRowspan ? this.collapseCellToNextRow(e) : i(e.el) : parseInt(t.getAttribute(e.el, "rowspan"), 10) > 2 ? e.el.setAttribute("rowspan", parseInt(t.getAttribute(e.el, "rowspan"), 10) - 1) : e.el.removeAttribute("rowspan") }, getRowElementsByCell: function () { var e = []; if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), !1 !== this.idx) for (var t = this.map[this.idx.row], n = 0, o = t.length; n < o; n++)t[n].isReal && e.push(t[n].el); return e }, getColumnElementsByCell: function () { var e = []; if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), !1 !== this.idx) for (var t = 0, n = this.map.length; t < n; t++)this.map[t][this.idx.col] && this.map[t][this.idx.col].isReal && e.push(this.map[t][this.idx.col].el); return e }, removeRow: function () { var e = t.getParentElement(this.cell, { nodeName: ["TR"] }); if (e) { if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), !1 !== this.idx) for (var n = this.map[this.idx.row], o = 0, r = n.length; o < r; o++)n[o].modified || (this.setCellAsModified(n[o]), this.removeRowCell(n[o])); i(e) } }, removeColCell: function (e) { e.isColspan ? parseInt(t.getAttribute(e.el, "colspan"), 10) > 2 ? e.el.setAttribute("colspan", parseInt(t.getAttribute(e.el, "colspan"), 10) - 1) : e.el.removeAttribute("colspan") : e.isReal && i(e.el) }, removeColumn: function () { if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), !1 !== this.idx) for (var e = 0, t = this.map.length; e < t; e++)this.map[e][this.idx.col].modified || (this.setCellAsModified(this.map[e][this.idx.col]), this.removeColCell(this.map[e][this.idx.col])) }, remove: function (e) { if (this.rectify()) { switch (e) { case "row": this.removeRow(); break; case "column": this.removeColumn() }this.rectify() } }, addRow: function (e) { var n = this.table.ownerDocument; if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), "below" == e && t.getAttribute(this.cell, "rowspan") && (this.idx.row = this.idx.row + parseInt(t.getAttribute(this.cell, "rowspan"), 10) - 1), !1 !== this.idx) { for (var o = this.map[this.idx.row], r = n.createElement("tr"), i = 0, s = o.length; i < s; i++)o[i].modified || (this.setCellAsModified(o[i]), this.addRowCell(o[i], r, e)); switch (e) { case "below": a(this.getRealRowEl(!0), r); break; case "above": var l = t.getParentElement(this.map[this.idx.row][this.idx.col].el, { nodeName: ["TR"] }); l && l.parentNode.insertBefore(r, l) } } }, addRowCell: function (e, n, o) { var r = e.isColspan ? { colspan: t.getAttribute(e.el, "colspan") } : null; e.isReal ? "above" != o && e.isRowspan ? e.el.setAttribute("rowspan", parseInt(t.getAttribute(e.el, "rowspan"), 10) + 1) : n.appendChild(this.createCells("td", 1, r)) : "above" != o && e.isRowspan && e.lastRow ? n.appendChild(this.createCells("td", 1, r)) : c.isRowspan && e.el.attr("rowspan", parseInt(t.getAttribute(e.el, "rowspan"), 10) + 1) }, add: function (e) { this.rectify() && ("below" != e && "above" != e || this.addRow(e), "before" != e && "after" != e || this.addColumn(e)) }, addColCell: function (e, n, o) { var r, i = e.el.tagName.toLowerCase(); switch (o) { case "before": r = !e.isColspan || e.firstCol; break; case "after": r = !e.isColspan || e.lastCol || e.isColspan && c.el == this.cell }if (r) { switch (o) { case "before": e.el.parentNode.insertBefore(this.createCells(i, 1), e.el); break; case "after": a(e.el, this.createCells(i, 1)) }e.isRowspan && this.handleCellAddWithRowspan(e, n + 1, o) } else e.el.setAttribute("colspan", parseInt(t.getAttribute(e.el, "colspan"), 10) + 1) }, addColumn: function (e) { var n, o; if (this.setTableMap(), this.idx = this.getMapIndex(this.cell), "after" == e && t.getAttribute(this.cell, "colspan") && (this.idx.col = this.idx.col + parseInt(t.getAttribute(this.cell, "colspan"), 10) - 1), !1 !== this.idx) for (var r = 0, i = this.map.length; r < i; r++)(n = this.map[r])[this.idx.col] && ((o = n[this.idx.col]).modified || (this.setCellAsModified(o), this.addColCell(o, r, e))) }, handleCellAddWithRowspan: function (e, n, o) { for (var r, i, l, c = parseInt(t.getAttribute(this.cell, "rowspan"), 10) - 1, d = t.getParentElement(e.el, { nodeName: ["TR"] }), u = e.el.tagName.toLowerCase(), h = this.table.ownerDocument, f = 0; f < c; f++)if (r = this.correctColIndexForUnreals(this.idx.col, n + f), d = s(d, "tr")) if (r > 0) switch (o) { case "before": i = this.getRowCells(d), r > 0 && this.map[n + f][this.idx.col].el != i[r] && r == i.length - 1 ? a(i[r], this.createCells(u, 1)) : i[r].parentNode.insertBefore(this.createCells(u, 1), i[r]); break; case "after": a(this.getRowCells(d)[r], this.createCells(u, 1)) } else d.insertBefore(this.createCells(u, 1), d.firstChild); else (l = h.createElement("tr")).appendChild(this.createCells(u, 1)), this.table.appendChild(l) } }, t.table = { getCellsBetween: function (e, t) { return new o(e).getMapElsTo(t) }, addCells: function (e, t) { new o(e).add(t) }, removeCells: function (e, t) { new o(e).remove(t) }, mergeCellsBetween: function (e, t) { new o(e).merge(t) }, unmergeCell: function (e) { new o(e).unmerge() }, orderSelectionEnds: function (e, t) { return new o(e).orderSelectionEnds(t) }, indexOf: function (e) { var t = new o(e); return t.setTableMap(), t.getMapIndex(e) }, findCell: function (e, t) { return new o(null, e).getElementAtIndex(t) }, findRowByCell: function (e) { return new o(e).getRowElementsByCell() }, findColumnByCell: function (e) { return new o(e).getColumnElementsByCell() }, canMerge: function (e, t) { return new o(e).canMerge(t) } } }(wysihtml5), wysihtml5.dom.query = function (e, t) { var n, o = []; e.nodeType && (e = [e]); for (var r = 0, i = e.length; r < i; r++)if (n = e[r].querySelectorAll(t)) for (var a = n.length; a--; o.unshift(n[a])); return o }, wysihtml5.dom.compareDocumentPosition = document.documentElement.compareDocumentPosition ? function (e, t) { return e.compareDocumentPosition(t) } : function (e, t) { var n, o; if (n = 9 === e.nodeType ? e : e.ownerDocument, o = 9 === t.nodeType ? t : t.ownerDocument, e === t) return 0; if (e === t.ownerDocument) return 20; if (e.ownerDocument === t) return 10; if (n !== o) return 1; if (2 === e.nodeType && e.childNodes && -1 !== wysihtml5.lang.array(e.childNodes).indexOf(t)) return 20; if (2 === t.nodeType && t.childNodes && -1 !== wysihtml5.lang.array(t.childNodes).indexOf(e)) return 10; for (var r = e, i = [], a = null; r;) { if (r == t) return 10; i.push(r), r = r.parentNode } for (r = t, a = null; r;) { if (r == e) return 20; var s = wysihtml5.lang.array(i).indexOf(r); if (-1 !== s) { var l = i[s]; return wysihtml5.lang.array(l.childNodes).indexOf(i[s - 1]) > wysihtml5.lang.array(l.childNodes).indexOf(a) ? 2 : 4 } a = r, r = r.parentNode } return 1 }, wysihtml5.dom.unwrap = function (e) { if (e.parentNode) { for (; e.lastChild;)wysihtml5.dom.insert(e.lastChild).after(e); e.parentNode.removeChild(e) } }, wysihtml5.dom.getPastedHtml = function (e) { var t; return e.clipboardData && (wysihtml5.lang.array(e.clipboardData.types).contains("text/html") ? t = e.clipboardData.getData("text/html") : wysihtml5.lang.array(e.clipboardData.types).contains("text/plain") && (t = wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0, !0))), t }, wysihtml5.dom.getPastedHtmlWithDiv = function (e, t) { var n = e.selection.getBookmark(), o = e.element.ownerDocument, r = o.createElement("DIV"); o.body.appendChild(r), r.style.width = "1px", r.style.height = "1px", r.style.overflow = "hidden", r.setAttribute("contenteditable", "true"), r.focus(), setTimeout(function () { e.selection.setBookmark(n), t(r.innerHTML), r.parentNode.removeChild(r) }, 0) }, wysihtml5.quirks.cleanPastedHTML = function (e, t) { var n = { color: wysihtml5.dom.getStyle("color").from(t.referenceNode), fontSize: wysihtml5.dom.getStyle("font-size").from(t.referenceNode) }, o = function (e, t) { var n, o, r, i, a = wysihtml5.lang.object(e).clone(!0); for (n in a.tags) if (a.tags.hasOwnProperty(n) && a.tags[n].keep_styles) for (o in a.tags[n].keep_styles) a.tags[n].keep_styles.hasOwnProperty(o) && t[o] && (a.tags[n].keep_styles[o] = (r = t[o], i = void 0, i = wysihtml5.lang.string(r).trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), new RegExp("^((?!^" + i + "$).)*$", "i"))); return a }(function (e, t) { var n; if (!e) return null; for (var o = 0, r = e.length; o < r; o++)if (e[o].condition || (n = e[o].set), e[o].condition && e[o].condition.test(t)) return e[o].set; return n }(t.rules, e) || {}, n); return wysihtml5.dom.parse(e, { rules: o, cleanUp: !0, context: t.referenceNode.ownerDocument, uneditableClass: t.uneditableClass, clearInternals: !0, unjoinNbsps: !0 }) }, wysihtml5.quirks.ensureProperClearing = function () { var e = function () { var e = this; setTimeout(function () { var t = e.innerHTML.toLowerCase(); "<p>&nbsp;</p>" != t && "<p>&nbsp;</p><p>&nbsp;</p>" != t || (e.innerHTML = "") }, 0) }; return function (t) { wysihtml5.dom.observe(t.element, ["cut", "keydown"], e) } }(), function (e) { e.quirks.getCorrectInnerHTML = function (t) { var n = t.innerHTML; if (-1 === n.indexOf("%7E")) return n; var o, r, i, a, s = t.querySelectorAll("[href*='~'], [src*='~']"); for (a = 0, i = s.length; a < i; a++)o = s[a].href || s[a].src, r = e.lang.string(o).replace("~").by("%7E"), n = e.lang.string(n).replace(r).by(o); return n } }(wysihtml5), function (e) { e.quirks.redraw = function (t) { e.dom.addClass(t, "wysihtml5-quirks-redraw"), e.dom.removeClass(t, "wysihtml5-quirks-redraw"); try { var n = t.ownerDocument; n.execCommand("italic", !1, null), n.execCommand("italic", !1, null) } catch (e) { } } }(wysihtml5), wysihtml5.quirks.tableCellsSelection = function (e, t) { var n = wysihtml5.dom, o = { table: null, start: null, end: null, cells: null, select: function (e, r) { o.start = e, o.end = r, o.table = n.getParentElement(o.start, { nodeName: ["TABLE"] }), selectedCells = n.table.getCellsBetween(o.start, o.end), l(selectedCells), u(), t.fire("tableselect").fire("tableselect:composer") } }, r = "wysiwyg-tmp-selected-cell", i = null, a = null; function s() { if (e) { var t = e.querySelectorAll("." + r); if (t.length > 0) for (var o = 0; o < t.length; o++)n.removeClass(t[o], r) } } function l(e) { for (var t = 0; t < e.length; t++)n.addClass(e[t], r) } function c(e) { var r, i = null, a = n.getParentElement(e.target, { nodeName: ["TD", "TH"] }); a && o.table && o.start && (i = n.getParentElement(a, { nodeName: ["TABLE"] })) && i === o.table && (s(), r = o.end, o.end = a, o.cells = n.table.getCellsBetween(o.start, a), o.cells.length > 1 && t.composer.selection.deselect(), l(o.cells), o.end !== r && t.fire("tableselectchange").fire("tableselectchange:composer")) } function d(e) { i.stop(), a.stop(), t.fire("tableselect").fire("tableselect:composer"), setTimeout(function () { u() }, 0) } function u() { var r = n.observe(e.ownerDocument, "click", function (e) { r.stop(), n.getParentElement(e.target, { nodeName: ["TABLE"] }) != o.table && (s(), o.table = null, o.start = null, o.end = null, t.fire("tableunselect").fire("tableunselect:composer")) }) } return n.observe(e, "mousedown", function (l) { var u = wysihtml5.dom.getParentElement(l.target, { nodeName: ["TD", "TH"] }); u && function (l) { o.start = l, o.end = l, o.cells = [l], o.table = n.getParentElement(o.start, { nodeName: ["TABLE"] }), o.table && (s(), n.addClass(l, r), i = n.observe(e, "mousemove", c), a = n.observe(e, "mouseup", d), t.fire("tableselectstart").fire("tableselectstart:composer")) }(u) }), o }, function (e) { var t = /^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i, n = /^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i, o = /^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i, r = /^#([0-9a-f])([0-9a-f])([0-9a-f])/i, i = function (e) { return new RegExp("(^|\\s|;)" + e + "\\s*:\\s*[^;$]+", "gi") }; e.quirks.styleParser = { parseColor: function (a, s) { var l, c, d = i(s), u = a.match(d), h = 10; if (u) { for (var f = u.length; f--;)u[f] = e.lang.string(u[f].split(":")[1]).trim(); if (l = u[u.length - 1], t.test(l)) c = l.match(t); else if (n.test(l)) c = l.match(n); else if (o.test(l)) c = l.match(o), h = 16; else if (r.test(l)) return (c = l.match(r)).shift(), c.push(1), e.lang.array(c).map(function (e, t) { return t < 3 ? 16 * parseInt(e, 16) + parseInt(e, 16) : parseFloat(e) }); if (c) return c.shift(), c[3] || c.push(1), e.lang.array(c).map(function (e, t) { return t < 3 ? parseInt(e, h) : parseFloat(e) }) } return !1 }, unparseColor: function (e, t) { if (t) { if ("hex" == t) return e[0].toString(16).toUpperCase() + e[1].toString(16).toUpperCase() + e[2].toString(16).toUpperCase(); if ("hash" == t) return "#" + e[0].toString(16).toUpperCase() + e[1].toString(16).toUpperCase() + e[2].toString(16).toUpperCase(); if ("rgb" == t) return "rgb(" + e[0] + "," + e[1] + "," + e[2] + ")"; if ("rgba" == t) return "rgba(" + e[0] + "," + e[1] + "," + e[2] + "," + e[3] + ")"; if ("csv" == t) return e[0] + "," + e[1] + "," + e[2] + "," + e[3] } return e[3] && 1 !== e[3] ? "rgba(" + e[0] + "," + e[1] + "," + e[2] + "," + e[3] + ")" : "rgb(" + e[0] + "," + e[1] + "," + e[2] + ")" }, parseFontSize: function (t) { var n = t.match(i("font-size")); return !!n && e.lang.string(n[n.length - 1].split(":")[1]).trim() } } }(wysihtml5), function (e) { var t = e.dom; function n(e, t) { for (var n = 0; t !== e;)if (n++ , !(t = t.parentNode)) throw new Error("not a descendant of ancestor!"); return n } function o(e) { if (!e.canSurroundContents()) for (var t = e.commonAncestorContainer, o = n(t, e.startContainer), r = n(t, e.endContainer); !e.canSurroundContents();)o > r ? (e.setStartBefore(e.startContainer), o = n(t, e.startContainer)) : (e.setEndAfter(e.endContainer), r = n(t, e.endContainer)) } e.Selection = Base.extend({ constructor: function (e, t, n) { window.rangy.init(), this.editor = e, this.composer = e.composer, this.doc = this.composer.doc, this.contain = t, this.unselectableClass = n || !1 }, getBookmark: function () { var e = this.getRange(); return e && o(e), e && e.cloneRange() }, setBookmark: function (e) { e && this.setSelection(e) }, setBefore: function (e) { var t = rangy.createRange(this.doc); return t.setStartBefore(e), t.setEndBefore(e), this.setSelection(t) }, setAfter: function (e) { var t = rangy.createRange(this.doc); return t.setStartAfter(e), t.setEndAfter(e), this.setSelection(t) }, selectNode: function (n, o) { var r = rangy.createRange(this.doc), i = n.nodeType === e.ELEMENT_NODE, a = "canHaveHTML" in n ? n.canHaveHTML : "IMG" !== n.nodeName, s = i ? n.innerHTML : n.data, l = "" === s || s === e.INVISIBLE_SPACE, c = t.getStyle("display").from(n), d = "block" === c || "list-item" === c; if (l && i && a && !o) try { n.innerHTML = e.INVISIBLE_SPACE } catch (e) { } a ? r.selectNodeContents(n) : r.selectNode(n), a && l && i ? r.collapse(d) : a && l && (r.setStartAfter(n), r.setEndAfter(n)), this.setSelection(r) }, getSelectedNode: function (e) { var t, n; return e && this.doc.selection && "Control" === this.doc.selection.type && (n = this.doc.selection.createRange()) && n.length ? n.item(0) : (t = this.getSelection(this.doc)).focusNode === t.anchorNode ? t.focusNode : (n = this.getRange(this.doc)) ? n.commonAncestorContainer : this.doc.body }, fixSelBorders: function () { var e = this.getRange(); o(e), this.setSelection(e) }, getSelectedOwnNodes: function (e) { for (var t = this.getOwnRanges(), n = [], o = 0, r = t.length; o < r; o++)n.push(t[o].commonAncestorContainer || this.doc.body); return n }, findNodesInSelection: function (t) { for (var n, o = this.getOwnRanges(), r = [], i = 0, a = o.length; i < a; i++)n = o[i].getNodes([1], function (n) { return e.lang.array(t).contains(n.nodeName) }), r = r.concat(n); return r }, containsUneditable: function () { for (var e = this.getOwnUneditables(), t = this.getSelection(), n = 0, o = e.length; n < o; n++)if (t.containsNode(e[n])) return !0; return !1 }, deleteContents: function () { for (var e = this.getOwnRanges(), t = e.length; t--;)e[t].deleteContents(); this.setSelection(e[0]) }, getPreviousNode: function (t, n) { t || (t = this.getSelection().anchorNode); if (t === this.contain) return !1; var o, r = t.previousSibling; return r !== this.contain && (r && 3 !== r.nodeType && 1 !== r.nodeType ? r = this.getPreviousNode(r, n) : r && 3 === r.nodeType && /^\s*$/.test(r.textContent) ? r = this.getPreviousNode(r, n) : n && r && 1 === r.nodeType && !e.lang.array(["BR", "HR", "IMG"]).contains(r.nodeName) && /^[\s]*$/.test(r.innerHTML) ? r = this.getPreviousNode(r, n) : r || t === this.contain || (o = t.parentNode) !== this.contain && (r = this.getPreviousNode(o, n)), r !== this.contain && r) }, getSelectionParentsByTag: function (t) { for (var n, o = this.getSelectedOwnNodes(), r = [], i = 0, a = o.length; i < a; i++)(n = o[i].nodeName && "LI" === o[i].nodeName ? o[i] : e.dom.getParentElement(o[i], { nodeName: ["LI"] }, !1, this.contain)) && r.push(n); return r.length ? r : null }, getRangeToNodeEnd: function () { if (this.isCollapsed()) { var e = this.getRange(), t = e.startContainer, n = e.startOffset, o = rangy.createRange(this.doc); return o.selectNodeContents(t), o.setStart(t, n), o } }, caretIsLastInSelection: function () { rangy.createRange(this.doc), this.getSelection(); var e = this.getRangeToNodeEnd().cloneContents().textContent; return /^\s*$/.test(e) }, caretIsFirstInSelection: function () { var t = rangy.createRange(this.doc), n = this.getSelection(), o = this.getRange(), r = o.startContainer; return r.nodeType === e.TEXT_NODE ? this.isCollapsed() && r.nodeType === e.TEXT_NODE && /^\s*$/.test(r.data.substr(0, o.startOffset)) : (t.selectNodeContents(this.getRange().commonAncestorContainer), t.collapse(!0), this.isCollapsed() && (t.startContainer === n.anchorNode || t.endContainer === n.anchorNode) && t.startOffset === n.anchorOffset) }, caretIsInTheBeginnig: function (t) { var n = this.getSelection(), o = n.anchorNode, r = n.anchorOffset; return t ? 0 === r && (o.nodeName && o.nodeName === t.toUpperCase() || e.dom.getParentElement(o.parentNode, { nodeName: t }, 1)) : 0 === r && !this.getPreviousNode(o, !0) }, caretIsBeforeUneditable: function () { var e = this.getSelection(), t = e.anchorNode; if (0 === e.anchorOffset) { var n = this.getPreviousNode(t, !0); if (n) for (var o = this.getOwnUneditables(), r = 0, i = o.length; r < i; r++)if (n === o[r]) return o[r] } return !1 }, executeAndRestoreRangy: function (e, t) { var n = this.doc.defaultView || this.doc.parentWindow, o = rangy.saveSelection(n); if (o) try { e() } catch (e) { setTimeout(function () { throw e }, 0) } else e(); rangy.restoreSelection(o) }, executeAndRestore: function (n, o) { var r, i, a, s, l, c, d, u, h = this.doc.body, f = o && h.scrollTop, m = o && h.scrollLeft, p = "_wysihtml5-temp-placeholder", g = '<span class="' + p + '">' + e.INVISIBLE_SPACE + "</span>", y = this.getRange(!0); if (y) { y.collapsed || (c = (d = y.cloneRange()).createContextualFragment(g), d.collapse(!1), d.insertNode(c), d.detach()), l = y.createContextualFragment(g), y.insertNode(l), c && (r = this.contain.querySelectorAll("." + p), y.setStartBefore(r[0]), y.setEndAfter(r[r.length - 1])), this.setSelection(y); try { n(y.startContainer, y.endContainer) } catch (e) { setTimeout(function () { throw e }, 0) } if ((r = this.contain.querySelectorAll("." + p)) && r.length) { u = rangy.createRange(this.doc), a = r[0].nextSibling, r.length > 1 && (s = r[r.length - 1].previousSibling), s && a ? (u.setStartBefore(a), u.setEndAfter(s)) : (i = this.doc.createTextNode(e.INVISIBLE_SPACE), t.insert(i).after(r[0]), u.setStartBefore(i), u.setEndAfter(i)), this.setSelection(u); for (var v = r.length; v--;)r[v].parentNode.removeChild(r[v]) } else this.contain.focus(); o && (h.scrollTop = f, h.scrollLeft = m); try { r.parentNode.removeChild(r) } catch (e) { } } else n(h, h) }, set: function (e, t) { var n = rangy.createRange(this.doc); n.setStart(e, t || 0), this.setSelection(n) }, insertHTML: function (e) { rangy.createRange(this.doc); var t, n = this.doc.createElement("DIV"), o = this.doc.createDocumentFragment(); for (n.innerHTML = e, t = n.lastChild; n.firstChild;)o.appendChild(n.firstChild); this.insertNode(o), t && this.setAfter(t) }, insertNode: function (e) { var t = this.getRange(); t && t.insertNode(e) }, surround: function (e) { var t, n = this.getOwnRanges(), o = []; if (0 == n.length) return o; for (var r = n.length; r--;) { t = this.doc.createElement(e.nodeName), o.push(t), e.className && (t.className = e.className), e.cssStyle && t.setAttribute("style", e.cssStyle); try { n[r].surroundContents(t), this.selectNode(t) } catch (e) { t.appendChild(n[r].extractContents()), n[r].insertNode(t) } } return o }, deblockAndSurround: function (t) { var n, o, r, i = this.doc.createElement("div"), a = rangy.createRange(this.doc); if (i.className = t.className, this.composer.commands.exec("formatBlock", t.nodeName, t.className), (n = this.contain.querySelectorAll("." + t.className))[0]) for (n[0].parentNode.insertBefore(i, n[0]), a.setStartBefore(n[0]), a.setEndAfter(n[n.length - 1]), o = a.extractContents(); o.firstChild;)if (1 == (r = o.firstChild).nodeType && e.dom.hasClass(r, t.className)) { for (; r.firstChild;)i.appendChild(r.firstChild); "BR" !== r.nodeName && i.appendChild(this.doc.createElement("br")), o.removeChild(r) } else i.appendChild(r); else i = null; return i }, scrollIntoView: function () { var t, n, o = this.doc, r = o.documentElement.scrollHeight > o.documentElement.offsetHeight, i = o._wysihtml5ScrollIntoViewElement = o._wysihtml5ScrollIntoViewElement || ((n = o.createElement("span")).innerHTML = e.INVISIBLE_SPACE, n); r && (this.insertNode(i), t = function (e) { var t = 0; if (e.parentNode) do { t += e.offsetTop || 0, e = e.offsetParent } while (e); return t }(i), i.parentNode.removeChild(i), t >= o.body.scrollTop + o.documentElement.offsetHeight - 5 && (o.body.scrollTop = t)) }, selectLine: function () { e.browser.supportsSelectionModify() ? this._selectLine_W3C() : this.doc.selection && this._selectLine_MSIE() }, _selectLine_W3C: function () { var e = this.doc.defaultView.getSelection(); e.modify("move", "left", "lineboundary"), e.modify("extend", "right", "lineboundary") }, _selectLine_MSIE: function () { var e, t, n, o, r, i = this.doc.selection.createRange(), a = i.boundingTop, s = this.doc.body.scrollWidth; if (i.moveToPoint) { for (0 === a && (n = this.doc.createElement("span"), this.insertNode(n), a = n.offsetTop, n.parentNode.removeChild(n)), a += 1, o = -10; o < s; o += 2)try { i.moveToPoint(o, a); break } catch (e) { } for (e = a, t = this.doc.selection.createRange(), r = s; r >= 0; r--)try { t.moveToPoint(r, e); break } catch (e) { } i.setEndPoint("EndToEnd", t), i.select() } }, getText: function () { var e = this.getSelection(); return e ? e.toString() : "" }, getNodes: function (e, t) { var n = this.getRange(); return n ? n.getNodes([e], t) : [] }, fixRangeOverflow: function (e) { if (this.contain && this.contain.firstChild && e) { var t = e.compareNode(this.contain); if (2 !== t) 1 === t && e.setStartBefore(this.contain.firstChild), 0 === t && e.setEndAfter(this.contain.lastChild), 3 === t && (e.setStartBefore(this.contain.firstChild), e.setEndAfter(this.contain.lastChild)); else if (this._detectInlineRangeProblems(e)) { var n = e.endContainer.previousElementSibling; n && e.setEnd(n, this._endOffsetForNode(n)) } } }, _endOffsetForNode: function (e) { var t = document.createRange(); return t.selectNodeContents(e), t.endOffset }, _detectInlineRangeProblems: function (e) { var n = t.compareDocumentPosition(e.startContainer, e.endContainer); return 0 == e.endOffset && 4 & n }, getRange: function (e) { var t = this.getSelection(), n = t && t.rangeCount && t.getRangeAt(0); return !0 !== e && this.fixRangeOverflow(n), n }, getOwnUneditables: function () { var n = t.query(this.contain, "." + this.unselectableClass), o = t.query(n, "." + this.unselectableClass); return e.lang.array(n).without(o) }, getOwnRanges: function () { var e, t = [], n = this.getRange(); if (n && t.push(n), this.unselectableClass && this.contain && n) { var o, r = this.getOwnUneditables(); if (r.length > 0) for (var i = 0, a = r.length; i < a; i++) { e = []; for (var s = 0, l = t.length; s < l; s++) { if (t[s]) switch (t[s].compareNode(r[i])) { case 2: break; case 3: (o = t[s].cloneRange()).setEndBefore(r[i]), e.push(o), (o = t[s].cloneRange()).setStartAfter(r[i]), e.push(o); break; default: e.push(t[s]) }t = e } } } return t }, getSelection: function () { return rangy.getSelection(this.doc.defaultView || this.doc.parentWindow) }, setSelection: function (e) { var t = this.doc.defaultView || this.doc.parentWindow; return rangy.getSelection(t).setSingleRange(e) }, createRange: function () { return rangy.createRange(this.doc) }, isCollapsed: function () { return this.getSelection().isCollapsed }, getHtml: function () { return this.getSelection().toHtml() }, isEndToEndInNode: function (t) { var n = this.getRange(), o = n.commonAncestorContainer, r = n.startContainer, i = n.endContainer; if (o.nodeType === e.TEXT_NODE && (o = o.parentNode), r.nodeType === e.TEXT_NODE && !/^\s*$/.test(r.data.substr(n.startOffset))) return !1; if (i.nodeType === e.TEXT_NODE && !/^\s*$/.test(i.data.substr(n.endOffset))) return !1; for (; r && r !== o;) { if (r.nodeType !== e.TEXT_NODE && !e.dom.contains(o, r)) return !1; if (e.dom.domNode(r).prev({ ignoreBlankTexts: !0 })) return !1; r = r.parentNode } for (; i && i !== o;) { if (i.nodeType !== e.TEXT_NODE && !e.dom.contains(o, i)) return !1; if (e.dom.domNode(i).next({ ignoreBlankTexts: !0 })) return !1; i = i.parentNode } return !!e.lang.array(t).contains(o.nodeName) && o }, deselect: function () { var e = this.getSelection(); e && e.removeAllRanges() } }) }(wysihtml5), function (e, t) { var n = "span", o = /\s+/g; function r(e, t, n) { if (!e.className) return !1; var o = e.className.match(n) || []; return o[o.length - 1] === t } function i(e, t) { if (!e.getAttribute || !e.getAttribute("style")) return !1; e.getAttribute("style").match(t); return !!e.getAttribute("style").match(t) } function a(e, t, n) { e.getAttribute("style") ? (l(e, n), e.getAttribute("style") && !/^\s*$/.test(e.getAttribute("style")) ? e.setAttribute("style", t + ";" + e.getAttribute("style")) : e.setAttribute("style", t)) : e.setAttribute("style", t) } function s(e, t) { e.className && (e.className = e.className.replace(t, "")) } function l(e, t) { var n, o = []; if (e.getAttribute("style")) { for (var r = (n = e.getAttribute("style").split(";")).length; r--;)n[r].match(t) || /^\s*$/.test(n[r]) || o.push(n[r]); o.length ? e.setAttribute("style", o.join(";")) : e.removeAttribute("style") } } function c(e, t) { var n = [], o = t.split(";"), r = e.getAttribute("style"); if (r) { r = r.replace(/\s/gi, "").toLowerCase(), n.push(new RegExp("(^|\\s|;)" + t.replace(/\s/gi, "").replace(/([\(\)])/gi, "\\$1").toLowerCase().replace(";", ";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi, "\\s?rgb\\($1,\\s?$2,\\s?$3\\)"), "gi")); for (var i = o.length; i-- > 0;)/^\s*$/.test(o[i]) || n.push(new RegExp("(^|\\s|;)" + o[i].replace(/\s/gi, "").replace(/([\(\)])/gi, "\\$1").toLowerCase().replace(";", ";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi, "\\s?rgb\\($1,\\s?$2,\\s?$3\\)"), "gi")); for (var a = 0, s = n.length; a < s; a++)if (r.match(n[a])) return n[a] } return !1 } function d(n, o, r, i) { return r ? c(n, r) : i ? e.dom.hasClass(n, i) : t.dom.arrayContains(o, n.tagName.toLowerCase()) } function u(e, t, n, o) { for (var r = e.length; r--;)if (!d(e[r], t, n, o)) return !1; return !!e.length } function h(e, n) { return t.dom.isCharacterDataNode(e) ? 0 == n ? !!e.previousSibling : n != e.length || !!e.nextSibling : n > 0 && n < e.childNodes.length } function f(e, n, o, r) { var i; if (t.dom.isCharacterDataNode(n) && (0 == o ? (o = t.dom.getNodeIndex(n), n = n.parentNode) : o == n.length ? (o = t.dom.getNodeIndex(n) + 1, n = n.parentNode) : i = t.dom.splitDataNode(n, o)), !(i || r && n === r)) { var a; for ((i = n.cloneNode(!1)).id && i.removeAttribute("id"); a = n.childNodes[o];)i.appendChild(a); t.dom.insertAfter(i, n) } return n == e ? i : f(e, i.parentNode, t.dom.getNodeIndex(i), r) } function m(t) { this.isElementMerge = t.nodeType == e.ELEMENT_NODE, this.firstTextNode = this.isElementMerge ? t.lastChild : t, this.textNodes = [this.firstTextNode] } function p(e, t, o, r, i, a, s) { this.tagNames = e || [n], this.cssClass = t || !1 !== t && "", this.similarClassRegExp = o, this.cssStyle = i || "", this.similarStyleRegExp = a, this.normalize = r, this.applyToAnyTagName = !1, this.container = s } m.prototype = { doMerge: function () { for (var e, t, n, o = [], r = 0, i = this.textNodes.length; r < i; ++r)t = (e = this.textNodes[r]).parentNode, o[r] = e.data, r && (t.removeChild(e), t.hasChildNodes() || t.parentNode.removeChild(t)); return this.firstTextNode.data = n = o.join(""), n }, getLength: function () { for (var e = this.textNodes.length, t = 0; e--;)t += this.textNodes[e].length; return t }, toString: function () { for (var e = [], t = 0, n = this.textNodes.length; t < n; ++t)e[t] = "'" + this.textNodes[t].data + "'"; return "[Merge(" + e.join(",") + ")]" } }, p.prototype = { getAncestorWithClass: function (n) { for (var o; n;) { if (o = this.cssClass ? r(n, this.cssClass, this.similarClassRegExp) : "" === this.cssStyle, n.nodeType == e.ELEMENT_NODE && "false" != n.getAttribute("contenteditable") && t.dom.arrayContains(this.tagNames, n.tagName.toLowerCase()) && o) return n; n = n.parentNode } return !1 }, getAncestorWithStyle: function (n) { for (var o; n;) { if (o = !!this.cssStyle && i(n, this.similarStyleRegExp), n.nodeType == e.ELEMENT_NODE && "false" != n.getAttribute("contenteditable") && t.dom.arrayContains(this.tagNames, n.tagName.toLowerCase()) && o) return n; n = n.parentNode } return !1 }, getMatchingAncestor: function (e) { var t = this.getAncestorWithClass(e), n = !1; return t ? this.cssStyle && (n = "class") : (t = this.getAncestorWithStyle(e)) && (n = "style"), { element: t, type: n } }, postApply: function (e, t) { for (var n, o, r, i = e[0], a = e[e.length - 1], s = [], l = i, c = a, d = 0, u = a.length, h = 0, f = e.length; h < f; ++h)r = null, (o = e[h]) && o.parentNode && (r = this.getAdjacentMergeableTextNode(o.parentNode, !1)), r ? (n || (n = new m(r), s.push(n)), n.textNodes.push(o), o === i && (d = (l = n.firstTextNode).length), o === a && (c = n.firstTextNode, u = n.getLength())) : n = null; if (a && a.parentNode) { var p = this.getAdjacentMergeableTextNode(a.parentNode, !0); p && (n || (n = new m(a), s.push(n)), n.textNodes.push(p)) } if (s.length) { for (h = 0, f = s.length; h < f; ++h)s[h].doMerge(); t.setStart(l, d), t.setEnd(c, u) } }, getAdjacentMergeableTextNode: function (t, n) { var o, r = t.nodeType == e.TEXT_NODE, i = r ? t.parentNode : t, a = n ? "nextSibling" : "previousSibling"; if (r) { if ((o = t[a]) && o.nodeType == e.TEXT_NODE) return o } else if ((o = i[a]) && this.areElementsMergeable(t, o)) return o[n ? "firstChild" : "lastChild"]; return null }, areElementsMergeable: function (e, n) { return t.dom.arrayContains(this.tagNames, (e.tagName || "").toLowerCase()) && t.dom.arrayContains(this.tagNames, (n.tagName || "").toLowerCase()) && function (e, t) { return e.className.replace(o, " ") == t.className.replace(o, " ") }(e, n) && function (e, t) { if (e.attributes.length != t.attributes.length) return !1; for (var n, o, r, i = 0, a = e.attributes.length; i < a; ++i)if ("class" != (r = (n = e.attributes[i]).name)) { if (o = t.attributes.getNamedItem(r), n.specified != o.specified) return !1; if (n.specified && n.nodeValue !== o.nodeValue) return !1 } return !0 }(e, n) }, createContainer: function (e) { var t = e.createElement(this.tagNames[0]); return this.cssClass && (t.className = this.cssClass), this.cssStyle && t.setAttribute("style", this.cssStyle), t }, applyToTextNode: function (e) { var n = e.parentNode; if (1 == n.childNodes.length && t.dom.arrayContains(this.tagNames, n.tagName.toLowerCase())) this.cssClass && function (e, t, n) { e.className ? (s(e, n), e.className += " " + t) : e.className = t }(n, this.cssClass, this.similarClassRegExp), this.cssStyle && a(n, this.cssStyle, this.similarStyleRegExp); else { var o = this.createContainer(t.dom.getDocument(e)); e.parentNode.insertBefore(o, e), o.appendChild(e) } }, isRemovable: function (n) { return t.dom.arrayContains(this.tagNames, n.tagName.toLowerCase()) && "" === e.lang.string(n.className).trim() && (!n.getAttribute("style") || "" === e.lang.string(n.getAttribute("style")).trim()) }, undoToTextNode: function (e, t, n, o) { var r, i, d, u, m = !n, p = n || o, g = !1; if (!t.containsNode(p)) { var y = t.cloneRange(); y.selectNode(p), y.isPointInRange(t.endContainer, t.endOffset) && h(t.endContainer, t.endOffset) && (f(p, t.endContainer, t.endOffset, this.container), t.setEndAfter(p)), y.isPointInRange(t.startContainer, t.startOffset) && h(t.startContainer, t.startOffset) && (p = f(p, t.startContainer, t.startOffset, this.container)) } !m && this.similarClassRegExp && s(p, this.similarClassRegExp), m && this.similarStyleRegExp && (g = "change" == (r = p, i = this.cssStyle, d = this.similarStyleRegExp, (u = c(r, i)) ? (l(r, u), "remove") : (a(r, i, d), "change"))), this.isRemovable(p) && !g && function (e) { for (var t = e.parentNode; e.firstChild;)t.insertBefore(e.firstChild, e); t.removeChild(e) }(p) }, applyToRange: function (t) { for (var n, o = t.length; o--;) { if (!(n = t[o].getNodes([e.TEXT_NODE])).length) try { var r = this.createContainer(t[o].endContainer.ownerDocument); return t[o].surroundContents(r), void this.selectNode(t[o], r) } catch (e) { } if (t[o].splitBoundaries(), (n = t[o].getNodes([e.TEXT_NODE])).length) { for (var i, a = 0, s = n.length; a < s; ++a)i = n[a], this.getMatchingAncestor(i).element || this.applyToTextNode(i); t[o].setStart(n[0], 0), i = n[n.length - 1], t[o].setEnd(i, i.length), this.normalize && this.postApply(n, t[o]) } } }, undoToRange: function (t) { for (var n, o, r, i = t.length; i--;) { if ((n = t[i].getNodes([e.TEXT_NODE])).length) t[i].splitBoundaries(), n = t[i].getNodes([e.TEXT_NODE]); else { var a = t[i].endContainer.ownerDocument.createTextNode(e.INVISIBLE_SPACE); t[i].insertNode(a), t[i].selectNode(a), n = [a] } for (var s = 0, l = n.length; s < l; ++s)t[i].isValid() && (o = n[s], "style" === (r = this.getMatchingAncestor(o)).type ? this.undoToTextNode(o, t[i], !1, r.element) : r.element && this.undoToTextNode(o, t[i], r.element)); 1 == l ? this.selectNode(t[i], n[0]) : (t[i].setStart(n[0], 0), o = n[n.length - 1], t[i].setEnd(o, o.length), this.normalize && this.postApply(n, t[i])) } }, selectNode: function (t, n) { var o = n.nodeType === e.ELEMENT_NODE, r = !("canHaveHTML" in n) || n.canHaveHTML, i = o ? n.innerHTML : n.data, a = "" === i || i === e.INVISIBLE_SPACE; if (a && o && r) try { n.innerHTML = e.INVISIBLE_SPACE } catch (e) { } t.selectNodeContents(n), a && o ? t.collapse(!1) : a && (t.setStartAfter(n), t.setEndAfter(n)) }, getTextSelectedByRange: function (e, t) { var n = t.cloneRange(); n.selectNodeContents(e); var o = n.intersection(t), r = o ? o.toString() : ""; return n.detach(), r }, isAppliedToRange: function (t) { for (var n, o, r = [], i = "full", a = t.length; a--;) { if (!(o = t[a].getNodes([e.TEXT_NODE])).length) return !!(n = this.getMatchingAncestor(t[a].startContainer).element) && { elements: [n], coverage: i }; for (var s, l = 0, c = o.length; l < c; ++l)s = this.getTextSelectedByRange(o[l], t[a]), (n = this.getMatchingAncestor(o[l]).element) && "" != s ? (r.push(n), 1 === e.dom.getTextNodes(n, !0).length ? i = "full" : "full" === i && (i = "inline")) : n || (i = "partial") } return !!r.length && { elements: r, coverage: i } }, toggleRange: function (e) { var t, n = this.isAppliedToRange(e); n ? "full" === n.coverage ? this.undoToRange(e) : "inline" === n.coverage ? (t = u(n.elements, this.tagNames, this.cssStyle, this.cssClass), this.undoToRange(e), t || this.applyToRange(e)) : (u(n.elements, this.tagNames, this.cssStyle, this.cssClass) || this.undoToRange(e), this.applyToRange(e)) : this.applyToRange(e) } }, e.selection.HTMLApplier = p }(wysihtml5, rangy), wysihtml5.Commands = Base.extend({ constructor: function (e) { this.editor = e, this.composer = e.composer, this.doc = this.composer.doc }, support: function (e) { return wysihtml5.browser.supportsCommand(this.doc, e) }, exec: function (e, t) { var n = wysihtml5.commands[e], o = wysihtml5.lang.array(arguments).get(), r = n && n.exec, i = null; if (this.editor.fire("beforecommand:composer"), r) o.unshift(this.composer), i = r.apply(n, o); else try { i = this.doc.execCommand(e, !1, t) } catch (e) { } return this.editor.fire("aftercommand:composer"), i }, state: function (e, t) { var n = wysihtml5.commands[e], o = wysihtml5.lang.array(arguments).get(), r = n && n.state; if (r) return o.unshift(this.composer), r.apply(n, o); try { return this.doc.queryCommandState(e) } catch (e) { return !1 } }, stateValue: function (e) { var t = wysihtml5.commands[e], n = wysihtml5.lang.array(arguments).get(), o = t && t.stateValue; return !!o && (n.unshift(this.composer), o.apply(t, n)) } }), wysihtml5.commands.bold = { exec: function (e, t) { wysihtml5.commands.formatInline.execWithToggle(e, t, "b") }, state: function (e, t) { return wysihtml5.commands.formatInline.state(e, t, "b") } }, function (e) { var t, n = "A", o = e.dom; e.commands.createLink = { exec: function (r, i, a) { var s = this.state(r, i); s ? r.selection.executeAndRestore(function () { !function (e, t, n) { for (var o, r = t.length; r--;) { for (var i = (o = t[r].attributes).length; i--;)t[r].removeAttribute(o.item(i).name); for (var a in n) n.hasOwnProperty(a) && t[r].setAttribute(a, n[a]) } }(0, s, a) }) : function (r, i) { var a, s, l, c, d, u, h, f, m, p = r.doc, g = "_wysihtml5-temp-" + +new Date, y = 0; for (e.commands.formatInline.exec(r, t, n, g, /non-matching-class/g, t, t, !0, !0), a = (s = p.querySelectorAll(n + "." + g)).length; y < a; y++)for (m in (l = s[y]).removeAttribute("class"), i) "text" !== m && l.setAttribute(m, i[m]); u = l, 1 === a && (h = o.getTextContent(l), c = !!l.querySelector("*"), d = "" === h || h === e.INVISIBLE_SPACE, !c && d && (o.setTextContent(l, i.text || l.href), f = p.createTextNode(" "), r.selection.setAfter(l), o.insert(f).after(l), u = f)), r.selection.setAfter(u) }(r, a = "object" == typeof a ? a : { href: a }) }, state: function (t, n) { return e.commands.formatInline.state(t, n, "A") } } }(wysihtml5), function (e) { var t = e.dom; e.commands.removeLink = { exec: function (e, n) { var o = this.state(e, n); o && e.selection.executeAndRestore(function () { !function (e, n) { for (var o, r, i = n.length, a = 0; a < i; a++)o = n[a], r = t.getParentElement(o, { nodeName: "code" }), t.getTextContent(o).match(t.autoLink.URL_REG_EXP) && !r ? r = t.renameElement(o, "code") : t.replaceWithChildNodes(o) }(0, o) }) }, state: function (t, n) { return e.commands.formatInline.state(t, n, "A") } } }(wysihtml5), function (e) { var t = /wysiwyg-font-size-[0-9a-z\-]+/g; e.commands.fontSize = { exec: function (n, o, r) { e.commands.formatInline.execWithToggle(n, o, "span", "wysiwyg-font-size-" + r, t) }, state: function (n, o, r) { return e.commands.formatInline.state(n, o, "span", "wysiwyg-font-size-" + r, t) } } }(wysihtml5), function (e) { var t = /(\s|^)font-size\s*:\s*[^;\s]+;?/gi; e.commands.fontSizeStyle = { exec: function (n, o, r) { r = "object" == typeof r ? r.size : r, /^\s*$/.test(r) || e.commands.formatInline.execWithToggle(n, o, "span", !1, !1, "font-size:" + r, t) }, state: function (n, o, r) { return e.commands.formatInline.state(n, o, "span", !1, !1, "font-size", t) }, stateValue: function (t, n) { var o, r = this.state(t, n); return r && e.lang.object(r).isArray() && (r = r[0]), !(!r || !(o = r.getAttribute("style"))) && e.quirks.styleParser.parseFontSize(o) } } }(wysihtml5), function (e) { var t = /wysiwyg-color-[0-9a-z]+/g; e.commands.foreColor = { exec: function (n, o, r) { e.commands.formatInline.execWithToggle(n, o, "span", "wysiwyg-color-" + r, t) }, state: function (n, o, r) { return e.commands.formatInline.state(n, o, "span", "wysiwyg-color-" + r, t) } } }(wysihtml5), function (e) { var t = /(\s|^)color\s*:\s*[^;\s]+;?/gi; e.commands.foreColorStyle = { exec: function (n, o, r) { var i, a = e.quirks.styleParser.parseColor("object" == typeof r ? "color:" + r.color : "color:" + r, "color"); a && (i = "color: rgb(" + a[0] + "," + a[1] + "," + a[2] + ");", 1 !== a[3] && (i += "color: rgba(" + a[0] + "," + a[1] + "," + a[2] + "," + a[3] + ");"), e.commands.formatInline.execWithToggle(n, o, "span", !1, !1, i, t)) }, state: function (n, o) { return e.commands.formatInline.state(n, o, "span", !1, !1, "color", t) }, stateValue: function (t, n, o) { var r, i = this.state(t, n); return i && e.lang.object(i).isArray() && (i = i[0]), !!(i && (r = i.getAttribute("style")) && r) && (val = e.quirks.styleParser.parseColor(r, "color"), e.quirks.styleParser.unparseColor(val, o)) } } }(wysihtml5), function (e) { var t = /(\s|^)background-color\s*:\s*[^;\s]+;?/gi; e.commands.bgColorStyle = { exec: function (n, o, r) { var i, a = e.quirks.styleParser.parseColor("object" == typeof r ? "background-color:" + r.color : "background-color:" + r, "background-color"); a && (i = "background-color: rgb(" + a[0] + "," + a[1] + "," + a[2] + ");", 1 !== a[3] && (i += "background-color: rgba(" + a[0] + "," + a[1] + "," + a[2] + "," + a[3] + ");"), e.commands.formatInline.execWithToggle(n, o, "span", !1, !1, i, t)) }, state: function (n, o) { return e.commands.formatInline.state(n, o, "span", !1, !1, "background-color", t) }, stateValue: function (t, n, o) { var r, i = this.state(t, n), a = !1; return i && e.lang.object(i).isArray() && (i = i[0]), !(!i || !(r = i.getAttribute("style"))) && (a = e.quirks.styleParser.parseColor(r, "background-color"), e.quirks.styleParser.unparseColor(a, o)) } } }(wysihtml5), function (e) { var t = e.dom, n = ["H1", "H2", "H3", "H4", "H5", "H6", "P", "PRE", "DIV"]; function o(t, n, o) { t.className ? (i(t, o), t.className = e.lang.string(t.className + " " + n).trim()) : t.className = n } function r(t, n, o) { a(t, o), t.getAttribute("style") ? t.setAttribute("style", e.lang.string(t.getAttribute("style") + " " + n).trim()) : t.setAttribute("style", n) } function i(t, n) { var o = n.test(t.className); return t.className = t.className.replace(n, ""), "" == e.lang.string(t.className).trim() && t.removeAttribute("class"), o } function a(t, n) { var o = n.test(t.getAttribute("style")); return t.setAttribute("style", (t.getAttribute("style") || "").replace(n, "")), "" == e.lang.string(t.getAttribute("style") || "").trim() && t.removeAttribute("style"), o } function s(t) { return !!e.lang.string(t.getAttribute("style") || "").trim() } e.commands.formatBlock = { exec: function (l, c, d, u, h, f, m) { l.doc; var p, g, y, v, w, b = this.state(l, c, d, u, h, f, m), C = l.config.useLineBreaks, N = C ? "DIV" : "P"; d = "string" == typeof d ? d.toUpperCase() : d, b.length ? l.selection.executeAndRestoreRangy(function () { for (var n = b.length; n--;) { if (h && (g = i(b[n], h)), m && (v = a(b[n], m)), (v || g) && null === d && b[n].nodeName != N) return; var o = (l = b[n], !!e.lang.string(l.className).trim()), r = s(b[n]); o || r || !C && "P" !== d ? t.renameElement(b[n], "P" === d ? "DIV" : N) : (e.dom.lineBreaks(b[n]).add(), t.replaceWithChildNodes(b[n])) } var l }) : (null === d || e.lang.array(n).contains(d)) && (p = l.selection.findNodesInSelection(n).concat(l.selection.getSelectedOwnNodes()), l.selection.executeAndRestoreRangy(function () { for (var e = p.length; e--;)(w = t.getParentElement(p[e], { nodeName: n })) == l.element && (w = null), w && (d && (w = t.renameElement(w, d)), u && o(w, u, h), f && r(w, f, m), y = !0) }), y) || function (t, n) { t.selection.isCollapsed() && t.selection.selectLine(); for (var o, r, i = t.selection.surround(n), a = 0, s = i.length; a < s; a++)e.dom.lineBreaks(i[a]).remove(), o = i[a], r = void 0, (r = o.lastChild) && function (e) { return "BR" === e.nodeName }(r) && r.parentNode.removeChild(r) }(l, { nodeName: d || N, className: u || null, cssStyle: f || null }) }, state: function (n, o, r, i, a, s, l) { var c, d = n.selection.getSelectedOwnNodes(), u = []; r = "string" == typeof r ? r.toUpperCase() : r; for (var h = 0, f = d.length; h < f; h++)(c = t.getParentElement(d[h], { nodeName: r, className: i, classRegExp: a, cssStyle: s, styleRegExp: l })) && -1 == e.lang.array(u).indexOf(c) && u.push(c); return 0 != u.length && u } } }(wysihtml5), wysihtml5.commands.formatCode = { exec: function (e, t, n) { var o, r, i, a = this.state(e); a ? e.selection.executeAndRestore(function () { o = a.querySelector("code"), wysihtml5.dom.replaceWithChildNodes(a), o && wysihtml5.dom.replaceWithChildNodes(o) }) : (i = (r = e.selection.getRange()).extractContents(), a = e.doc.createElement("pre"), o = e.doc.createElement("code"), n && (o.className = n), a.appendChild(o), o.appendChild(i), r.insertNode(a), e.selection.selectNode(a)) }, state: function (e) { var t = e.selection.getSelectedNode(); return t && t.nodeName && "PRE" == t.nodeName && t.firstChild && t.firstChild.nodeName && "CODE" == t.firstChild.nodeName ? t : wysihtml5.dom.getParentElement(t, { nodeName: "CODE" }) && wysihtml5.dom.getParentElement(t, { nodeName: "PRE" }) } }, function (e) { var t = { strong: "b", em: "i", b: "strong", i: "em" }, n = {}; function o(o, r, i, a, s, l) { var c = o; return r && (c += ":" + r), a && (c += ":" + a), n[c] || (n[c] = new e.selection.HTMLApplier(function (e) { var n = t[e]; return n ? [e.toLowerCase(), n.toLowerCase()] : [e.toLowerCase()] }(o), r, i, !0, a, s, l)), n[c] } e.commands.formatInline = { exec: function (e, t, n, r, i, a, s, l, c) { var d = e.selection.createRange(), u = e.selection.getOwnRanges(); if (!u || 0 == u.length) return !1; e.selection.getSelection().removeAllRanges(), o(n, r, i, a, s, e.element).toggleRange(u), l ? c || e.cleanUp() : (d.setStart(u[0].startContainer, u[0].startOffset), d.setEnd(u[u.length - 1].endContainer, u[u.length - 1].endOffset), e.selection.setSelection(d), e.selection.executeAndRestore(function () { c || e.cleanUp() }, !0, !0)) }, execWithToggle: function (t, n, o, r, i, a, s) { if (this.state(t, n, o, r, i, a, s) && t.selection.isCollapsed() && !t.selection.caretIsLastInSelection() && !t.selection.caretIsFirstInSelection()) { var l = this.state(t, n, o, r, i)[0]; t.selection.executeAndRestoreRangy(function () { l.parentNode; t.selection.selectNode(l, !0), e.commands.formatInline.exec(t, n, o, r, i, a, s, !0, !0) }) } else this.state(t, n, o, r, i, a, s) && !t.selection.isCollapsed() ? t.selection.executeAndRestoreRangy(function () { e.commands.formatInline.exec(t, n, o, r, i, a, s, !0, !0) }) : e.commands.formatInline.exec(t, n, o, r, i, a, s) }, state: function (n, r, i, a, s, l, c) { var d, u, h = n.doc, f = t[i] || i; return !(!e.dom.hasElementWithTagName(h, i) && !e.dom.hasElementWithTagName(h, f)) && (!(a && !e.dom.hasElementWithClassName(h, a)) && (!(!(d = n.selection.getOwnRanges()) || 0 === d.length) && (!(!(u = o(i, a, s, l, c, n.element).isAppliedToRange(d)) || !u.elements) && u.elements))) } } }(wysihtml5), function (e) { e.commands.insertBlockQuote = { exec: function (t, n) { var o = this.state(t, n), r = t.selection.isEndToEndInNode(["H1", "H2", "H3", "H4", "H5", "H6", "P"]); t.selection.executeAndRestore(function () { if (o) t.config.useLineBreaks && e.dom.lineBreaks(o).add(), e.dom.unwrap(o); else if (t.selection.isCollapsed() && t.selection.selectLine(), r) { var n = r.ownerDocument.createElement("blockquote"); e.dom.insert(n).after(r), n.appendChild(r) } else t.selection.surround({ nodeName: "blockquote" }) }) }, state: function (t, n) { var o = t.selection.getSelectedNode(), r = e.dom.getParentElement(o, { nodeName: "BLOCKQUOTE" }, !1, t.element); return r || !1 } } }(wysihtml5), wysihtml5.commands.insertHTML = { exec: function (e, t, n) { e.commands.support(t) ? e.doc.execCommand(t, !1, n) : e.selection.insertHTML(n) }, state: function () { return !1 } }, function (e) { e.commands.insertImage = { exec: function (t, n, o) { o = "object" == typeof o ? o : { src: o }; var r, i, a = t.doc, s = this.state(t); if (s) return t.selection.setBefore(s), (i = s.parentNode).removeChild(s), e.dom.removeEmptyTextNodes(i), "A" !== i.nodeName || i.firstChild || (t.selection.setAfter(i), i.parentNode.removeChild(i)), void e.quirks.redraw(t.element); for (var l in s = a.createElement("IMG"), o) s.setAttribute("className" === l ? "class" : l, o[l]); t.selection.insertNode(s), e.browser.hasProblemsSettingCaretAfterImg() ? (r = a.createTextNode(e.INVISIBLE_SPACE), t.selection.insertNode(r), t.selection.setAfter(r)) : t.selection.setAfter(s) }, state: function (t) { var n, o, r, i = t.doc; return !!e.dom.hasElementWithTagName(i, "IMG") && (!!(n = t.selection.getSelectedNode()) && ("IMG" === n.nodeName ? n : n.nodeType === e.ELEMENT_NODE && (o = t.selection.getText(), !(o = e.lang.string(o).trim()) && (1 === (r = t.selection.getNodes(e.ELEMENT_NODE, function (e) { return "IMG" === e.nodeName })).length && r[0])))) } } }(wysihtml5), function (e) { var t = "<br>" + (e.browser.needsSpaceAfterLineBreak() ? " " : ""); e.commands.insertLineBreak = { exec: function (n, o) { n.commands.support(o) ? (n.doc.execCommand(o, !1, null), e.browser.autoScrollsToCaret() || n.selection.scrollIntoView()) : n.commands.exec("insertHTML", t) }, state: function () { return !1 } } }(wysihtml5), wysihtml5.commands.insertOrderedList = { exec: function (e, t) { wysihtml5.commands.insertList.exec(e, t, "OL") }, state: function (e, t) { return wysihtml5.commands.insertList.state(e, t, "OL") } }, wysihtml5.commands.insertUnorderedList = { exec: function (e, t) { wysihtml5.commands.insertList.exec(e, t, "UL") }, state: function (e, t) { return wysihtml5.commands.insertList.state(e, t, "UL") } }, wysihtml5.commands.insertList = function (e) { var t = function (e, t) { if (e && e.nodeName) { "string" == typeof t && (t = [t]); for (var n = t.length; n--;)if (e.nodeName === t[n]) return !0 } return !1 }, n = function (n, o, r) { var i = { el: null, other: !1 }; if (n) { var a = e.dom.getParentElement(n, { nodeName: "LI" }), s = "UL" === o ? "OL" : "UL"; t(n, o) ? i.el = n : t(n, s) ? i = { el: n, other: !0 } : a && (t(a.parentNode, o) ? i.el = a.parentNode : t(a.parentNode, s) && (i = { el: a.parentNode, other: !0 })) } return i.el && !r.element.contains(i.el) && (i.el = null), i }, o = function (e, n) { for (var o = n.selection.getOwnRanges(), r = [], i = o.length; i--;)r = r.concat(o[i].getNodes([1], function (n) { return t(n, e) })); return r }; return { exec: function (t, r, i) { var a = t.doc, s = "OL" === i ? "insertOrderedList" : "insertUnorderedList", l = t.selection.getSelectedNode(), c = n(l, i, t); c.el ? c.other ? function (t, n, r) { var i = "UL" === n ? "OL" : "UL"; r.selection.executeAndRestore(function () { for (var a = [t].concat(o(i, r)), s = a.length; s--;)e.dom.renameElement(a[s], n.toLowerCase()) }) }(c.el, i, t) : function (t, n, r) { var i, a = "UL" === n ? "OL" : "UL"; r.selection.executeAndRestore(function () { var s = o(a, r); if (s.length) for (var l = s.length; l--;)e.dom.renameElement(s[l], n.toLowerCase()); else { for (var c = (i = o(["OL", "UL"], r)).length; c--;)e.dom.resolveList(i[c], r.config.useLineBreaks); e.dom.resolveList(t, r.config.useLineBreaks) } }) }(c.el, i, t) : t.commands.support(s) ? a.execCommand(s, !1, null) : function (t, n) { n.selection.executeAndRestoreRangy(function () { var o, r, i = "_wysihtml5-temp-" + (new Date).getTime(), a = n.selection.deblockAndSurround({ nodeName: "div", className: i }); a.innerHTML = a.innerHTML.replace(/\uFEFF/g, ""), a && (o = e.lang.array(["", "<br>", e.INVISIBLE_SPACE]).contains(a.innerHTML), r = e.dom.convertToList(a, t.toLowerCase(), n.parent.config.uneditableContainerClassname), o && n.selection.selectNode(r.querySelector("li"), !0)) }) }(i, t) }, state: function (e, t, o) { var r = e.selection.getSelectedNode(), i = n(r, o, e); return !(!i.el || i.other) && i.el } } }(wysihtml5), wysihtml5.commands.italic = { exec: function (e, t) { wysihtml5.commands.formatInline.execWithToggle(e, t, "i") }, state: function (e, t) { return wysihtml5.commands.formatInline.state(e, t, "i") } }, function (e) { var t = /wysiwyg-text-align-[0-9a-z]+/g; e.commands.justifyCenter = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, "wysiwyg-text-align-center", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, "wysiwyg-text-align-center", t) } } }(wysihtml5), function (e) { var t = /wysiwyg-text-align-[0-9a-z]+/g; e.commands.justifyLeft = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, "wysiwyg-text-align-left", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, "wysiwyg-text-align-left", t) } } }(wysihtml5), function (e) { var t = /wysiwyg-text-align-[0-9a-z]+/g; e.commands.justifyRight = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, "wysiwyg-text-align-right", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, "wysiwyg-text-align-right", t) } } }(wysihtml5), function (e) { var t = /wysiwyg-text-align-[0-9a-z]+/g; e.commands.justifyFull = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, "wysiwyg-text-align-justify", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, "wysiwyg-text-align-justify", t) } } }(wysihtml5), function (e) { var t = /(\s|^)text-align\s*:\s*[^;\s]+;?/gi; e.commands.alignRightStyle = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, null, null, "text-align: right;", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, null, null, "text-align: right;", t) } } }(wysihtml5), function (e) { var t = /(\s|^)text-align\s*:\s*[^;\s]+;?/gi; e.commands.alignLeftStyle = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, null, null, "text-align: left;", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, null, null, "text-align: left;", t) } } }(wysihtml5), function (e) { var t = /(\s|^)text-align\s*:\s*[^;\s]+;?/gi; e.commands.alignCenterStyle = { exec: function (n, o) { return e.commands.formatBlock.exec(n, "formatBlock", null, null, null, "text-align: center;", t) }, state: function (n, o) { return e.commands.formatBlock.state(n, "formatBlock", null, null, null, "text-align: center;", t) } } }(wysihtml5), wysihtml5.commands.redo = { exec: function (e) { return e.undoManager.redo() }, state: function (e) { return !1 } }, wysihtml5.commands.underline = { exec: function (e, t) { wysihtml5.commands.formatInline.execWithToggle(e, t, "u") }, state: function (e, t) { return wysihtml5.commands.formatInline.state(e, t, "u") } }, wysihtml5.commands.undo = { exec: function (e) { return e.undoManager.undo() }, state: function (e) { return !1 } }, wysihtml5.commands.createTable = { exec: function (e, t, n) { var o, r, i; if (n && n.cols && n.rows && parseInt(n.cols, 10) > 0 && parseInt(n.rows, 10) > 0) { for (i = n.tableStyle ? '<table style="' + n.tableStyle + '">' : "<table>", i += "<tbody>", r = 0; r < n.rows; r++) { for (i += "<tr>", o = 0; o < n.cols; o++)i += "<td>&nbsp;</td>"; i += "</tr>" } i += "</tbody></table>", e.commands.exec("insertHTML", i) } }, state: function (e, t) { return !1 } }, wysihtml5.commands.mergeTableCells = { exec: function (e, t) { e.tableSelection && e.tableSelection.start && e.tableSelection.end && (this.state(e, t) ? wysihtml5.dom.table.unmergeCell(e.tableSelection.start) : wysihtml5.dom.table.mergeCellsBetween(e.tableSelection.start, e.tableSelection.end)) }, state: function (e, t) { if (e.tableSelection) { var n = e.tableSelection.start, o = e.tableSelection.end; if (n && o && n == o && (wysihtml5.dom.getAttribute(n, "colspan") && parseInt(wysihtml5.dom.getAttribute(n, "colspan"), 10) > 1 || wysihtml5.dom.getAttribute(n, "rowspan") && parseInt(wysihtml5.dom.getAttribute(n, "rowspan"), 10) > 1)) return [n] } return !1 } }, wysihtml5.commands.addTableCells = { exec: function (e, t, n) { if (e.tableSelection && e.tableSelection.start && e.tableSelection.end) { var o = wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start, e.tableSelection.end); "before" == n || "above" == n ? wysihtml5.dom.table.addCells(o.start, n) : "after" != n && "below" != n || wysihtml5.dom.table.addCells(o.end, n), setTimeout(function () { e.tableSelection.select(o.start, o.end) }, 0) } }, state: function (e, t) { return !1 } }, wysihtml5.commands.deleteTableCells = { exec: function (e, t, n) { if (e.tableSelection && e.tableSelection.start && e.tableSelection.end) { var o, r = wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start, e.tableSelection.end), i = wysihtml5.dom.table.indexOf(r.start), a = e.tableSelection.table; wysihtml5.dom.table.removeCells(r.start, n), setTimeout(function () { (o = wysihtml5.dom.table.findCell(a, i)) || ("row" == n && (o = wysihtml5.dom.table.findCell(a, { row: i.row - 1, col: i.col })), "column" == n && (o = wysihtml5.dom.table.findCell(a, { row: i.row, col: i.col - 1 }))), o && e.tableSelection.select(o, o) }, 0) } }, state: function (e, t) { return !1 } }, wysihtml5.commands.indentList = { exec: function (e, t, n) { var o = e.selection.getSelectionParentsByTag("LI"); return !!o && this.tryToPushLiLevel(o, e.selection) }, state: function (e, t) { return !1 }, tryToPushLiLevel: function (e, t) { var n, o, r, i, a, s = !1; return t.executeAndRestoreRangy(function () { for (var t = e.length; t--;)i = e[t], n = "OL" === i.parentNode.nodeName ? "OL" : "UL", o = i.ownerDocument.createElement(n), r = wysihtml5.dom.domNode(i).prev({ nodeTypes: [wysihtml5.ELEMENT_NODE] }), a = r ? r.querySelector("ul, ol") : null, r && (a ? a.appendChild(i) : (o.appendChild(i), r.appendChild(o)), s = !0) }), s } }, wysihtml5.commands.outdentList = { exec: function (e, t, n) { var o = e.selection.getSelectionParentsByTag("LI"); return !!o && this.tryToPullLiLevel(o, e) }, state: function (e, t) { return !1 }, tryToPullLiLevel: function (e, t) { var n, o, r, i, a, s = !1, l = this; return t.selection.executeAndRestoreRangy(function () { for (var c = e.length; c--;)if ((i = e[c]).parentNode && ("OL" === (n = i.parentNode).tagName || "UL" === n.tagName)) { if (s = !0, o = wysihtml5.dom.getParentElement(n.parentNode, { nodeName: ["OL", "UL"] }, !1, t.element), r = wysihtml5.dom.getParentElement(n.parentNode, { nodeName: ["LI"] }, !1, t.element), o && r) i.nextSibling && (a = l.getAfterList(n, i), i.appendChild(a)), o.insertBefore(i, r.nextSibling); else { i.nextSibling && (a = l.getAfterList(n, i), i.appendChild(a)); for (var d = i.childNodes.length; d--;)n.parentNode.insertBefore(i.childNodes[d], n.nextSibling); n.parentNode.insertBefore(document.createElement("br"), n.nextSibling), i.parentNode.removeChild(i) } 0 === n.childNodes.length && n.parentNode.removeChild(n) } }), s }, getAfterList: function (e, t) { for (var n = e.nodeName, o = document.createElement(n); t.nextSibling;)o.appendChild(t.nextSibling); return o } }, function (e) { var t = "data-wysihtml5-selection-node", n = "data-wysihtml5-selection-offset", o = (e.INVISIBLE_SPACE, e.INVISIBLE_SPACE, e.dom); e.UndoManager = e.lang.Dispatcher.extend({ constructor: function (e) { this.editor = e, this.composer = e.composer, this.element = this.composer.element, this.position = 0, this.historyStr = [], this.historyDom = [], this.transact(), this._observe() }, _observe: function () { var e, t = this; this.composer.sandbox.getDocument(); o.observe(this.element, "keydown", function (e) { if (!e.altKey && (e.ctrlKey || e.metaKey)) { var n = e.keyCode, o = 90 === n && !e.shiftKey, r = 90 === n && e.shiftKey || 89 === n; o ? (t.undo(), e.preventDefault()) : r && (t.redo(), e.preventDefault()) } }), o.observe(this.element, "keydown", function (n) { var o = n.keyCode; o !== e && (e = o, 8 !== o && 46 !== o || t.transact()) }), this.editor.on("newword:composer", function () { t.transact() }).on("beforecommand:composer", function () { t.transact() }) }, transact: function () { var o, r, i, a, s, l = this.historyStr[this.position - 1], c = this.composer.getValue(!1, !1), d = this.element.offsetWidth > 0 && this.element.offsetHeight > 0; if (c !== l) { (this.historyStr.length = this.historyDom.length = this.position) > 25 && (this.historyStr.shift(), this.historyDom.shift(), this.position--), this.position++ , d && (r = (o = this.composer.selection.getRange()) && o.startContainer ? o.startContainer : this.element, i = o && o.startOffset ? o.startOffset : 0, r.nodeType === e.ELEMENT_NODE ? a = r : (a = r.parentNode, s = this.getChildNodeIndex(a, r)), a.setAttribute(n, i), void 0 !== s && a.setAttribute(t, s)); var u = this.element.cloneNode(!!c); this.historyDom.push(u), this.historyStr.push(c), a && (a.removeAttribute(n), a.removeAttribute(t)) } }, undo: function () { this.transact(), this.undoPossible() && (this.set(this.historyDom[--this.position - 1]), this.editor.fire("undo:composer")) }, redo: function () { this.redoPossible() && (this.set(this.historyDom[++this.position - 1]), this.editor.fire("redo:composer")) }, undoPossible: function () { return this.position > 1 }, redoPossible: function () { return this.position < this.historyStr.length }, set: function (e) { this.element.innerHTML = ""; for (var o, r, i, a = 0, s = e.childNodes, l = e.childNodes.length; a < l; a++)this.element.appendChild(s[a].cloneNode(!0)); e.hasAttribute(n) ? (o = e.getAttribute(n), i = e.getAttribute(t), r = this.element) : (o = (r = this.element.querySelector("[" + n + "]") || this.element).getAttribute(n), i = r.getAttribute(t), r.removeAttribute(n), r.removeAttribute(t)), null !== i && (r = this.getChildNodeByIndex(r, +i)), this.composer.selection.set(r, o) }, getChildNodeIndex: function (e, t) { for (var n = 0, o = e.childNodes, r = o.length; n < r; n++)if (o[n] === t) return n }, getChildNodeByIndex: function (e, t) { return e.childNodes[t] } }) }(wysihtml5), wysihtml5.views.View = Base.extend({ constructor: function (e, t, n) { this.parent = e, this.element = t, this.config = n, this.config.noTextarea || this._observeViewChange() }, _observeViewChange: function () { var e = this; this.parent.on("beforeload", function () { e.parent.on("change_view", function (t) { t === e.name ? (e.parent.currentView = e, e.show(), setTimeout(function () { e.focus() }, 0)) : e.hide() }) }) }, focus: function () { if (this.element.ownerDocument.querySelector(":focus") !== this.element) try { this.element.focus() } catch (e) { } }, hide: function () { this.element.style.display = "none" }, show: function () { this.element.style.display = "" }, disable: function () { this.element.setAttribute("disabled", "disabled") }, enable: function () { this.element.removeAttribute("disabled") } }), function (e) { var t = e.dom, n = e.browser; e.views.Composer = e.views.View.extend({ name: "composer", CARET_HACK: "<br>", constructor: function (e, t, n) { this.base(e, t, n), this.config.noTextarea ? this.editableArea = t : this.textarea = this.parent.textarea, this.config.contentEditableMode ? this._initContentEditableArea() : this._initSandbox() }, clear: function () { this.element.innerHTML = n.displaysCaretInEmptyContentEditableCorrectly() ? "" : this.CARET_HACK }, getValue: function (t, n) { var o = this.isEmpty() ? "" : e.quirks.getCorrectInnerHTML(this.element); return !1 !== t && (o = this.parent.parse(o, !1 !== n)), o }, setValue: function (e, t) { t && (e = this.parent.parse(e)); try { this.element.innerHTML = e } catch (t) { this.element.innerText = e } }, cleanUp: function () { this.parent.parse(this.element) }, show: function () { this.editableArea.style.display = this._displayStyle || "", this.config.noTextarea || this.textarea.element.disabled || (this.disable(), this.enable()) }, hide: function () { this._displayStyle = t.getStyle("display").from(this.editableArea), "none" === this._displayStyle && (this._displayStyle = null), this.editableArea.style.display = "none" }, disable: function () { this.parent.fire("disable:composer"), this.element.removeAttribute("contentEditable") }, enable: function () { this.parent.fire("enable:composer"), this.element.setAttribute("contentEditable", "true") }, focus: function (t) { e.browser.doesAsyncFocus() && this.hasPlaceholderSet() && this.clear(), this.base(); var n = this.element.lastChild; t && n && this.selection && ("BR" === n.nodeName ? this.selection.setBefore(this.element.lastChild) : this.selection.setAfter(this.element.lastChild)) }, getTextContent: function () { return t.getTextContent(this.element) }, hasPlaceholderSet: function () { return this.getTextContent() == (this.config.noTextarea ? this.editableArea.getAttribute("data-placeholder") : this.textarea.element.getAttribute("placeholder")) && this.placeholderSet }, isEmpty: function () { var e = this.element.innerHTML.toLowerCase(); return /^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e) || "" === e || "<br>" === e || "<p></p>" === e || "<p><br></p>" === e || this.hasPlaceholderSet() }, _initContentEditableArea: function () { var e = this; this.config.noTextarea ? this.sandbox = new t.ContentEditableArea(function () { e._create() }, {}, this.editableArea) : (this.sandbox = new t.ContentEditableArea(function () { e._create() }), this.editableArea = this.sandbox.getContentEditable(), t.insert(this.editableArea).after(this.textarea.element), this._createWysiwygFormField()) }, _initSandbox: function () { var e = this; this.sandbox = new t.Sandbox(function () { e._create() }, { stylesheets: this.config.stylesheets }), this.editableArea = this.sandbox.getIframe(); var n = this.textarea.element; t.insert(this.editableArea).after(n), this._createWysiwygFormField() }, _createWysiwygFormField: function () { if (this.textarea.element.form) { var e = document.createElement("input"); e.type = "hidden", e.name = "_wysihtml5_mode", e.value = 1, t.insert(e).after(this.textarea.element) } }, _create: function () { var o = this; this.doc = this.sandbox.getDocument(), this.element = this.config.contentEditableMode ? this.sandbox.getContentEditable() : this.doc.body, this.config.noTextarea ? this.cleanUp() : (this.textarea = this.parent.textarea, this.element.innerHTML = this.textarea.getValue(!0, !1)), this.selection = new e.Selection(this.parent, this.element, this.config.uneditableContainerClassname), this.commands = new e.Commands(this.parent), this.config.noTextarea || t.copyAttributes(["className", "spellcheck", "title", "lang", "dir", "accessKey"]).from(this.textarea.element).to(this.element), t.addClass(this.element, this.config.composerClassName), this.config.style && !this.config.contentEditableMode && this.style(), this.observe(); var r = this.config.name; r && (t.addClass(this.element, r), this.config.contentEditableMode || t.addClass(this.editableArea, r)), this.enable(), !this.config.noTextarea && this.textarea.element.disabled && this.disable(); var i = "string" == typeof this.config.placeholder ? this.config.placeholder : this.config.noTextarea ? this.editableArea.getAttribute("data-placeholder") : this.textarea.element.getAttribute("placeholder"); i && t.simulatePlaceholder(this.parent, this, i), this.commands.exec("styleWithCSS", !1), this._initAutoLinking(), this._initObjectResizing(), this._initUndoManager(), this._initLineBreaking(), this.config.noTextarea || !this.textarea.element.hasAttribute("autofocus") && document.querySelector(":focus") != this.textarea.element || n.isIos() || setTimeout(function () { o.focus(!0) }, 100), n.clearsContentEditableCorrectly() || e.quirks.ensureProperClearing(this), this.initSync && this.config.sync && this.initSync(), this.config.noTextarea || this.textarea.hide(), this.parent.fire("beforeload").fire("load") }, _initAutoLinking: function () { var o = this, r = n.canDisableAutoLinking(), i = n.doesAutoLinkingInContentEditable(); if (r && this.commands.exec("autoUrlDetect", !1), this.config.autoLink) { (!i || i && r) && (this.parent.on("newword:composer", function () { t.getTextContent(o.element).match(t.autoLink.URL_REG_EXP) && o.selection.executeAndRestore(function (n, r) { for (var i = o.element.querySelectorAll("." + o.config.uneditableContainerClassname), a = !1, s = i.length; s--;)e.dom.contains(i[s], r) && (a = !0); a || t.autoLink(r.parentNode, [o.config.uneditableContainerClassname]) }) }), t.observe(this.element, "blur", function () { t.autoLink(o.element, [o.config.uneditableContainerClassname]) })); var a = this.sandbox.getDocument().getElementsByTagName("a"), s = t.autoLink.URL_REG_EXP, l = function (n) { var o = e.lang.string(t.getTextContent(n)).trim(); return "www." === o.substr(0, 4) && (o = "http://" + o), o }; t.observe(this.element, "keydown", function (e) { if (a.length) { var n, r = o.selection.getSelectedNode(e.target.ownerDocument), i = t.getParentElement(r, { nodeName: "A" }, 4); i && (n = l(i), setTimeout(function () { var e = l(i); e !== n && e.match(s) && i.setAttribute("href", e) }, 0)) } }) } }, _initObjectResizing: function () { if (this.commands.exec("enableObjectResizing", !0), n.supportsEvent("resizeend")) { var o = ["width", "height"], r = o.length, i = this.element; t.observe(i, "resizeend", function (t) { var n, a = t.target || t.srcElement, s = a.style, l = 0; if ("IMG" === a.nodeName) { for (; l < r; l++)s[n = o[l]] && (a.setAttribute(n, parseInt(s[n], 10)), s[n] = ""); e.quirks.redraw(i) } }) } }, _initUndoManager: function () { this.undoManager = new e.UndoManager(this.parent) }, _initLineBreaking: function () { var o = this, r = ["LI", "P", "H1", "H2", "H3", "H4", "H5", "H6"], i = ["UL", "OL", "MENU"]; function a(e) { var n = t.getParentElement(e, { nodeName: ["P", "DIV"] }, 2); n && t.contains(o.element, n) && o.selection.executeAndRestore(function () { o.config.useLineBreaks ? t.replaceWithChildNodes(n) : "P" !== n.nodeName && t.renameElement(n, "p") }) } this.config.useLineBreaks || t.observe(this.element, ["focus", "keydown"], function () { if (o.isEmpty()) { var e = o.doc.createElement("P"); o.element.innerHTML = "", o.element.appendChild(e), n.displaysCaretInEmptyContentEditableCorrectly() ? o.selection.selectNode(e, !0) : (e.innerHTML = "<br>", o.selection.setBefore(e.firstChild)) } }), t.observe(this.element, "keydown", function (n) { var s = n.keyCode; if (!n.shiftKey && (s === e.ENTER_KEY || s === e.BACKSPACE_KEY)) { var l = t.getParentElement(o.selection.getSelectedNode(), { nodeName: r }, 4); l ? setTimeout(function () { var n = o.selection.getSelectedNode(); if ("LI" === l.nodeName) { if (!n) return; t.getParentElement(n, { nodeName: i }, 2) || a(n) } s === e.ENTER_KEY && l.nodeName.match(/^H[1-6]$/) && a(n) }, 0) : o.config.useLineBreaks && s === e.ENTER_KEY && !e.browser.insertsLineBreaksOnReturn() && (n.preventDefault(), o.commands.exec("insertLineBreak")) } }) } }) }(wysihtml5), function (e) { var t = e.dom, n = document, o = window, r = n.createElement("div"), i = ["background-color", "color", "cursor", "font-family", "font-size", "font-style", "font-variant", "font-weight", "line-height", "letter-spacing", "text-align", "text-decoration", "text-indent", "text-rendering", "word-break", "word-wrap", "word-spacing"], a = ["background-color", "border-collapse", "border-bottom-color", "border-bottom-style", "border-bottom-width", "border-left-color", "border-left-style", "border-left-width", "border-right-color", "border-right-style", "border-right-width", "border-top-color", "border-top-style", "border-top-width", "clear", "display", "float", "margin-bottom", "margin-left", "margin-right", "margin-top", "outline-color", "outline-offset", "outline-width", "outline-style", "padding-left", "padding-right", "padding-top", "padding-bottom", "position", "top", "left", "right", "bottom", "z-index", "vertical-align", "text-align", "-webkit-box-sizing", "-moz-box-sizing", "-ms-box-sizing", "box-sizing", "-webkit-box-shadow", "-moz-box-shadow", "-ms-box-shadow", "box-shadow", "-webkit-border-top-right-radius", "-moz-border-radius-topright", "border-top-right-radius", "-webkit-border-bottom-right-radius", "-moz-border-radius-bottomright", "border-bottom-right-radius", "-webkit-border-bottom-left-radius", "-moz-border-radius-bottomleft", "border-bottom-left-radius", "-webkit-border-top-left-radius", "-moz-border-radius-topleft", "border-top-left-radius", "width", "height"], s = ["html                 { height: 100%; }", "body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }", "body > p:first-child { margin-top: 0; }", "._wysihtml5-temp     { display: none; }", e.browser.isGecko ? "body.placeholder { color: graytext !important; }" : "body.placeholder { color: #a9a9a9 !important; }", "img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"]; e.views.Composer.prototype.style = function () { var l, c = this, d = n.querySelector(":focus"), u = this.textarea.element, h = u.hasAttribute("placeholder"), f = h && u.getAttribute("placeholder"), m = u.style.display, p = u.disabled; this.focusStylesHost = r.cloneNode(!1), this.blurStylesHost = r.cloneNode(!1), this.disabledStylesHost = r.cloneNode(!1), h && u.removeAttribute("placeholder"), u === d && u.blur(), u.disabled = !1, u.style.display = l = "none", (u.getAttribute("rows") && "auto" === t.getStyle("height").from(u) || u.getAttribute("cols") && "auto" === t.getStyle("width").from(u)) && (u.style.display = l = m), t.copyStyles(a).from(u).to(this.editableArea).andTo(this.blurStylesHost), t.copyStyles(i).from(u).to(this.element).andTo(this.blurStylesHost), t.insertCSS(s).into(this.element.ownerDocument), u.disabled = !0, t.copyStyles(a).from(u).to(this.disabledStylesHost), t.copyStyles(i).from(u).to(this.disabledStylesHost), u.disabled = p, u.style.display = m, function (e) { if (e.setActive) try { e.setActive() } catch (e) { } else { var r = e.style, i = n.documentElement.scrollTop || n.body.scrollTop, a = n.documentElement.scrollLeft || n.body.scrollLeft, s = { position: r.position, top: r.top, left: r.left, WebkitUserSelect: r.WebkitUserSelect }; t.setStyles({ position: "absolute", top: "-99999px", left: "-99999px", WebkitUserSelect: "none" }).on(e), e.focus(), t.setStyles(s).on(e), o.scrollTo && o.scrollTo(a, i) } }(u), u.style.display = l, t.copyStyles(a).from(u).to(this.focusStylesHost), t.copyStyles(i).from(u).to(this.focusStylesHost), u.style.display = m, t.copyStyles(["display"]).from(u).to(this.editableArea); var g = e.lang.array(a).without(["display"]); return d ? d.focus() : u.blur(), h && u.setAttribute("placeholder", f), this.parent.on("focus:composer", function () { t.copyStyles(g).from(c.focusStylesHost).to(c.editableArea), t.copyStyles(i).from(c.focusStylesHost).to(c.element) }), this.parent.on("blur:composer", function () { t.copyStyles(g).from(c.blurStylesHost).to(c.editableArea), t.copyStyles(i).from(c.blurStylesHost).to(c.element) }), this.parent.observe("disable:composer", function () { t.copyStyles(g).from(c.disabledStylesHost).to(c.editableArea), t.copyStyles(i).from(c.disabledStylesHost).to(c.element) }), this.parent.observe("enable:composer", function () { t.copyStyles(g).from(c.blurStylesHost).to(c.editableArea), t.copyStyles(i).from(c.blurStylesHost).to(c.element) }), this } }(wysihtml5), function (e) { var t = e.dom, n = e.browser, o = { 66: "bold", 73: "italic", 85: "underline" }; e.views.Composer.prototype.observe = function () { var r = this, i = this.getValue(!1, !1), a = this.sandbox.getIframe ? this.sandbox.getIframe() : this.sandbox.getContentEditable(), s = this.element, l = n.supportsEventsInIframeCorrectly() || this.sandbox.getContentEditable ? s : this.sandbox.getWindow(); if (t.observe(a, "DOMNodeRemoved", function () { clearInterval(c), r.parent.fire("destroy:composer") }), !n.supportsMutationEvents()) var c = setInterval(function () { t.contains(document.documentElement, a) || (clearInterval(c), r.parent.fire("destroy:composer")) }, 250); t.observe(l, ["drop", "paste", "mouseup", "focus", "keyup"], function () { setTimeout(function () { r.parent.fire("interaction").fire("interaction:composer") }, 0) }), this.config.handleTables && (!this.tableClickHandle && this.doc.execCommand && e.browser.supportsCommand(this.doc, "enableObjectResizing") && e.browser.supportsCommand(this.doc, "enableInlineTableEditing") && (this.sandbox.getIframe ? this.tableClickHandle = t.observe(a, ["focus", "mouseup", "mouseover"], function () { r.doc.execCommand("enableObjectResizing", !1, "false"), r.doc.execCommand("enableInlineTableEditing", !1, "false"), r.tableClickHandle.stop() }) : setTimeout(function () { r.doc.execCommand("enableObjectResizing", !1, "false"), r.doc.execCommand("enableInlineTableEditing", !1, "false") }, 0)), this.tableSelection = e.quirks.tableCellsSelection(s, r.parent)), t.observe(l, "focus", function (e) { r.parent.fire("focus", e).fire("focus:composer", e), setTimeout(function () { i = r.getValue(!1, !1) }, 0) }), t.observe(l, "blur", function (e) { if (i !== r.getValue(!1, !1)) { var t = e; "function" == typeof Object.create && (t = Object.create(e, { type: { value: "change" } })), r.parent.fire("change", t).fire("change:composer", t) } r.parent.fire("blur", e).fire("blur:composer", e) }), t.observe(s, "dragenter", function () { r.parent.fire("unset_placeholder") }), t.observe(s, ["drop", "paste", "beforepaste"], function (e) { r.parent.fire(e.type, e).fire(e.type + ":composer", e) }), this.config.copyedFromMarking && t.observe(s, "copy", function (e) { e.clipboardData && (e.clipboardData.setData("text/html", r.config.copyedFromMarking + r.selection.getHtml()), e.preventDefault()), r.parent.fire(e.type, e).fire(e.type + ":composer", e) }), t.observe(s, "keyup", function (t) { var n = t.keyCode; n !== e.SPACE_KEY && n !== e.ENTER_KEY || r.parent.fire("newword:composer") }), this.parent.on("paste:composer", function () { setTimeout(function () { r.parent.fire("newword:composer") }, 0) }), n.canSelectImagesInContentEditable() || t.observe(s, "mousedown", function (t) { var n = t.target, o = s.querySelectorAll("img"), i = s.querySelectorAll("." + r.config.uneditableContainerClassname + " img"), a = e.lang.array(o).without(i); "IMG" === n.nodeName && e.lang.array(a).contains(n) && r.selection.selectNode(n) }), n.canSelectImagesInContentEditable() || t.observe(s, "drop", function (e) { setTimeout(function () { r.selection.getSelection().removeAllRanges() }, 0) }), n.hasHistoryIssue() && n.supportsSelectionModify() && t.observe(s, "keydown", function (e) { if (e.metaKey || e.ctrlKey) { var t = e.keyCode, n = s.ownerDocument.defaultView.getSelection(); 37 !== t && 39 !== t || (37 === t && (n.modify("extend", "left", "lineboundary"), e.shiftKey || n.collapseToStart()), 39 === t && (n.modify("extend", "right", "lineboundary"), e.shiftKey || n.collapseToEnd()), e.preventDefault()) } }), t.observe(s, "keydown", function (e) { var t = e.keyCode, n = o[t]; (e.ctrlKey || e.metaKey) && !e.altKey && n && (r.commands.exec(n), e.preventDefault()), 8 === t ? function (e, t, n, o) { if (t.isCollapsed()) if (t.caretIsInTheBeginnig("LI")) e.preventDefault(), o.commands.exec("outdentList"); else if (t.caretIsInTheBeginnig()) e.preventDefault(); else { if (t.caretIsFirstInSelection() && t.getPreviousNode() && t.getPreviousNode().nodeName && /^H\d$/gi.test(t.getPreviousNode().nodeName)) { var r = t.getPreviousNode(); if (e.preventDefault(), /^\s*$/.test(r.textContent || r.innerText)) r.parentNode.removeChild(r); else { var i = r.ownerDocument.createRange(); i.selectNodeContents(r), i.collapse(!1), t.setSelection(i) } } var a = t.caretIsBeforeUneditable(); a && (e.preventDefault(), function (e, t, n) { var o = e.getPreviousNode(t, !0), r = e.getSelectedNode(); if (1 !== r.nodeType && r.parentNode !== n && (r = r.parentNode), o) if (1 == r.nodeType) { var i = r.firstChild; if (1 == o.nodeType) for (; r.firstChild;)o.appendChild(r.firstChild); else for (; r.firstChild;)t.parentNode.insertBefore(r.firstChild, t); r.parentNode && r.parentNode.removeChild(r), e.setBefore(i) } else 1 == o.nodeType ? o.appendChild(r) : t.parentNode.insertBefore(r, t), e.setBefore(r) }(t, a, n)) } else t.containsUneditable() && (e.preventDefault(), t.deleteContents()) }(e, r.selection, s, r) : r.config.handleTabKey && 9 === t && (e.preventDefault(), function (e, t) { if (e.selection.isCollapsed()) { if (e.selection.caretIsInTheBeginnig("LI") && e.commands.exec("indentList")) return } else e.selection.deleteContents(); e.commands.exec("insertHTML", "&emsp;") }(r)) }), t.observe(s, "keydown", function (t) { var n, o = r.selection.getSelectedNode(!0), i = t.keyCode; !o || "IMG" !== o.nodeName || i !== e.BACKSPACE_KEY && i !== e.DELETE_KEY || ((n = o.parentNode).removeChild(o), "A" !== n.nodeName || n.firstChild || n.parentNode.removeChild(n), setTimeout(function () { e.quirks.redraw(s) }, 0), t.preventDefault()) }), !this.config.contentEditableMode && n.hasIframeFocusIssue() && (t.observe(a, "focus", function () { setTimeout(function () { r.doc.querySelector(":focus") !== r.element && r.focus() }, 0) }), t.observe(this.element, "blur", function () { setTimeout(function () { r.selection.getSelection().removeAllRanges() }, 0) })); var d = { IMG: "Image: ", A: "Link: " }; t.observe(s, "mouseover", function (e) { var t, n = e.target, o = n.nodeName; "A" !== o && "IMG" !== o || (n.hasAttribute("title") || (t = d[o] + (n.getAttribute("href") || n.getAttribute("src")), n.setAttribute("title", t))) }) } }(wysihtml5), function (e) { e.views.Synchronizer = Base.extend({ constructor: function (e, t, n) { this.editor = e, this.textarea = t, this.composer = n, this._observe() }, fromComposerToTextarea: function (t) { this.textarea.setValue(e.lang.string(this.composer.getValue(!1, !1)).trim(), t) }, fromTextareaToComposer: function (e) { var t = this.textarea.getValue(!1, !1); t ? this.composer.setValue(t, e) : (this.composer.clear(), this.editor.fire("set_placeholder")) }, sync: function (e) { "textarea" === this.editor.currentView.name ? this.fromTextareaToComposer(e) : this.fromComposerToTextarea(e) }, _observe: function () { var t, n = this, o = this.textarea.element.form, r = function () { t = setInterval(function () { n.fromComposerToTextarea() }, 400) }, i = function () { clearInterval(t), t = null }; r(), o && (e.dom.observe(o, "submit", function () { n.sync(!0) }), e.dom.observe(o, "reset", function () { setTimeout(function () { n.fromTextareaToComposer() }, 0) })), this.editor.on("change_view", function (e) { "composer" !== e || t ? "textarea" === e && (n.fromComposerToTextarea(!0), i()) : (n.fromTextareaToComposer(!0), r()) }), this.editor.on("destroy:composer", i) } }) }(wysihtml5), wysihtml5.views.Textarea = wysihtml5.views.View.extend({ name: "textarea", constructor: function (e, t, n) { this.base(e, t, n), this._observe() }, clear: function () { this.element.value = "" }, getValue: function (e) { var t = this.isEmpty() ? "" : this.element.value; return !1 !== e && (t = this.parent.parse(t)), t }, setValue: function (e, t) { t && (e = this.parent.parse(e)), this.element.value = e }, cleanUp: function () { var e = this.parent.parse(this.element.value); this.element.value = e }, hasPlaceholderSet: function () { var e = wysihtml5.browser.supportsPlaceholderAttributeOn(this.element), t = this.element.getAttribute("placeholder") || null, n = this.element.value; return e && !n || n === t }, isEmpty: function () { return !wysihtml5.lang.string(this.element.value).trim() || this.hasPlaceholderSet() }, _observe: function () { var e = this.element, t = this.parent, n = { focusin: "focus", focusout: "blur" }, o = wysihtml5.browser.supportsEvent("focusin") ? ["focusin", "focusout", "change"] : ["focus", "blur", "change"]; t.on("beforeload", function () { wysihtml5.dom.observe(e, o, function (e) { var o = n[e.type] || e.type; t.fire(o).fire(o + ":textarea") }), wysihtml5.dom.observe(e, ["paste", "drop"], function () { setTimeout(function () { t.fire("paste").fire("paste:textarea") }, 0) }) }) } }), function (e) { var t = { name: void 0, style: !0, toolbar: void 0, showToolbarAfterInit: !0, autoLink: !0, handleTables: !0, handleTabKey: !0, parserRules: { tags: { br: {}, span: {}, div: {}, p: {} }, classes: {} }, pasteParserRulesets: null, parser: e.dom.parse, composerClassName: "wysihtml5-editor", bodyClassName: "wysihtml5-supported", useLineBreaks: !0, stylesheets: [], placeholderText: void 0, supportTouchDevices: !0, cleanUp: !0, contentEditableMode: !1, uneditableContainerClassname: "wysihtml5-uneditable-container", copyedFromMarking: '<meta name="copied-from" content="wysihtml5">' }; e.Editor = e.lang.Dispatcher.extend({ constructor: function (n, o) { if (this.editableElement = "string" == typeof n ? document.getElementById(n) : n, this.config = e.lang.object({}).merge(t).merge(o).get(), this._isCompatible = e.browser.supported(), "textarea" != this.editableElement.nodeName.toLowerCase() && (this.config.contentEditableMode = !0, this.config.noTextarea = !0), this.config.noTextarea || (this.textarea = new e.views.Textarea(this, this.editableElement, this.config), this.currentView = this.textarea), !this._isCompatible || !this.config.supportTouchDevices && e.browser.isTouchDevice()) { var r = this; setTimeout(function () { r.fire("beforeload").fire("load") }, 0) } else e.dom.addClass(document.body, this.config.bodyClassName), this.composer = new e.views.Composer(this, this.editableElement, this.config), this.currentView = this.composer, "function" == typeof this.config.parser && this._initParser(), this.on("beforeload", this.handleBeforeLoad) }, handleBeforeLoad: function () { this.config.noTextarea || (this.synchronizer = new e.views.Synchronizer(this, this.textarea, this.composer)), this.config.toolbar && (this.toolbar = new e.toolbar.Toolbar(this, this.config.toolbar, this.config.showToolbarAfterInit)) }, isCompatible: function () { return this._isCompatible }, clear: function () { return this.currentView.clear(), this }, getValue: function (e, t) { return this.currentView.getValue(e, t) }, setValue: function (e, t) { return this.fire("unset_placeholder"), e ? (this.currentView.setValue(e, t), this) : this.clear() }, cleanUp: function () { this.currentView.cleanUp() }, focus: function (e) { return this.currentView.focus(e), this }, disable: function () { return this.currentView.disable(), this }, enable: function () { return this.currentView.enable(), this }, isEmpty: function () { return this.currentView.isEmpty() }, hasPlaceholderSet: function () { return this.currentView.hasPlaceholderSet() }, parse: function (t, n) { var o = this.config.contentEditableMode ? document : this.composer ? this.composer.sandbox.getDocument() : null, r = this.config.parser(t, { rules: this.config.parserRules, cleanUp: this.config.cleanUp, context: o, uneditableClass: this.config.uneditableContainerClassname, clearInternals: n }); return "object" == typeof t && e.quirks.redraw(t), r }, _initParser: function () { var t, n = this; e.browser.supportsModenPaste() ? this.on("paste:composer", function (o) { o.preventDefault(), (t = e.dom.getPastedHtml(o)) && n._cleanAndPaste(t) }) : this.on("beforepaste:composer", function (t) { t.preventDefault(), e.dom.getPastedHtmlWithDiv(n.composer, function (e) { e && n._cleanAndPaste(e) }) }) }, _cleanAndPaste: function (t) { var n = e.quirks.cleanPastedHTML(t, { referenceNode: this.composer.element, rules: this.config.pasteParserRulesets || [{ set: this.config.parserRules }], uneditableClass: this.config.uneditableContainerClassname }); this.composer.selection.deleteContents(), this.composer.selection.insertHTML(n) } }) }(wysihtml5), function (e) { var t = e.dom, n = "wysihtml5-command-dialog-opened"; e.toolbar.Dialog = e.lang.Dispatcher.extend({ constructor: function (e, t) { this.link = e, this.container = t }, _observe: function () { if (!this._observed) { var o = this, r = function (e) { var t = o._serialize(); t == o.elementToChange ? o.fire("edit", t) : o.fire("save", t), o.hide(), e.preventDefault(), e.stopPropagation() }; t.observe(o.link, "click", function () { t.hasClass(o.link, n) && setTimeout(function () { o.hide() }, 0) }), t.observe(this.container, "keydown", function (t) { var n = t.keyCode; n === e.ENTER_KEY && r(t), n === e.ESCAPE_KEY && (o.fire("cancel"), o.hide()) }), t.delegate(this.container, "[data-wysihtml5-dialog-action=save]", "click", r), t.delegate(this.container, "[data-wysihtml5-dialog-action=cancel]", "click", function (e) { o.fire("cancel"), o.hide(), e.preventDefault(), e.stopPropagation() }); for (var i = this.container.querySelectorAll("input, select, textarea"), a = 0, s = i.length, l = function () { clearInterval(o.interval) }; a < s; a++)t.observe(i[a], "change", l); this._observed = !0 } }, _serialize: function () { for (var e = this.elementToChange || {}, t = this.container.querySelectorAll("[data-wysihtml5-dialog-field]"), n = t.length, o = 0; o < n; o++)e[t[o].getAttribute("data-wysihtml5-dialog-field")] = t[o].value; return e }, _interpolate: function (e) { for (var t, n, o, r = document.querySelector(":focus"), i = this.container.querySelectorAll("[data-wysihtml5-dialog-field]"), a = i.length, s = 0; s < a; s++)(t = i[s]) !== r && (e && "hidden" === t.type || (n = t.getAttribute("data-wysihtml5-dialog-field"), o = this.elementToChange && "boolean" != typeof this.elementToChange ? this.elementToChange.getAttribute(n) || "" : t.defaultValue, t.value = o)) }, show: function (e) { if (!t.hasClass(this.link, n)) { var o = this, r = this.container.querySelector("input, select, textarea"); if (this.elementToChange = e, this._observe(), this._interpolate(), e && (this.interval = setInterval(function () { o._interpolate(!0) }, 500)), t.addClass(this.link, n), this.container.style.display = "", this.fire("show"), r && !e) try { r.focus() } catch (e) { } } }, hide: function () { clearInterval(this.interval), this.elementToChange = null, t.removeClass(this.link, n), this.container.style.display = "none", this.fire("hide") } }) }(wysihtml5), function (e) { var t = e.dom, n = { position: "relative" }, o = { left: 0, margin: 0, opacity: 0, overflow: "hidden", padding: 0, position: "absolute", top: 0, zIndex: 1 }, r = { cursor: "inherit", fontSize: "50px", height: "50px", marginTop: "-25px", outline: 0, padding: 0, position: "absolute", right: "-4px", top: "50%" }, i = { "x-webkit-speech": "", speech: "" }; e.toolbar.Speech = function (a, s) { var l = document.createElement("input"); if (e.browser.supportsSpeechApiOn(l)) { var c = a.editor.textarea.element.getAttribute("lang"); c && (i.lang = c); var d = document.createElement("div"); e.lang.object(o).merge({ width: s.offsetWidth + "px", height: s.offsetHeight + "px" }), t.insert(l).into(d), t.insert(d).into(s), t.setStyles(r).on(l), t.setAttributes(i).on(l), t.setStyles(o).on(d), t.setStyles(n).on(s); var u = "onwebkitspeechchange" in l ? "webkitspeechchange" : "speechchange"; t.observe(l, u, function () { a.execCommand("insertText", l.value), l.value = "" }), t.observe(l, "click", function (e) { t.hasClass(s, "wysihtml5-command-disabled") && e.preventDefault(), e.stopPropagation() }) } else s.style.display = "none" } }(wysihtml5), function (e) { var t = "wysihtml5-command-disabled", n = "wysihtml5-commands-disabled", o = "wysihtml5-command-active", r = "wysihtml5-action-active", i = e.dom; e.toolbar.Toolbar = Base.extend({ constructor: function (i, a, s) { this.editor = i, this.container = "string" == typeof a ? document.getElementById(a) : a, this.composer = i.composer, this._getLinks("command"), this._getLinks("action"), this._observe(), s && this.show(), null != i.config.classNameCommandDisabled && (t = i.config.classNameCommandDisabled), null != i.config.classNameCommandsDisabled && (n = i.config.classNameCommandsDisabled), null != i.config.classNameCommandActive && (o = i.config.classNameCommandActive), null != i.config.classNameActionActive && (r = i.config.classNameActionActive); for (var l = this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"), c = l.length, d = 0; d < c; d++)new e.toolbar.Speech(this, l[d]) }, _getLinks: function (t) { for (var n, o, r, i, a, s = this[t + "Links"] = e.lang.array(this.container.querySelectorAll("[data-wysihtml5-" + t + "]")).get(), l = s.length, c = 0, d = this[t + "Mapping"] = {}; c < l; c++)r = (n = s[c]).getAttribute("data-wysihtml5-" + t), i = n.getAttribute("data-wysihtml5-" + t + "-value"), o = this.container.querySelector("[data-wysihtml5-" + t + "-group='" + r + "']"), a = this._getDialog(n, r), d[r + ":" + i] = { link: n, group: o, name: r, value: i, dialog: a, state: !1 } }, _getDialog: function (t, n) { var o, r, i = this, a = this.container.querySelector("[data-wysihtml5-dialog='" + n + "']"); return a && ((o = e.toolbar["Dialog_" + n] ? new e.toolbar["Dialog_" + n](t, a) : new e.toolbar.Dialog(t, a)).on("show", function () { r = i.composer.selection.getBookmark(), i.editor.fire("show:dialog", { command: n, dialogContainer: a, commandLink: t }) }), o.on("save", function (e) { r && i.composer.selection.setBookmark(r), i._execCommand(n, e), i.editor.fire("save:dialog", { command: n, dialogContainer: a, commandLink: t }) }), o.on("cancel", function () { i.editor.focus(!1), i.editor.fire("cancel:dialog", { command: n, dialogContainer: a, commandLink: t }) })), o }, execCommand: function (e, t) { if (!this.commandsDisabled) { var n = this.commandMapping[e + ":" + t]; n && n.dialog && !n.state ? n.dialog.show() : this._execCommand(e, t) } }, _execCommand: function (e, t) { this.editor.focus(!1), this.composer.commands.exec(e, t), this._updateLinkStates() }, execAction: function (e) { var t = this.editor; "change_view" === e && t.textarea && (t.currentView === t.textarea ? t.fire("change_view", "composer") : t.fire("change_view", "textarea")), "showSource" == e && t.fire("showSource") }, _observe: function () { for (var e = this, t = this.editor, o = this.container, r = this.commandLinks.concat(this.actionLinks), a = r.length, s = 0; s < a; s++)"A" === r[s].nodeName ? i.setAttributes({ href: "javascript:;", unselectable: "on" }).on(r[s]) : i.setAttributes({ unselectable: "on" }).on(r[s]); i.delegate(o, "[data-wysihtml5-command], [data-wysihtml5-action]", "mousedown", function (e) { e.preventDefault() }), i.delegate(o, "[data-wysihtml5-command]", "click", function (t) { var n = this.getAttribute("data-wysihtml5-command"), o = this.getAttribute("data-wysihtml5-command-value"); e.execCommand(n, o), t.preventDefault() }), i.delegate(o, "[data-wysihtml5-action]", "click", function (t) { var n = this.getAttribute("data-wysihtml5-action"); e.execAction(n), t.preventDefault() }), t.on("interaction:composer", function () { e._updateLinkStates() }), t.on("focus:composer", function () { e.bookmark = null }), this.editor.config.handleTables && (t.on("tableselect:composer", function () { e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display = "" }), t.on("tableunselect:composer", function () { e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display = "none" })), t.on("change_view", function (r) { t.textarea && setTimeout(function () { e.commandsDisabled = "composer" !== r, e._updateLinkStates(), e.commandsDisabled ? i.addClass(o, n) : i.removeClass(o, n) }, 0) }) }, _updateLinkStates: function () { var n, a, s, l, c = this.commandMapping, d = this.actionMapping; for (n in c) l = c[n], this.commandsDisabled ? (a = !1, i.removeClass(l.link, o), l.group && i.removeClass(l.group, o), l.dialog && l.dialog.hide()) : (a = this.composer.commands.state(l.name, l.value), i.removeClass(l.link, t), l.group && i.removeClass(l.group, t)), l.state !== a && (l.state = a, a ? (i.addClass(l.link, o), l.group && i.addClass(l.group, o), l.dialog && ("object" == typeof a || e.lang.object(a).isArray() ? (!l.dialog.multiselect && e.lang.object(a).isArray() && (a = 1 !== a.length || a[0], l.state = a), l.dialog.show(a)) : l.dialog.hide())) : (i.removeClass(l.link, o), l.group && i.removeClass(l.group, o), l.dialog && l.dialog.hide())); for (n in d) "change_view" === (s = d[n]).name && (s.state = this.editor.currentView === this.editor.textarea, s.state ? i.addClass(s.link, r) : i.removeClass(s.link, r)) }, show: function () { this.container.style.display = "" }, hide: function () { this.container.style.display = "none" } }) }(wysihtml5), function (e) { e.toolbar.Dialog_createTable = e.toolbar.Dialog.extend({ show: function (e) { this.base(e) } }) }(wysihtml5), function (e) { e.dom; e.toolbar.Dialog_foreColorStyle = e.toolbar.Dialog.extend({ multiselect: !0, _serialize: function () { for (var e = {}, t = this.container.querySelectorAll("[data-wysihtml5-dialog-field]"), n = t.length, o = 0; o < n; o++)e[t[o].getAttribute("data-wysihtml5-dialog-field")] = t[o].value; return e }, _interpolate: function (t) { for (var n, o = document.querySelector(":focus"), r = this.container.querySelectorAll("[data-wysihtml5-dialog-field]"), i = r.length, a = 0, s = this.elementToChange ? e.lang.object(this.elementToChange).isArray() ? this.elementToChange[0] : this.elementToChange : null, l = s ? s.getAttribute("style") : null, c = l ? e.quirks.styleParser.parseColor(l, "color") : null; a < i; a++)(n = r[a]) !== o && (t && "hidden" === n.type || "color" === n.getAttribute("data-wysihtml5-dialog-field") && (c ? c[3] && 1 != c[3] ? n.value = "rgba(" + c[0] + "," + c[1] + "," + c[2] + "," + c[3] + ");" : n.value = "rgb(" + c[0] + "," + c[1] + "," + c[2] + ");" : n.value = "rgb(0,0,0);")) } }) }(wysihtml5), function (e) { e.dom; e.toolbar.Dialog_fontSizeStyle = e.toolbar.Dialog.extend({ multiselect: !0, _serialize: function () { return { size: this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value } }, _interpolate: function (t) { var n = document.querySelector(":focus"), o = this.container.querySelector("[data-wysihtml5-dialog-field='size']"), r = this.elementToChange ? e.lang.object(this.elementToChange).isArray() ? this.elementToChange[0] : this.elementToChange : null, i = r ? r.getAttribute("style") : null, a = i ? e.quirks.styleParser.parseFontSize(i) : null; o && o !== n && a && !/^\s*$/.test(a) && (o.value = a) } }) }(wysihtml5); var Handlebars = function () { var e = function () { "use strict"; function e(e) { this.string = e } return e.prototype.toString = function () { return "" + this.string }, e }(), t = function (e) { "use strict"; function t(e) { return r[e] || "&amp;" } var n = {}, o = e, r = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#x27;", "`": "&#x60;" }, i = /[&<>"'`]/g, a = /[&<>"'`]/; n.extend = function (e, t) { for (var n in t) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]) }; var s, l = Object.prototype.toString; n.toString = l, (s = function (e) { return "function" == typeof e })(/x/) && (s = function (e) { return "function" == typeof e && "[object Function]" === l.call(e) }), n.isFunction = s; var c = Array.isArray || function (e) { return !(!e || "object" != typeof e) && "[object Array]" === l.call(e) }; return n.isArray = c, n.escapeExpression = function (e) { return e instanceof o ? e.toString() : e || 0 === e ? (e = "" + e, a.test(e) ? e.replace(i, t) : e) : "" }, n.isEmpty = function (e) { return !e && 0 !== e || !(!c(e) || 0 !== e.length) }, n }(e), n = function () { "use strict"; function e(e, n) { var o; n && n.firstLine && (e += " - " + (o = n.firstLine) + ":" + n.firstColumn); for (var r = Error.prototype.constructor.call(this, e), i = 0; i < t.length; i++)this[t[i]] = r[t[i]]; o && (this.lineNumber = o, this.column = n.firstColumn) } var t = ["description", "fileName", "lineNumber", "message", "name", "number", "stack"]; return e.prototype = new Error, e }(), o = function (e, t) { "use strict"; function n(e, t) { this.helpers = e || {}, this.partials = t || {}, function (e) { e.registerHelper("helperMissing", function (e) { if (2 !== arguments.length) throw new a("Missing helper: '" + e + "'") }), e.registerHelper("blockHelperMissing", function (t, n) { var o = n.inverse || function () { }, r = n.fn; return l(t) && (t = t.call(this)), !0 === t ? r(this) : !1 === t || null == t ? o(this) : s(t) ? t.length > 0 ? e.helpers.each(t, n) : o(this) : r(t) }), e.registerHelper("each", function (e, t) { var n, o = t.fn, r = t.inverse, i = 0, a = ""; if (l(e) && (e = e.call(this)), t.data && (n = h(t.data)), e && "object" == typeof e) if (s(e)) for (var c = e.length; c > i; i++)n && (n.index = i, n.first = 0 === i, n.last = i === e.length - 1), a += o(e[i], { data: n }); else for (var d in e) e.hasOwnProperty(d) && (n && (n.key = d, n.index = i, n.first = 0 === i), a += o(e[d], { data: n }), i++); return 0 === i && (a = r(this)), a }), e.registerHelper("if", function (e, t) { return l(e) && (e = e.call(this)), !t.hash.includeZero && !e || i.isEmpty(e) ? t.inverse(this) : t.fn(this) }), e.registerHelper("unless", function (t, n) { return e.helpers.if.call(this, t, { fn: n.inverse, inverse: n.fn, hash: n.hash }) }), e.registerHelper("with", function (e, t) { return l(e) && (e = e.call(this)), i.isEmpty(e) ? void 0 : t.fn(e) }), e.registerHelper("log", function (t, n) { var o = n.data && null != n.data.level ? parseInt(n.data.level, 10) : 1; e.log(o, t) }) }(this) } function o(e, t) { u.log(e, t) } var r = {}, i = e, a = t; r.VERSION = "1.3.0"; r.COMPILER_REVISION = 4; r.REVISION_CHANGES = { 1: "<= 1.0.rc.2", 2: "== 1.0.0-rc.3", 3: "== 1.0.0-rc.4", 4: ">= 1.0.0" }; var s = i.isArray, l = i.isFunction, c = i.toString, d = "[object Object]"; r.HandlebarsEnvironment = n, n.prototype = { constructor: n, logger: u, log: o, registerHelper: function (e, t, n) { if (c.call(e) === d) { if (n || t) throw new a("Arg not supported with multiple helpers"); i.extend(this.helpers, e) } else n && (t.not = n), this.helpers[e] = t }, registerPartial: function (e, t) { c.call(e) === d ? i.extend(this.partials, e) : this.partials[e] = t } }; var u = { methodMap: { 0: "debug", 1: "info", 2: "warn", 3: "error" }, DEBUG: 0, INFO: 1, WARN: 2, ERROR: 3, level: 3, log: function (e, t) { if (u.level <= e) { var n = u.methodMap[e]; "undefined" != typeof console && console[n] && console[n].call(console, t) } } }; r.logger = u, r.log = o; var h = function (e) { var t = {}; return i.extend(t, e), t }; return r.createFrame = h, r }(t, n), r = function (e, t, n) { "use strict"; function o(e, t, n) { var o = function (e, o) { return t(e, (o = o || {}).data || n) }; return o.program = e, o.depth = 0, o } var r = {}, i = e, a = t, s = n.COMPILER_REVISION, l = n.REVISION_CHANGES; return r.checkRevision = function (e) { var t = e && e[0] || 1; if (t !== s) { if (s > t) { var n = l[s], o = l[t]; throw new a("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version (" + n + ") or downgrade your runtime to an older version (" + o + ").") } throw new a("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version (" + e[1] + ").") } }, r.template = function (e, t) { if (!t) throw new a("No environment passed to template"); var n = { escapeExpression: i.escapeExpression, invokePartial: function (e, n, o, r, i, s) { var l = t.VM.invokePartial.apply(this, arguments); if (null != l) return l; if (t.compile) { var c = { helpers: r, partials: i, data: s }; return i[n] = t.compile(e, { data: void 0 !== s }, t), i[n](o, c) } throw new a("The partial " + n + " could not be compiled when running in runtime-only mode") }, programs: [], program: function (e, t, n) { var r = this.programs[e]; return n ? r = o(e, t, n) : r || (r = this.programs[e] = o(e, t)), r }, merge: function (e, t) { var n = e || t; return e && t && e !== t && (n = {}, i.extend(n, t), i.extend(n, e)), n }, programWithDepth: t.VM.programWithDepth, noop: t.VM.noop, compilerInfo: null }; return function (o, r) { var i, a, s = (r = r || {}).partial ? r : t; r.partial || (i = r.helpers, a = r.partials); var l = e.call(n, s, o, i, a, r.data); return r.partial || t.VM.checkRevision(n.compilerInfo), l } }, r.programWithDepth = function (e, t, n) { var o = Array.prototype.slice.call(arguments, 3), r = function (e, r) { return r = r || {}, t.apply(this, [e, r.data || n].concat(o)) }; return r.program = e, r.depth = o.length, r }, r.program = o, r.invokePartial = function (e, t, n, o, r, i) { var s = { partial: !0, helpers: o, partials: r, data: i }; if (void 0 === e) throw new a("The partial " + t + " could not be found"); return e instanceof Function ? e(n, s) : void 0 }, r.noop = function () { return "" }, r }(t, n, o); return function (e, t, n, o, r) { "use strict"; var i = e, a = t, s = n, l = o, c = r, d = function () { var e = new i.HandlebarsEnvironment; return l.extend(e, i), e.SafeString = a, e.Exception = s, e.Utils = l, e.VM = c, e.template = function (t) { return c.template(t, e) }, e }, u = d(); return u.create = d, u }(o, e, n, t, r) }(); this.wysihtml5 = this.wysihtml5 || {}, this.wysihtml5.tpl = this.wysihtml5.tpl || {}, this.wysihtml5.tpl.blockquote = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li>\n  <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(5, function (e, t) { return '\n      <span class="glyphicon glyphicon-quote"></span>\n    ' }, r), fn: this.program(3, function (e, t) { return ' \n      <span class="fa fa-quote-left"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += "\n  </a>\n</li>\n" }), this.wysihtml5.tpl.color = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += '" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.black) === s ? i.apply(t) : i) + '</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.black) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.silver) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.gray) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.maroon) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.red) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.purple) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.green) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.olive) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.navy) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.blue) === s ? i.apply(t) : i) + '</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.colours) || !1 === i ? i : i.orange) === s ? i.apply(t) : i) + "</a></li>\n  </ul>\n</li>\n" }), this.wysihtml5.tpl.emphasis = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression, c = this; function d(e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) } return a += '<li>\n  <div class="btn-group">\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: c.noop, fn: c.program(1, d, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.emphasis) || !1 === i ? i : i.bold) === s ? i.apply(t) : i) + '</a>\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: c.noop, fn: c.program(1, d, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.emphasis) || !1 === i ? i : i.italic) === s ? i.apply(t) : i) + '</a>\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: c.noop, fn: c.program(1, d, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.emphasis) || !1 === i ? i : i.underline) === s ? i.apply(t) : i) + "</a>\n    ", ((i = n.if.call(t, null == (i = null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.emphasis) || !1 === i ? i : i.small, { hash: {}, inverse: c.noop, fn: c.program(3, function (e, t) { var o, r = ""; return r += '\n    <a class="btn ', ((o = n.if.call(e, null == (o = null == (o = e && e.options) || !1 === o ? o : o.toolbar) || !1 === o ? o : o.size, { hash: {}, inverse: c.noop, fn: c.program(1, d, t), data: t })) || 0 === o) && (r += o), r += ' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">' + l(typeof (o = null == (o = null == (o = e && e.locale) || !1 === o ? o : o.emphasis) || !1 === o ? o : o.small) === s ? o.apply(e) : o) + "</a>\n    " }, r), data: r })) || 0 === i) && (a += i), a += "\n  </div>\n</li>\n" }), this.wysihtml5.tpl["font-styles"] = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += '" data-toggle="dropdown">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(5, function (e, t) { return '\n      <span class="glyphicon glyphicon-font"></span>\n    ' }, r), fn: this.program(3, function (e, t) { return '\n      <span class="fa fa-font"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += '\n    <span class="current-font">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.normal) === s ? i.apply(t) : i) + '</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.normal) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h1) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h2) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h3) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h4) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h5) === s ? i.apply(t) : i) + '</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.font_styles) || !1 === i ? i : i.h6) === s ? i.apply(t) : i) + "</a></li>\n  </ul>\n</li>\n" }), this.wysihtml5.tpl.html = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li>\n  <div class="btn-group">\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-action="change_view" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.html) || !1 === i ? i : i.edit) === s ? i.apply(t) : i) + '" tabindex="-1">\n      ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(5, function (e, t) { return '\n        <span class="glyphicon glyphicon-pencil"></span>\n      ' }, r), fn: this.program(3, function (e, t) { return '\n        <span class="fa fa-pencil"></span>\n      ' }, r), data: r })) || 0 === i) && (a += i), a += "\n    </a>\n  </div>\n</li>\n" }), this.wysihtml5.tpl.image = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.smallmodals, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { return "modal-sm" }, r), data: r })) || 0 === i) && (a += i), a += '">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.image) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.image) || !1 === i ? i : i.cancel) === s ? i.apply(t) : i) + '</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.image) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(3, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="insertImage" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.image) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(7, function (e, t) { return '\n      <span class="glyphicon glyphicon-picture"></span>\n    ' }, r), fn: this.program(5, function (e, t) { return '\n      <span class="fa fa-file-image-o"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += "\n  </a>\n</li>\n" }), this.wysihtml5.tpl.link = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; return a += '<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.smallmodals, { hash: {}, inverse: this.noop, fn: this.program(1, function (e, t) { return "modal-sm" }, r), data: r })) || 0 === i) && (a += i), a += '">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.link) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.link) || !1 === i ? i : i.target) === s ? i.apply(t) : i) + '\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.link) || !1 === i ? i : i.cancel) === s ? i.apply(t) : i) + '</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.link) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(3, function (e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) }, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="createLink" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.link) || !1 === i ? i : i.insert) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(7, function (e, t) { return '\n      <span class="glyphicon glyphicon-share"></span>\n    ' }, r), fn: this.program(5, function (e, t) { return '\n      <span class="fa fa-share-square-o"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += "\n  </a>\n</li>\n" }), this.wysihtml5.tpl.lists = Handlebars.template(function (e, t, n, o, r) { this.compilerInfo = [4, ">= 1.0.0"], n = this.merge(n, e.helpers), r = r || {}; var i, a = "", s = "function", l = this.escapeExpression; function c(e, t) { var n, o = ""; return o += "btn-" + l(typeof (n = null == (n = null == (n = e && e.options) || !1 === n ? n : n.toolbar) || !1 === n ? n : n.size) === s ? n.apply(e) : n) } return a += '<li>\n  <div class="btn-group">\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, c, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="insertUnorderedList" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.lists) || !1 === i ? i : i.unordered) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(5, function (e, t) { return '\n      <span class="glyphicon glyphicon-list"></span>\n    ' }, r), fn: this.program(3, function (e, t) { return '\n      <span class="fa fa-list-ul"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += '\n    </a>\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, c, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="insertOrderedList" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.lists) || !1 === i ? i : i.ordered) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(9, function (e, t) { return '\n      <span class="glyphicon glyphicon-th-list"></span>\n    ' }, r), fn: this.program(7, function (e, t) { return '\n      <span class="fa fa-list-ol"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += '\n    </a>\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, c, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="Outdent" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.lists) || !1 === i ? i : i.outdent) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(13, function (e, t) { return '\n      <span class="glyphicon glyphicon-indent-right"></span>\n    ' }, r), fn: this.program(11, function (e, t) { return '\n      <span class="fa fa-outdent"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += '\n    </a>\n    <a class="btn ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.size, { hash: {}, inverse: this.noop, fn: this.program(1, c, r), data: r })) || 0 === i) && (a += i), a += ' btn-default" data-wysihtml5-command="Indent" title="' + l(typeof (i = null == (i = null == (i = t && t.locale) || !1 === i ? i : i.lists) || !1 === i ? i : i.indent) === s ? i.apply(t) : i) + '" tabindex="-1">\n    ', ((i = n.if.call(t, null == (i = null == (i = t && t.options) || !1 === i ? i : i.toolbar) || !1 === i ? i : i.fa, { hash: {}, inverse: this.program(17, function (e, t) { return '\n      <span class="glyphicon glyphicon-indent-left"></span>\n    ' }, r), fn: this.program(15, function (e, t) { return '\n      <span class="fa fa-indent"></span>\n    ' }, r), data: r })) || 0 === i) && (a += i), a += "\n    </a>\n  </div>\n</li>\n" }), function (e) { "use strict"; "function" == typeof define && define.amd ? define("bootstrap.wysihtml5", ["jquery", "wysihtml5", "bootstrap", "bootstrap.wysihtml5.templates", "bootstrap.wysihtml5.commands"], e) : e(jQuery, wysihtml5) }(function (e, t) { "use strict"; !function (e, t) { var n = function (e, n, o) { if (t.tpl[e]) return t.tpl[e]({ locale: n, options: o }) }, o = function (n, o) { this.el = n; var r = e.extend(!0, {}, i, o); for (var a in r.customTemplates) r.customTemplates.hasOwnProperty(a) && (t.tpl[a] = r.customTemplates[a]); this.toolbar = this.createToolbar(n, r), this.editor = this.createEditor(r) }; o.prototype = { constructor: o, createEditor: function (t) { t = t || {}, (t = e.extend(!0, {}, t)).toolbar = this.toolbar[0], this.initializeEditor(this.el[0], t) }, initializeEditor: function (e, n) { var o = new t.Editor(this.el[0], n); if (o.on("beforeload", this.syncBootstrapDialogEvents), o.on("beforeload", this.loadParserRules), o.composer.editableArea.contentDocument ? this.addMoreShortcuts(o, o.composer.editableArea.contentDocument.body || o.composer.editableArea.contentDocument, n.shortcuts) : this.addMoreShortcuts(o, o.composer.editableArea, n.shortcuts), n && n.events) for (var r in n.events) n.events.hasOwnProperty(r) && o.on(r, n.events[r]); return o }, loadParserRules: function () { "string" === e.type(this.config.parserRules) && e.ajax({ dataType: "json", url: this.config.parserRules, context: this, error: function (e, t, n) { console.log(n) }, success: function (e) { this.config.parserRules = e, console.log("parserrules loaded") } }), this.config.pasteParserRulesets && "string" === e.type(this.config.pasteParserRulesets) && e.ajax({ dataType: "json", url: this.config.pasteParserRulesets, context: this, error: function (e, t, n) { console.log(n) }, success: function (e) { this.config.pasteParserRulesets = e } }) }, syncBootstrapDialogEvents: function () { var t = this; e.map(this.toolbar.commandMapping, function (e) { return [e] }).filter(function (e) { return e.dialog }).map(function (e) { return e.dialog }).forEach(function (n) { n.on("show", function () { e(this.container).modal("show") }), n.on("hide", function () { e(this.container).modal("hide"), setTimeout(t.composer.focus, 0) }), e(n.container).on("shown.bs.modal", function () { e(this).find("input, select, textarea").first().focus() }) }), this.on("change_view", function () { e(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled") }) }, createToolbar: function (t, o) { var r = this, s = e("<ul/>", { class: "wysihtml5-toolbar", style: "display:none" }), l = o.locale || i.locale || "en"; a.hasOwnProperty(l) || (console.debug("Locale '" + l + "' not found. Available locales are: " + Object.keys(a) + ". Falling back to 'en'."), l = "en"); var c = e.extend(!0, {}, a.en, a[l]); for (var d in o.toolbar) o.toolbar[d] && s.append(n(d, c, o)); return s.find('a[data-wysihtml5-command="formatBlock"]').click(function (t) { var n = t.delegateTarget || t.target || t.srcElement, o = e(n), i = o.data("wysihtml5-display-format-name"), a = o.data("wysihtml5-format-name") || o.html(); void 0 !== i && "true" !== i || r.toolbar.find(".current-font").text(a) }), s.find('a[data-wysihtml5-command="foreColor"]').click(function (t) { var n = t.target || t.srcElement, o = e(n); r.toolbar.find(".current-color").text(o.html()) }), this.el.before(s), s }, addMoreShortcuts: function (e, n, o) { t.dom.observe(n, "keydown", function (n) { var r = n.keyCode, i = o[r]; if ((n.ctrlKey || n.metaKey || n.altKey) && i && t.commands[i]) { var a = e.toolbar.commandMapping[i + ":null"]; a && a.dialog && !a.state ? a.dialog.show() : t.commands[i].exec(e.composer, i), n.preventDefault() } }) } }; var r = { resetDefaults: function () { e.fn.wysihtml5.defaultOptions = e.extend(!0, {}, e.fn.wysihtml5.defaultOptionsCache) }, bypassDefaults: function (t) { return this.each(function () { var n = e(this); n.data("wysihtml5", new o(n, t)) }) }, shallowExtend: function (t) { var n = e.extend({}, e.fn.wysihtml5.defaultOptions, t || {}, e(this).data()); return r.bypassDefaults.apply(this, [n]) }, deepExtend: function (t) { var n = e.extend(!0, {}, e.fn.wysihtml5.defaultOptions, t || {}); return r.bypassDefaults.apply(this, [n]) }, init: function (e) { return r.shallowExtend.apply(this, [e]) } }; e.fn.wysihtml5 = function (t) { return r[t] ? r[t].apply(this, Array.prototype.slice.call(arguments, 1)) : "object" != typeof t && t ? void e.error("Method " + t + " does not exist on jQuery.wysihtml5") : r.init.apply(this, arguments) }, e.fn.wysihtml5.Constructor = o; var i = e.fn.wysihtml5.defaultOptions = { toolbar: { "font-styles": !0, color: !1, emphasis: { small: !0 }, blockquote: !0, lists: !0, html: !1, link: !0, image: !0, smallmodals: !1 }, useLineBreaks: !1, parserRules: { classes: { "wysiwyg-color-silver": 1, "wysiwyg-color-gray": 1, "wysiwyg-color-white": 1, "wysiwyg-color-maroon": 1, "wysiwyg-color-red": 1, "wysiwyg-color-purple": 1, "wysiwyg-color-fuchsia": 1, "wysiwyg-color-green": 1, "wysiwyg-color-lime": 1, "wysiwyg-color-olive": 1, "wysiwyg-color-yellow": 1, "wysiwyg-color-navy": 1, "wysiwyg-color-blue": 1, "wysiwyg-color-teal": 1, "wysiwyg-color-aqua": 1, "wysiwyg-color-orange": 1 }, tags: { b: {}, i: {}, strong: {}, em: {}, p: {}, br: {}, ol: {}, ul: {}, li: {}, h1: {}, h2: {}, h3: {}, h4: {}, h5: {}, h6: {}, blockquote: {}, u: 1, img: { check_attributes: { width: "numbers", alt: "alt", src: "url", height: "numbers" } }, a: { check_attributes: { href: "url" }, set_attributes: { target: "_blank", rel: "nofollow" } }, span: 1, div: 1, small: 1, code: 1, pre: 1 } }, locale: "en", shortcuts: { 83: "small", 75: "createLink" } }; void 0 === e.fn.wysihtml5.defaultOptionsCache && (e.fn.wysihtml5.defaultOptionsCache = e.extend(!0, {}, e.fn.wysihtml5.defaultOptions)); var a = e.fn.wysihtml5.locale = {} }(e, t) }), function (e) { e.commands.small = { exec: function (t, n) { return e.commands.formatInline.exec(t, n, "small") }, state: function (t, n) { return e.commands.formatInline.state(t, n, "small") } } }(wysihtml5), function (e) { "function" == typeof define && define.amd ? define("bootstrap.wysihtml5.en-US", ["jquery", "bootstrap.wysihtml5"], e) : e(jQuery) }(function (e) { e.fn.wysihtml5.locale.en = e.fn.wysihtml5.locale["en-US"] = { font_styles: { normal: "Normal text", h1: "Heading 1", h2: "Heading 2", h3: "Heading 3", h4: "Heading 4", h5: "Heading 5", h6: "Heading 6" }, emphasis: { bold: "Bold", italic: "Italic", underline: "Underline", small: "Small" }, lists: { unordered: "Unordered list", ordered: "Ordered list", outdent: "Outdent", indent: "Indent" }, link: { insert: "Insert link", cancel: "Cancel", target: "Open link in new window" }, image: { insert: "Insert image", cancel: "Cancel" }, html: { edit: "Edit HTML" }, colours: { black: "Black", silver: "Silver", gray: "Grey", maroon: "Maroon", red: "Red", purple: "Purple", green: "Green", olive: "Olive", navy: "Navy", blue: "Blue", orange: "Orange" } } });